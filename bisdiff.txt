5,6d4
< 
< 
8,10c6,8
< Request for Comments: 4006                                    L. Mattila
< Category: Standards Track                                       Ericsson
<                                                            J-P. Koskinen
---
> Internet-Draft                                                L. Mattila
> Intended status: Standards Track                      Oy L M Ericsson Ab
> Expires: February 2, 2006                                  J-P. Koskinen
11a10
>                                                           Nokia Networks
13c12
<                                                                    Nokia
---
>                                                    Nokia Research Center
17c16,24
<                  Diameter Credit-Control Application
---
>                   Diameter Credit-Control Application
>                                 RFC 4006
> 
> Abstract
> 
>    This document specifies a Diameter application that can be used to
>    implement real-time credit-control for a variety of end user services
>    such as network access, Session Initiation Protocol (SIP) services,
>    messaging services, and download services.
21,25c28,41
<    This document specifies an Internet standards track protocol for the
<    Internet community, and requests discussion and suggestions for
<    improvements.  Please refer to the current edition of the "Internet
<    Official Protocol Standards" (STD 1) for the standardization state
<    and status of this protocol.  Distribution of this memo is unlimited.
---
>    This Internet-Draft is submitted in full conformance with the
>    provisions of BCP 78 and BCP 79.
> 
>    Internet-Drafts are working documents of the Internet Engineering
>    Task Force (IETF).  Note that other groups may also distribute
>    working documents as Internet-Drafts.  The list of current Internet-
>    Drafts is at http://datatracker.ietf.org/drafts/current/.
> 
>    Internet-Drafts are draft documents valid for a maximum of six months
>    and may be updated, replaced, or obsoleted by other documents at any
>    time.  It is inappropriate to use Internet-Drafts as reference
>    material or to cite them other than as "work in progress."
> 
>    This Internet-Draft will expire on February 2, 2006.
29c45,46
<    Copyright (C) The Internet Society (2005).
---
>    Copyright (c) 2005 IETF Trust and the persons identified as the
>    document authors.  All rights reserved.
31c48,52
< Abstract
---
>    This document is subject to BCP 78 and the IETF Trust's Legal
>    Provisions Relating to IETF Documents
>    (http://trustee.ietf.org/license-info) in effect on the date of
>    publication of this document.  Please review these documents
>    carefully, as they describe your rights and restrictions with respect
33,36c54,64
<    This document specifies a Diameter application that can be used to
<    implement real-time credit-control for a variety of end user services
<    such as network access, Session Initiation Protocol (SIP) services,
<    messaging services, and download services.
---
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 1]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    to this document.  Code Components extracted from this document must
>    include Simplified BSD License text as described in Section 4.e of
>    the Trust Legal Provisions and are provided without warranty as
>    described in the Simplified BSD License.
40,185c68,227
<    1.  Introduction.................................................   4
<        1.1.   Requirements Language.................................   5
<        1.2.   Terminology...........................................   5
<        1.3.   Advertising Application Support.......................   7
<    2.  Architecture Models..........................................   7
<    3.  Credit-Control Messages......................................   9
<        3.1.   Credit-Control-Request (CCR) Command..................   9
<        3.2.   Credit-Control-Answer (CCA) Command...................  11
<    4.  Credit-Control Application Overview..........................  11
<        4.1.   Service-Specific Rating Input and Interoperability....  13
<    5.  Session Based Credit-Control.................................  15
<        5.1.   General Principles....................................  15
<        5.2.   First Interrogation...................................  21
<        5.3.   Intermediate Interrogation............................  27
<        5.4.   Final Interrogation...................................  29
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 1]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<        5.5.   Server-Initiated Credit Re-Authorization..............  30
<        5.6.   Graceful Service Termination..........................  32
<        5.7.   Failure Procedures....................................  38
<    6.  One Time Event...............................................  41
<        6.1.   Service Price Enquiry.................................  42
<        6.2.   Balance Check.........................................  42
<        6.3.   Direct Debiting.......................................  43
<        6.4.   Refund................................................  44
<        6.5.   Failure Procedure.....................................  44
<    7.  Credit-Control Application State Machine.....................  46
<    8.  Credit-Control AVPs..........................................  55
<        8.1.   CC-Correlation-Id AVP.................................  58
<        8.2.   CC-Request-Number AVP.................................  58
<        8.3.   CC-Request-Type AVP...................................  58
<        8.4.   CC-Session-Failover AVP...............................  59
<        8.5.   CC-Sub-Session-Id AVP.................................  59
<        8.6.   Check-Balance-Result AVP..............................  60
<        8.7.   Cost-Information AVP..................................  60
<        8.8.   Unit-Value AVP........................................  61
<        8.9.   Exponent AVP..........................................  61
<        8.10.  Value-Digits AVP......................................  61
<        8.11.  Currency-Code AVP.....................................  62
<        8.12.  Cost-Unit AVP.........................................  62
<        8.13.  Credit-Control AVP....................................  62
<        8.14.  Credit-Control-Failure-Handling AVP...................  62
<        8.15.  Direct-Debiting-Failure-Handling AVP..................  63
<        8.16.  Multiple-Services-Credit-Control AVP..................  64
<        8.17.  Granted-Service-Unit AVP..............................  65
<        8.18.  Requested-Service-Unit AVP............................  66
<        8.19.  Used-Service-Unit AVP.................................  66
<        8.20.  Tariff-Time-Change AVP................................  67
<        8.21.  CC-Time AVP...........................................  67
<        8.22.  CC-Money AVP..........................................  67
<        8.23.  CC-Total-Octets AVP...................................  68
<        8.24.  CC-Input-Octets AVP...................................  68
<        8.25.  CC-Output-Octets AVP..................................  68
<        8.26.  CC-Service-Specific-Units AVP.........................  68
<        8.27.  Tariff-Change-Usage AVP...............................  68
<        8.28.  Service-Identifier AVP................................  69
<        8.29.  Rating-Group AVP......................................  69
<        8.30.  G-S-U-Pool-Reference AVP..............................  69
<        8.31.  G-S-U-Pool-Identifier AVP.............................  70
<        8.32.  CC-Unit-Type AVP......................................  70
<        8.33.  Validity-Time AVP.....................................  70
<        8.34.  Final-Unit-Indication AVP.............................  71
<        8.35.  Final-Unit-Action AVP.................................  72
<        8.36.  Restriction-Filter-Rule AVP...........................  72
<        8.37.  Redirect-Server AVP...................................  73
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 2]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<        8.38.  Redirect-Address-Type AVP.............................  73
<        8.39.  Redirect-Server-Address AVP...........................  74
<        8.40.  Multiple-Services-Indicator AVP.......................  74
<        8.41.  Requested-Action AVP..................................  74
<        8.42.  Service-Context-Id AVP................................  75
<        8.43.  Service-Parameter-Info AVP............................  76
<        8.44.  Service-Parameter-Type AVP............................  76
<        8.45.  Service-Parameter-Value AVP...........................  77
<        8.46.  Subscription-Id AVP...................................  77
<        8.47.  Subscription-Id-Type AVP..............................  77
<        8.48.  Subscription-Id-Data AVP..............................  78
<        8.49.  User-Equipment-Info AVP...............................  78
<        8.50.  User-Equipment-Info-Type AVP..........................  78
<        8.50.  User-Equipment-Info-Value AVP.........................  79
<    9.  Result Code AVP Values.......................................  79
<        9.1.   Transient Failures....................................  79
<        9.2.   Permanent Failures....................................  80
<    10. AVP Occurrence Table.........................................  80
<        10.1.  Credit-Control AVP Table..............................  81
<        10.2.  Re-Auth-Request/Answer AVP Table......................  82
<    11. RADIUS/Diameter Credit-Control Interworking Model............  82
<    12. IANA Considerations..........................................  85
<        12.1.  Application Identifier................................  86
<        12.2.  Command Codes.........................................  86
<        12.3.  AVP Codes.............................................  86
<        12.4.  Result-Code AVP Values................................  86
<        12.5.  CC-Request-Type AVP...................................  86
<        12.6.  CC-Session-Failover AVP...............................  86
<        12.7.  CC-Unit-Type AVP......................................  87
<        12.8.  Check-Balance-Result AVP..............................  87
<        12.9.  Credit-Control AVP....................................  87
<        12.10. Credit-Control-Failure-Handling AVP...................  87
<        12.11. Direct-Debiting-Failure-Handling AVP..................  87
<        12.12. Final-Unit-Action AVP.................................  87
<        12.13. Multiple-Services-Indicator AVP.......................  87
<        12.14. Redirect-Address-Type AVP.............................  88
<        12.15. Requested-Action AVP..................................  88
<        12.16. Subscription-Id-Type AVP..............................  88
<        12.17. Tariff-Change-Usage AVP...............................  88
<        12.18. User-Equipment-Info-Type AVP..........................  88
<    13. Credit-Control Application Related Parameters................  88
<    14. Security Considerations......................................  89
<        14.1.  Direct Connection with Redirects......................  90
<    15. References...................................................  91
<        15.1.  Normative References..................................  91
<        15.2.  Informative References................................  92
<    16. Acknowledgements.............................................  93
<    Appendix A Credit-Control Sequences..............................  94
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 3]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<        A.1.   Flow I................................................  94
<        A.2.   Flow II...............................................  96
<        A.3.   Flow III..............................................  98
<        A.4.   Flow IV...............................................  99
<        A.5.   Flow V................................................ 100
<        A.6.   Flow VI............................................... 102
<        A.7.   Flow VII.............................................. 103
<        A.8.   Flow VIII............................................. 105
<        A.9.   Flow IX............................................... 107
<    Authors' Addresses............................................... 112
<    Full Copyright Statement......................................... 114
---
>    1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   5
>      1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   5
>      1.2.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   6
>      1.3.  Advertising Application Support . . . . . . . . . . . . .   7
>    2.  Architecture Models . . . . . . . . . . . . . . . . . . . . .   7
>    3.  Credit-Control Messages . . . . . . . . . . . . . . . . . . .   9
>      3.1.  Credit-Control-Request (CCR) Command  . . . . . . . . . .  10
>      3.2.  Credit-Control-Answer (CCA) Command . . . . . . . . . . .  11
>    4.  Credit-Control Application Overview . . . . . . . . . . . . .  12
>      4.1.  Service-Specific Rating Input and Interoperability  . . .  14
>        4.1.1.  Specifying Rating Input AVPs  . . . . . . . . . . . .  14
>        4.1.2.  Service-Specific Documentation  . . . . . . . . . . .  15
>        4.1.3.  Handling of Unsupported/Incorrect Rating Input  . . .  16
>        4.1.4.  RADIUS Vendor-Specific Rating Attributes  . . . . . .  16
>    5.  Session Based Credit-Control  . . . . . . . . . . . . . . . .  16
>      5.1.  General Principles  . . . . . . . . . . . . . . . . . . .  16
>        5.1.1.  Basic Tariff-Time Change Support  . . . . . . . . . .  17
>        5.1.2.  Credit-Control for Multiple Services within a
>                (sub-)Session . . . . . . . . . . . . . . . . . . . .  18
>      5.2.  First Interrogation . . . . . . . . . . . . . . . . . . .  22
>        5.2.1.  First Interrogation after Authorization and
>                Authentication  . . . . . . . . . . . . . . . . . . .  24
>        5.2.2.  Authorization Messages for First Interrogation  . . .  25
>      5.3.  Intermediate Interrogation  . . . . . . . . . . . . . . .  28
>      5.4.  Final Interrogation . . . . . . . . . . . . . . . . . . .  30
>      5.5.  Server-Initiated Credit Re-Authorization  . . . . . . . .  31
>      5.6.  Graceful Service Termination  . . . . . . . . . . . . . .  33
>        5.6.1.  Terminate Action  . . . . . . . . . . . . . . . . . .  35
>        5.6.2.  Redirect Action . . . . . . . . . . . . . . . . . . .  35
>        5.6.3.  Restrict Access Action  . . . . . . . . . . . . . . .  37
>        5.6.4.  Usage of the Server-Initiated Credit Re-Authorization  38
>      5.7.  Failure Procedures  . . . . . . . . . . . . . . . . . . .  39
>    6.  One Time Event  . . . . . . . . . . . . . . . . . . . . . . .  41
>      6.1.  Service Price Enquiry . . . . . . . . . . . . . . . . . .  42
>      6.2.  Balance Check . . . . . . . . . . . . . . . . . . . . . .  43
>      6.3.  Direct Debiting . . . . . . . . . . . . . . . . . . . . .  43
>      6.4.  Refund  . . . . . . . . . . . . . . . . . . . . . . . . .  44
>      6.5.  Failure Procedure . . . . . . . . . . . . . . . . . . . .  45
>    7.  Credit-Control Application State Machine  . . . . . . . . . .  47
>    8.  Credit-Control AVPs . . . . . . . . . . . . . . . . . . . . .  55
>      8.1.  CC-Correlation-Id AVP . . . . . . . . . . . . . . . . . .  58
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 2]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>      8.2.  CC-Request-Number AVP . . . . . . . . . . . . . . . . . .  58
>      8.3.  CC-Request-Type AVP . . . . . . . . . . . . . . . . . . .  58
>      8.4.  CC-Session-Failover AVP . . . . . . . . . . . . . . . . .  59
>      8.5.  CC-Sub-Session-Id AVP . . . . . . . . . . . . . . . . . .  59
>      8.6.  Check-Balance-Result AVP  . . . . . . . . . . . . . . . .  60
>      8.7.  Cost-Information AVP  . . . . . . . . . . . . . . . . . .  60
>      8.8.  Unit-Value AVP  . . . . . . . . . . . . . . . . . . . . .  61
>      8.9.  Exponent AVP  . . . . . . . . . . . . . . . . . . . . . .  61
>      8.10. Value-Digits AVP  . . . . . . . . . . . . . . . . . . . .  61
>      8.11. Currency-Code AVP . . . . . . . . . . . . . . . . . . . .  62
>      8.12. Cost-Unit AVP . . . . . . . . . . . . . . . . . . . . . .  62
>      8.13. Credit-Control AVP  . . . . . . . . . . . . . . . . . . .  62
>      8.14. Credit-Control-Failure-Handling AVP . . . . . . . . . . .  62
>      8.15. Direct-Debiting-Failure-Handling AVP  . . . . . . . . . .  63
>      8.16. Multiple-Services-Credit-Control AVP  . . . . . . . . . .  64
>      8.17. Granted-Service-Unit AVP  . . . . . . . . . . . . . . . .  65
>      8.18. Requested-Service-Unit AVP  . . . . . . . . . . . . . . .  66
>      8.19. Used-Service-Unit AVP . . . . . . . . . . . . . . . . . .  66
>      8.20. Tariff-Time-Change AVP  . . . . . . . . . . . . . . . . .  67
>      8.21. CC-Time AVP . . . . . . . . . . . . . . . . . . . . . . .  67
>      8.22. CC-Money AVP  . . . . . . . . . . . . . . . . . . . . . .  67
>      8.23. CC-Total-Octets AVP . . . . . . . . . . . . . . . . . . .  68
>      8.24. CC-Input-Octets AVP . . . . . . . . . . . . . . . . . . .  68
>      8.25. CC-Output-Octets AVP  . . . . . . . . . . . . . . . . . .  68
>      8.26. CC-Service-Specific-Units AVP . . . . . . . . . . . . . .  68
>      8.27. Tariff-Change-Usage AVP . . . . . . . . . . . . . . . . .  68
>      8.28. Service-Identifier AVP  . . . . . . . . . . . . . . . . .  69
>      8.29. Rating-Group AVP  . . . . . . . . . . . . . . . . . . . .  69
>      8.30. G-S-U-Pool-Reference AVP  . . . . . . . . . . . . . . . .  69
>      8.31. G-S-U-Pool-Identifier AVP . . . . . . . . . . . . . . . .  70
>      8.32. CC-Unit-Type AVP  . . . . . . . . . . . . . . . . . . . .  70
>      8.33. Validity-Time AVP . . . . . . . . . . . . . . . . . . . .  70
>      8.34. Final-Unit-Indication AVP . . . . . . . . . . . . . . . .  71
>      8.35. Final-Unit-Action AVP . . . . . . . . . . . . . . . . . .  72
>      8.36. Restriction-Filter-Rule AVP . . . . . . . . . . . . . . .  73
>      8.37. Redirect-Server AVP . . . . . . . . . . . . . . . . . . .  73
>      8.38. Redirect-Address-Type AVP . . . . . . . . . . . . . . . .  73
>      8.39. Redirect-Server-Address AVP . . . . . . . . . . . . . . .  74
>      8.40. Multiple-Services-Indicator AVP . . . . . . . . . . . . .  74
>      8.41. Requested-Action AVP  . . . . . . . . . . . . . . . . . .  74
>      8.42. Service-Context-Id AVP  . . . . . . . . . . . . . . . . .  75
>      8.43. Service-Parameter-Info AVP  . . . . . . . . . . . . . . .  76
>      8.44. Service-Parameter-Type AVP  . . . . . . . . . . . . . . .  76
>      8.45. Service-Parameter-Value AVP . . . . . . . . . . . . . . .  77
>      8.46. Subscription-Id AVP . . . . . . . . . . . . . . . . . . .  77
>      8.47. Subscription-Id-Type AVP  . . . . . . . . . . . . . . . .  77
>      8.48. Subscription-Id-Data AVP  . . . . . . . . . . . . . . . .  78
>      8.49. User-Equipment-Info AVP . . . . . . . . . . . . . . . . .  78
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 3]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>      8.50. User-Equipment-Info-Type AVP  . . . . . . . . . . . . . .  78
>      8.51. User-Equipment-Info-Value AVP . . . . . . . . . . . . . .  79
>    9.  Result Code AVP Values  . . . . . . . . . . . . . . . . . . .  79
>      9.1.  Transient Failures  . . . . . . . . . . . . . . . . . . .  79
>      9.2.  Permanent Failures  . . . . . . . . . . . . . . . . . . .  80
>    10. AVP Occurrence Table  . . . . . . . . . . . . . . . . . . . .  80
>      10.1.  Credit-Control AVP Table . . . . . . . . . . . . . . . .  81
>      10.2.  Re-Auth-Request/Answer AVP Table . . . . . . . . . . . .  82
>    11. RADIUS/Diameter Credit-Control Interworking Model . . . . . .  82
>    12. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  85
>      12.1.  Application Identifier . . . . . . . . . . . . . . . . .  86
>      12.2.  Command Codes  . . . . . . . . . . . . . . . . . . . . .  86
>      12.3.  AVP Codes  . . . . . . . . . . . . . . . . . . . . . . .  86
>      12.4.  Result-Code AVP Values . . . . . . . . . . . . . . . . .  86
>      12.5.  CC-Request-Type AVP  . . . . . . . . . . . . . . . . . .  86
>      12.6.  CC-Session-Failover AVP  . . . . . . . . . . . . . . . .  86
>      12.7.  CC-Unit-Type AVP . . . . . . . . . . . . . . . . . . . .  86
>      12.8.  Check-Balance-Result AVP . . . . . . . . . . . . . . . .  87
>      12.9.  Credit-Control AVP . . . . . . . . . . . . . . . . . . .  87
>      12.10. Credit-Control-Failure-Handling AVP  . . . . . . . . . .  87
>      12.11. Direct-Debiting-Failure-Handling AVP . . . . . . . . . .  87
>      12.12. Final-Unit-Action AVP  . . . . . . . . . . . . . . . . .  87
>      12.13. Multiple-Services-Indicator AVP  . . . . . . . . . . . .  87
>      12.14. Redirect-Address-Type AVP  . . . . . . . . . . . . . . .  87
>      12.15. Requested-Action AVP . . . . . . . . . . . . . . . . . .  88
>      12.16. Subscription-Id-Type AVP . . . . . . . . . . . . . . . .  88
>      12.17. Tariff-Change-Usage AVP  . . . . . . . . . . . . . . . .  88
>      12.18. User-Equipment-Info-Type AVP . . . . . . . . . . . . . .  88
>    13. Credit-Control Application Related Parameters . . . . . . . .  88
>    14. Security Considerations . . . . . . . . . . . . . . . . . . .  89
>      14.1.  Direct Connection with Redirects . . . . . . . . . . . .  90
>    15. References  . . . . . . . . . . . . . . . . . . . . . . . . .  91
>      15.1.  Normative References . . . . . . . . . . . . . . . . . .  91
>      15.2.  Informative References . . . . . . . . . . . . . . . . .  93
>    Appendix A.  Acknowledgements . . . . . . . . . . . . . . . . . .  93
>    Appendix B.  Credit-Control Sequences . . . . . . . . . . . . . .  93
>      B.1.  Flow I  . . . . . . . . . . . . . . . . . . . . . . . . .  93
>      B.2.  Flow II . . . . . . . . . . . . . . . . . . . . . . . . .  96
>      B.3.  Flow III  . . . . . . . . . . . . . . . . . . . . . . . .  98
>      B.4.  Flow IV . . . . . . . . . . . . . . . . . . . . . . . . .  98
>      B.5.  Flow V  . . . . . . . . . . . . . . . . . . . . . . . . . 100
>      B.6.  Flow VI . . . . . . . . . . . . . . . . . . . . . . . . . 101
>      B.7.  Flow VII  . . . . . . . . . . . . . . . . . . . . . . . . 102
>      B.8.  Flow VIII . . . . . . . . . . . . . . . . . . . . . . . . 103
>      B.9.  Flow IX . . . . . . . . . . . . . . . . . . . . . . . . . 105
>    Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . . 110
> 
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 4]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
204,205c246,247
<    that an application must be able to rate service information in
<    real-time.  In addition, it is necessary to check that the end user's
---
>    that an application must be able to rate service information in real-
>    time.  In addition, it is necessary to check that the end user's
222,230d263
< 
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 4]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
241,277c274,276
<    In this document, the key words "MAY", "MUST, "MUST NOT", "OPTIONAL",
<    "RECOMMENDED", "SHOULD", and "SHOULD NOT", are to be interpreted as
<    described in [KEYWORDS].
< 
< 1.2.  Terminology
< 
<    AAA
< 
<    Authentication, Authorization, and Accounting
< 
<    AA answer
< 
<    AA answer generically refers to a service specific authorization and
<    authentication answer.  AA answer commands are defined in service
<    specific authorization applications, e.g., [NASREQ] and [DIAMMIP].
< 
<    AA request
< 
<    AA request generically refers to a service specific authorization and
<    authentication request.  AA request commands are defined in service
<    specific authorization applications e.g., [NASREQ] and [DIAMMIP].
< 
<    Credit-control
< 
<    Credit-control is a mechanism that directly interacts in real-time
<    with an account and controls or monitors the charges related to the
<    service usage.  Credit-control is a process of checking whether
<    credit is available, credit-reservation, deduction of credit from the
<    end user account when service is completed and refunding of reserved
<    credit that is not used.
< 
<    Diameter Credit-control Server
< 
<    A Diameter credit-control server acts as a prepaid server, performing
<    real-time rating and credit-control.  It is located in the home
<    domain and is accessed by service elements or Diameter AAA servers in
< 
---
>    In this document, the key words "MAY", "MUST", "MUST NOT",
>    "OPTIONAL", "RECOMMENDED", "SHOULD", and "SHOULD NOT", are to be
>    interpreted as described in RFC 2119 [RFC2119].
281,282c280
< 
< Hakala, et al.              Standards Track                     [Page 5]
---
> Hakala, et al.          Expires February 2, 2006                [Page 5]
284,328c282
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    real-time for purpose of price determination and credit-control
<    before the service event is delivered to the end-user.  It may also
<    interact with business support systems.
< 
<    Diameter Credit-control Client
< 
<    A Diameter credit-control client is an entity that interacts with a
<    credit-control server.  It monitors the usage of the granted quota
<    according to instructions returned by credit-control server.
< 
<    Interrogation
< 
<    The Diameter credit-control client uses interrogation to initiate a
<    session based credit-control process.  During the credit-control
<    process, it is used to report the used quota and request a new one.
<    An interrogation maps to a request/answer transaction.
< 
<    One-time event
< 
<    Basically, a request/answer transaction of type event.
< 
<    Rating
< 
<    The act of determining the cost of the service event.
< 
<    Service
< 
<    A type of task performed by a service element for an end user.
< 
<    Service Element
< 
<    A network element that provides a service to the end users.  The
<    Service Element may include the Diameter credit-control client, or
<    another entity (e.g., RADIUS AAA server) that can act as a Credit-
<    control client on behalf of the Service Element.  In the latter case,
<    the interface between the Service Element and the Diameter credit-
<    control client is outside the scope of this specification.  Examples
<    of the Service Elements include Network Access Server (NAS), SIP
<    Proxy, and Application Servers such as messaging server, content
<    server, and gaming server.
< 
<    Service Event
---
> Internet-Draft              Abbreviated Title                August 2005
330,340d283
<    An event relating to a service provided to the end user.
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 6]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
341a285
> 1.2.  Terminology
343c287
<    Session based credit-control
---
>    AAA  Authentication, Authorization, and Accounting
345,352c289,362
<    A credit-control process that makes use of several interrogations:
<    the first, a possible intermediate, and the final.  The first
<    interrogation is used to reserve money from the user's account and to
<    initiate the process.  The intermediate interrogations may be needed
<    to request new quota while the service is being rendered.  The final
<    interrogation is used to exit the process.  The credit-control server
<    is required to maintain session state for session-based credit-
<    control.
---
>    AA answer  AA answer generically refers to a service specific
>       authorization and authentication answer.  AA answer commands are
>       defined in service specific authorization applications, e.g.,
>       [NASREQ] [RFC4005] and [DIAMMIP] [RFC4004].
> 
>    AA request  AA request generically refers to a service specific
>       authorization and authentication request.  AA request commands are
>       defined in service specific authorization applications e.g.,
>       [NASREQ] [RFC4005] and [DIAMMIP] [RFC4004].
> 
>    Credit-control  Credit-control is a mechanism that directly interacts
>       in real-time with an account and controls or monitors the charges
>       related to the service usage.  Credit-control is a process of
>       checking whether credit is available, credit-reservation,
>       deduction of credit from the end user account when service is
>       completed and refunding of reserved credit that is not used.
> 
>    Diameter Credit-control Server  A Diameter credit-control server acts
>       as a prepaid server, performing real-time rating and credit-
>       control.  It is located in the home domain and is accessed by
>       service elements or Diameter AAA servers in real-time for purpose
>       of price determination and credit-control before the service event
>       is delivered to the end-user.  It may also interact with business
>       support systems.
> 
>    Diameter Credit-control Client  A Diameter credit-control client is
>       an entity that interacts with a credit-control server.  It
>       monitors the usage of the granted quota according to instructions
>       returned by credit-control server.
> 
>    Interrogation  The Diameter credit-control client uses interrogation
>       to initiate a session based credit-control process.  During the
>       credit-control process, it is used to report the used quota and
>       request a new one.  An interrogation maps to a request/answer
>       transaction.
> 
>    One-time event  Basically, a request/answer transaction of type
>       event.
> 
>    Rating  The act of determining the cost of the service event.
> 
>    Service  A type of task performed by a service element for an end
>       user.
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 6]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    Service Element  A network element that provides a service to the end
>       users.  The Service Element may include the Diameter credit-
>       control client, or another entity (e.g., RADIUS AAA server) that
>       can act as a Credit- control client on behalf of the Service
>       Element.  In the latter case, the interface between the Service
>       Element and the Diameter credit- control client is outside the
>       scope of this specification.  Examples of the Service Elements
>       include Network Access Server (NAS), SIP Proxy, and Application
>       Servers such as messaging server, content server, and gaming
>       server.
> 
>    Service Event  An event relating to a service provided to the end
>       user.
> 
>    Session based credit-control  A credit-control process that makes use
>       of several interrogations: the first, a possible intermediate, and
>       the final.  The first interrogation is used to reserve money from
>       the user's account and to initiate the process.  The intermediate
>       interrogations may be needed to request new quota while the
>       service is being rendered.  The final interrogation is used to
>       exit the process.  The credit-control server is required to
>       maintain session state for session-based credit- control.
359c369
<    command [DIAMBASE].
---
>    command [DIAMBASE] [RFC3588].
364,372c374,383
<    [RFC2866] and Diameter base [DIAMBASE] are not sufficient for real-
<    time credit-control, where credit-worthiness is to be determined
<    prior to service initiation.  Also, the existing Diameter
<    authorization applications, [NASREQ] and [DIAMMIP], only provide
<    service authorization, but do not provide credit authorization for
<    prepaid users.  In order to support real-time credit-control, a new
<    type of server is needed in the AAA infrastructure: Diameter credit-
<    control server.  The Diameter credit-control server is the entity
<    responsible for credit authorization for prepaid subscribers.
---
>    [RFC2866] [RFC2866] and Diameter base [DIAMBASE] [RFC3588] are not
>    sufficient for real- time credit-control, where credit-worthiness is
>    to be determined prior to service initiation.  Also, the existing
>    Diameter authorization applications, [NASREQ] [RFC4005] and [DIAMMIP]
>    [RFC4004], only provide service authorization, but do not provide
>    credit authorization for prepaid users.  In order to support real-
>    time credit-control, a new type of server is needed in the AAA
>    infrastructure: Diameter credit- control server.  The Diameter
>    credit-control server is the entity responsible for credit
>    authorization for prepaid subscribers.
377a389,396
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 7]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
392,398d410
< 
< 
< Hakala, et al.              Standards Track                     [Page 7]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
419,431d430
<                    Service Element   AAA and CC
<    +----------+      +---------+     Protocols+-----------+  +--------+
<    |  End     |<---->|+-------+|<------------>|    AAA    |  |Business|
<    |  User    |   +->|| CC    ||              |   Server  |->|Support |
<    |          |   |  || Client||<-----+       |           |  |System  |
<    +----------+   |  |+-------+|      |       +-----------+  |        |
<                   |  +---------+      |             ^        +--------+
<    +----------+   |                   | CC Protocol |             ^
<    |  End     |<--+                   |       +-----v----+        |
<    |  User    |                       +------>|Credit-   |        |
<    +----------+                Credit-Control |Control   |--------+
<                                Protocol       |Server    |
<                                               +----------+
433c432,468
<               Figure 1: Typical credit-control architecture
---
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006                [Page 8]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>                     Service Element   AAA and CC
>     +----------+      +---------+     Protocols+-----------+  +--------+
>     |  End     |<---->|+-------+|<------------>|    AAA    |  |Business|
>     |  User    |   +->|| CC    ||              |   Server  |->|Support |
>     |          |   |  || Client||<-----+       |           |  |System  |
>     +----------+   |  |+-------+|      |       +-----------+  |        |
>                    |  +---------+      |             ^        +--------+
>     +----------+   |                   | CC Protocol |             ^
>     |  End     |<--+                   |       +-----v----+        |
>     |  User    |                       +------>|Credit-   |        |
>     +----------+                Credit-Control |Control   |--------+
>                                 Protocol       |Server    |
>                                                +----------+
> 
> 
>                Figure 1: Typical credit-control architecture
446,454d480
< 
< 
< 
< 
< Hakala, et al.              Standards Track                     [Page 8]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
461c487
<    [DIAMBASE], section 2.8.
---
>    [DIAMBASE] [RFC3588], section 2.8.
473,480d498
<    Command-Name                  Abbrev.    Code     Reference
<    -----------------------------------------------------------
<    Credit-Control-Request        CCR        272      3.1
<    Credit-Control-Answer         CCA        272      3.2
< 
<    Diameter Base [DIAMBASE] defines in the section 3.2 the Command Code
<    ABNF specification.  These formats are observed in Credit-Control
<    messages.
482,488d499
< 3.1.  Credit-Control-Request (CCR) Command
< 
<    The Credit-Control-Request message (CCR) is indicated by the
<    command-code field being set to 272 and the 'R' bit being set in the
<    Command Flags field.  It is used between the Diameter credit-control
<    client and the credit-control server to request credit authorization
<    for a given service.
490,491d500
<    The Auth-Application-Id MUST be set to the value 4, indicating the
<    Diameter credit-control application.
494a504,506
> Hakala, et al.          Expires February 2, 2006                [Page 9]
> 
> Internet-Draft              Abbreviated Title                August 2005
496a509,514
>           +------------------------+---------+------+-----------+
>           | Command-Name           | Abrrev. | Code | Reference |
>           +------------------------+---------+------+-----------+
>           | Credit-Control-Request | CCR     | 272  | 3.1       |
>           | Credit-Control-Answer  | CCA     | 272  | 3.2       |
>           +------------------------+---------+------+-----------+
497a516
>                                   Table 1
498a518,520
>    Diameter Base [DIAMBASE] [RFC3588] defines in the section 3.2 the
>    Command Code ABNF specification.  These formats are observed in
>    Credit-Control messages.
499a522
> 3.1.  Credit-Control-Request (CCR) Command
500a524,528
>    The Credit-Control-Request message (CCR) is indicated by the command-
>    code field being set to 272 and the 'R' bit being set in the Command
>    Flags field.  It is used between the Diameter credit-control client
>    and the credit-control server to request credit authorization for a
>    given service.
501a530,531
>    The Auth-Application-Id MUST be set to the value 4, indicating the
>    Diameter credit-control application.
502a533
>    Message Format
506,508d536
< Hakala, et al.              Standards Track                     [Page 9]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
511d538
<    Message Format
513,541d539
<       <Credit-Control-Request> ::= < Diameter Header: 272, REQ, PXY >
<                                    < Session-Id >
<                                    { Origin-Host }
<                                    { Origin-Realm }
<                                    { Destination-Realm }
<                                    { Auth-Application-Id }
<                                    { Service-Context-Id }
<                                    { CC-Request-Type }
<                                    { CC-Request-Number }
<                                    [ Destination-Host ]
<                                    [ User-Name ]
<                                    [ CC-Sub-Session-Id ]
<                                    [ Acct-Multi-Session-Id ]
<                                    [ Origin-State-Id ]
<                                    [ Event-Timestamp ]
<                                   *[ Subscription-Id ]
<                                    [ Service-Identifier ]
<                                    [ Termination-Cause ]
<                                    [ Requested-Service-Unit ]
<                                    [ Requested-Action ]
<                                   *[ Used-Service-Unit ]
<                                    [ Multiple-Services-Indicator ]
<                                   *[ Multiple-Services-Credit-Control ]
<                                   *[ Service-Parameter-Info ]
<                                    [ CC-Correlation-Id ]
<                                    [ User-Equipment-Info ]
<                                   *[ Proxy-Info ]
<                                   *[ Route-Record ]
<                                   *[ AVP ]
562c560
< Hakala, et al.              Standards Track                    [Page 10]
---
> Hakala, et al.          Expires February 2, 2006               [Page 10]
564c562,593
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>        <Credit-Control-Request> ::= < Diameter Header: 272, REQ, PXY >
>                                     < Session-Id >
>                                     { Origin-Host }
>                                     { Origin-Realm }
>                                     { Destination-Realm }
>                                     { Auth-Application-Id }
>                                     { Service-Context-Id }
>                                     { CC-Request-Type }
>                                     { CC-Request-Number }
>                                     [ Destination-Host ]
>                                     [ User-Name ]
>                                     [ CC-Sub-Session-Id ]
>                                     [ Acct-Multi-Session-Id ]
>                                     [ Origin-State-Id ]
>                                     [ Event-Timestamp ]
>                                    *[ Subscription-Id ]
>                                     [ Service-Identifier ]
>                                     [ Termination-Cause ]
>                                     [ Requested-Service-Unit ]
>                                     [ Requested-Action ]
>                                    *[ Used-Service-Unit ]
>                                     [ Multiple-Services-Indicator ]
>                                    *[ Multiple-Services-Credit-Control ]
>                                    *[ Service-Parameter-Info ]
>                                     [ CC-Correlation-Id ]
>                                     [ User-Equipment-Info ]
>                                    *[ Proxy-Info ]
>                                    *[ Route-Record ]
>                                    *[ AVP ]
577,605c606,650
<       <Credit-Control-Answer> ::= < Diameter Header: 272, PXY >
<                                   < Session-Id >
<                                   { Result-Code }
<                                   { Origin-Host }
<                                   { Origin-Realm }
<                                   { Auth-Application-Id }
<                                   { CC-Request-Type }
<                                   { CC-Request-Number }
<                                   [ User-Name ]
<                                   [ CC-Session-Failover ]
<                                   [ CC-Sub-Session-Id ]
<                                   [ Acct-Multi-Session-Id ]
<                                   [ Origin-State-Id ]
<                                   [ Event-Timestamp ]
<                                   [ Granted-Service-Unit ]
<                                  *[ Multiple-Services-Credit-Control ]
<                                   [ Cost-Information]
<                                   [ Final-Unit-Indication ]
<                                   [ Check-Balance-Result ]
<                                   [ Credit-Control-Failure-Handling ]
<                                   [ Direct-Debiting-Failure-Handling ]
<                                   [ Validity-Time]
<                                  *[ Redirect-Host]
<                                   [ Redirect-Host-Usage ]
<                                   [ Redirect-Max-Cache-Time ]
<                                  *[ Proxy-Info ]
<                                  *[ Route-Record ]
<                                  *[ Failed-AVP ]
<                                  *[ AVP ]
---
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 11]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>         <Credit-Control-Answer> ::= < Diameter Header: 272, PXY >
>                                     < Session-Id >
>                                     { Result-Code }
>                                     { Origin-Host }
>                                     { Origin-Realm }
>                                     { Auth-Application-Id }
>                                     { CC-Request-Type }
>                                     { CC-Request-Number }
>                                     [ User-Name ]
>                                     [ CC-Session-Failover ]
>                                     [ CC-Sub-Session-Id ]
>                                     [ Acct-Multi-Session-Id ]
>                                     [ Origin-State-Id ]
>                                     [ Event-Timestamp ]
>                                     [ Granted-Service-Unit ]
>                                    *[ Multiple-Services-Credit-Control ]
>                                     [ Cost-Information]
>                                     [ Final-Unit-Indication ]
>                                     [ Check-Balance-Result ]
>                                     [ Credit-Control-Failure-Handling ]
>                                     [ Direct-Debiting-Failure-Handling ]
>                                     [ Validity-Time]
>                                    *[ Redirect-Host]
>                                     [ Redirect-Host-Usage ]
>                                     [ Redirect-Max-Cache-Time ]
>                                    *[ Proxy-Info ]
>                                    *[ Route-Record ]
>                                    *[ Failed-AVP ]
>                                    *[ AVP ]
> 
616,622d660
< 
< 
< Hakala, et al.              Standards Track                    [Page 11]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
630a669,676
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 12]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
648c694,695
<    is described in more detail, with more variations, in section 5.
---
>    is described in more detail, with more variations, in section 5
>    (Section 5).
672,678d718
< 
< 
< Hakala, et al.              Standards Track                    [Page 12]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
683a724,732
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 13]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
723c772
<    1a. The service SHOULD re-use existing AVPs if it can use AVPs
---
>    1a.  The service SHOULD re-use existing AVPs if it can use AVPs
726c775
<    [DIAMBASE].
---
>    [DIAMBASE] [RFC3588].
727a777,779
>    For AVPs of type Enumerated, the service may require a new value to
>    be defined.  Allocation of new AVP values is done as specified in
>    [DIAMBASE] [RFC3588], section 1.2.
730,732d781
< Hakala, et al.              Standards Track                    [Page 13]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
735,737c784,786
<    For AVPs of type Enumerated, the service may require a new value to
<    be defined.  Allocation of new AVP values is done as specified in
<    [DIAMBASE], section 1.2.
---
> Hakala, et al.          Expires February 2, 2006               [Page 14]
> 
> Internet-Draft              Abbreviated Title                August 2005
739c788,789
<    1b. New AVPs can be defined if the existing AVPs do not provide
---
> 
>    1b.  New AVPs can be defined if the existing AVPs do not provide
741c791
<    in [DIAMBASE] for creating new AVPs MUST be followed.
---
>    in [DIAMBASE] [RFC3588] for creating new AVPs MUST be followed.
743c793
<    1c. For services specific only to one vendor's implementation, a
---
>    1c.  For services specific only to one vendor's implementation, a
746c796,797
<    allocation of global AVPs is encouraged instead; refer to [DIAMBASE].
---
>    allocation of global AVPs is encouraged instead; refer to [DIAMBASE]
>    [RFC3588].
748d798
<    2. The Service-Parameter-Info AVP MAY be used as a container to pass
753c803
<    section 8.43.
---
>    section 8.43 (Section 8.43).
782,790d831
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 14]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
796a838,844
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 15]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
802c850
<    [DIAMBASE].
---
>    [DIAMBASE] [RFC3588].
819,820c867,868
<    rules described in [NASREQ] for formatting the Diameter AVP MUST be
<    followed.
---
>    rules described in [NASREQ] [RFC4005] for formatting the Diameter AVP
>    MUST be followed.
837a886,887
>    control).  In this case, the credit-control server MUST maintain the
>    credit-control session state.
838a889,891
>    Each credit-control session MUST have a globally unique Session-Id as
>    defined in [DIAMBASE] [RFC3588], which MUST NOT be changed during the
>    lifetime of a credit-control session.
842,845d894
< Hakala, et al.              Standards Track                    [Page 15]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
847,848c896,898
<    control).  In this case, the credit-control server MUST maintain the
<    credit-control session state.
---
> Hakala, et al.          Expires February 2, 2006               [Page 16]
> 
> Internet-Draft              Abbreviated Title                August 2005
850,852d899
<    Each credit-control session MUST have a globally unique Session-Id as
<    defined in [DIAMBASE], which MUST NOT be changed during the lifetime
<    of a credit-control session.
885,901c932,936
<    the Validity-Time, as defined in section 13).  Since credit-control
<    update requests are also produced at the expiry of granted service
<    units and/or for mid-session service events, the omission of
<    Validity-Time does not mean that intermediate interrogation for the
<    purpose of credit-control is not performed.
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 16]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
>    the Validity-Time, as defined in section 13 (Section 13)).  Since
>    credit-control update requests are also produced at the expiry of
>    granted service units and/or for mid-session service events, the
>    omission of Validity-Time does not mean that intermediate
>    interrogation for the purpose of credit-control is not performed.
913a949,956
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 17]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
951,958d993
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 17]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
969a1005,1012
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 18]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
977,1012c1020,1048
<    Identifier, and subject to the same cost and rating type (e.g.,
<    $0.1/minute).  It is assumed that the service element is provided
<    with Rating-Groups, Service-Identifiers, and their associated
<    parameters that define what has to be metered by means outside the
<    scope of this specification.  (Examples of parameters associated to
<    Service-Identifiers are IP 5-tuple and HTTP URL.) Service-Identifiers
<    enable authorization on a per-service based credit as well as
<    itemized reporting of service usage.  It is up to the credit-control
<    server whether to authorize credit for one or more services or for
<    the whole rating-group.  However, the client SHOULD always report
<    used units at the finest supported level of granularity.  Where quota
<    is allocated to a rating-group, all the services belonging to that
<    group draw from the allotted quota.  The following is a graphical
<    representation of the relationship between service-identifiers,
<    rating-groups, credit pools, and credit-control (sub-)session.
< 
<                           DCC (Sub-)Session
<                                   |
<          +------------+-----------+-------------+--------------- +
<          |            |           |             |                |
<    Service-Id a Service-Id b Service-Id c Service-Id d.....Service-Id z
<         \        /                 \         /                /
<          \      /                   \       /                /
<           \    /                  Rating-Group 1.......Rating-Group n
<            \  /                         |                    |
<           Quota       ---------------Quota                 Quota
<             |        /                                       |
<             |       /                                        |
<          Credit-Pool                                    Credit-Pool
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 18]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    Identifier, and subject to the same cost and rating type (e.g., $0.1/
>    minute).  It is assumed that the service element is provided with
>    Rating-Groups, Service-Identifiers, and their associated parameters
>    that define what has to be metered by means outside the scope of this
>    specification.  (Examples of parameters associated to Service-
>    Identifiers are IP 5-tuple and HTTP URL.)  Service-Identifiers enable
>    authorization on a per-service based credit as well as itemized
>    reporting of service usage.  It is up to the credit-control server
>    whether to authorize credit for one or more services or for the whole
>    rating-group.  However, the client SHOULD always report used units at
>    the finest supported level of granularity.  Where quota is allocated
>    to a rating-group, all the services belonging to that group draw from
>    the allotted quota.  The following is a graphical representation of
>    the relationship between service-identifiers, rating-groups, credit
>    pools, and credit-control (sub-)session.
> 
>                            DCC (Sub-)Session
>                                    |
>           +------------+-----------+-------------+--------------- +
>           |            |           |             |                |
>     Service-Id a Service-Id b Service-Id c Service-Id d.....Service-Id z
>          \        /                 \         /                /
>           \      /                   \       /                /
>            \    /                  Rating-Group 1.......Rating-Group n
>             \  /                         |                    |
>            Quota       ---------------Quota                 Quota
>              |        /                                       |
>              |       /                                        |
>           Credit-Pool                                    Credit-Pool
1023a1060,1068
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 19]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1059,1069c1104
<          C1*M1 + C2*M2 + ... + Cn*Mn >= S
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 19]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
>             C1*M1 + C2*M2 + ... + Cn*Mn >= S
1074c1109
<          S = Q1*M1 + Q2*M2 + ... + Qn*Mn
---
>             S = Q1*M1 + Q2*M2 + ... + Qn*Mn
1081a1117,1124
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 20]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1086,1093c1129,1137
<    Where multiple G-S-U-Pool-Reference AVPs (section 8.30) with the same
<    G-S-U-Pool-Identifier are provided within a Multiple-Services-
<    Credit-Control AVP (section 8.16) along with the Granted-Service-Unit
<    AVP, then these MUST have different CC-Unit-Type values, and they all
<    draw from the credit pool separately.  For instance, if one
<    multiplier for time (M1t) and one multiplier for volume (M1v) are
<    given, then the used resources from the pool is the sum C1t*M1t +
<    C1v*M1v, where C1t is the time unit and C1v is the volume unit.
---
>    Where multiple G-S-U-Pool-Reference AVPs (section 8.30
>    (Section 8.30)) with the same G-S-U-Pool-Identifier are provided
>    within a Multiple-Services- Credit-Control AVP (section 8.16
>    (Section 8.16)) along with the Granted-Service-Unit AVP, then these
>    MUST have different CC-Unit-Type values, and they all draw from the
>    credit pool separately.  For instance, if one multiplier for time
>    (M1t) and one multiplier for volume (M1v) are given, then the used
>    resources from the pool is the sum C1t*M1t + C1v*M1v, where C1t is
>    the time unit and C1v is the volume unit.
1102,1105c1146,1149
<    mechanism (the mechanism described in section 5.1.1).  Therefore,
<    Diameter credit-control clients and servers implementing the
<    independent credit-control of multiple services SHOULD leverage the
<    credit pool concept when supporting the tariff time change.  The
---
>    mechanism (the mechanism described in section 5.1.1 (Section 5.1.1)).
>    Therefore, Diameter credit-control clients and servers implementing
>    the independent credit-control of multiple services SHOULD leverage
>    the credit pool concept when supporting the tariff time change.  The
1117a1162,1172
>    The failure handling for credit-control sessions is defined in
>    section 5.7 (Section 5.7) and reflected in the basic credit-control
>    state machine in section 7 (Section 7).  Credit-control clients and
>    servers implementing the independent credit-control of multiple
>    services in a (sub-)session functionality MUST ensure failure
>    handling and general behavior fully consistent with the above
>    mentioned sections, while maintaining the ability to handle parallel
>    ongoing credit re-authorization within a (sub-)session.  Therefore,
>    it is RECOMMENDED that Diameter credit- control clients maintain a
>    PendingU message queue and restart the Tx timer (section 13
>    (Section 13)) every time a CCR message with the value UPDATE_REQUEST
1121,1122c1176
< 
< Hakala, et al.              Standards Track                    [Page 20]
---
> Hakala, et al.          Expires February 2, 2006               [Page 21]
1124c1178
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1127,1140c1181,1184
<    The failure handling for credit-control sessions is defined in
<    section 5.7 and reflected in the basic credit-control state machine
<    in section 7.  Credit-control clients and servers implementing the
<    independent credit-control of multiple services in a (sub-)session
<    functionality MUST ensure failure handling and general behavior fully
<    consistent with the above mentioned sections, while maintaining the
<    ability to handle parallel ongoing credit re-authorization within a
<    (sub-)session.  Therefore, it is RECOMMENDED that Diameter credit-
<    control clients maintain a PendingU message queue and restart the Tx
<    timer (section 13) every time a CCR message with the value
<    UPDATE_REQUEST is sent while they are in PendingU state.  When
<    answers to all pending messages are received, the state machine moves
<    to OPEN state, and Tx is stopped.  Naturally, the action performed
<    when a problem for the session is detected according to section 5.7
---
>    is sent while they are in PendingU state.  When answers to all
>    pending messages are received, the state machine moves to OPEN state,
>    and Tx is stopped.  Naturally, the action performed when a problem
>    for the session is detected according to section 5.7 (Section 5.7)
1164,1168c1208,1212
<    cost) the monetary amount to be charged is included in the
<    Requested-Service-Unit AVP.  If the Diameter credit-control client
<    does not know the cost of the service event, the Requested-Service-
<    Unit AVP MAY contain the number of requested service events.  Where
<    the Multiple-Services-Credit-Control AVP is used, it MUST contain the
---
>    cost) the monetary amount to be charged is included in the Requested-
>    Service-Unit AVP.  If the Diameter credit-control client does not
>    know the cost of the service event, the Requested-Service- Unit AVP
>    MAY contain the number of requested service events.  Where the
>    Multiple-Services-Credit-Control AVP is used, it MUST contain the
1174,1182d1217
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 21]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
1194,1195c1229,1238
<    access device.  How the credit-control server uses this information
<    is outside the scope of this document.
---
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 22]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    access device.  How the credit-control server uses this information
>    is outside the scope of this document.
1231,1238d1273
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 22]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
1241c1276
<    section 5.6.
---
>    section 5.6 (Section 5.6).
1249a1285,1292
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 23]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1267,1275c1310,1318
<    scenarios, there is a substantial decoupling between
<    registration/access to the network and the actual service request
<    (i.e., the authentication/authorization is executed once at
<    registration/access to the network and is not executed for every
<    service event requested by the subscriber).  In these environments,
<    it is more appropriate to perform the first interrogation after the
<    user has been authenticated and authorized.  The first, the
<    intermediate, and the final interrogations are executed with credit-
<    control commands defined in this specification.
---
>    scenarios, there is a substantial decoupling between registration/
>    access to the network and the actual service request (i.e., the
>    authentication/authorization is executed once at registration/access
>    to the network and is not executed for every service event requested
>    by the subscriber).  In these environments, it is more appropriate to
>    perform the first interrogation after the user has been authenticated
>    and authorized.  The first, the intermediate, and the final
>    interrogations are executed with credit- control commands defined in
>    this specification.
1287,1294d1329
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 23]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
1304,1338d1338
<                                            Diameter
<    End User        Service Element        AAA Server         CC Server
<                      (CC Client)
<       | Registration      | AA request/answer(accounting,cc or both)|
<       |<----------------->|<------------------>|                    |
<       |        :          |                    |                    |
<       |        :          |                    |                    |
<       | Service Request   |                    |                    |
<       |------------------>|                    |                    |
<       |                   | CCR(Initial,Credit-Control AVPs)        |
<       |                  +|---------------------------------------->|
<       |         CC stream||                    |  CCA(Granted-Units)|
<       |                  +|<----------------------------------------|
<       | Service Delivery  |                    |                    |
<       |<----------------->| ACR(start,Accounting AVPs)              |
<       |         :         |------------------->|+                   |
<       |         :         |                ACA || Accounting stream |
<       |                   |<-------------------|+                   |
<       |         :         |                    |                    |
<       |         :         |                    |                    |
<       |                   | CCR(Update,Used-Units)                  |
<       |                   |---------------------------------------->|
<       |                   |                    |  CCA(Granted-Units)|
<       |                   |<----------------------------------------|
<       |         :         |                    |                    |
<       |         :         |                    |                    |
<       | End of Service    |                    |                    |
<       |------------------>| CCR(Termination, Used-Units)            |
<       |                   |---------------------------------------->|
<       |                   |                    |               CCA  |
<       |                   |<----------------------------------------|
<       |                   | ACR(stop)          |                    |
<       |                   |------------------->|                    |
<       |                   |                ACA |                    |
<       |                   |<-------------------|                    |
1340,1341d1339
<     Figure 2: Protocol example with first interrogation after user's
<                       authorization/authentication
1346c1344
< Hakala, et al.              Standards Track                    [Page 24]
---
> Hakala, et al.          Expires February 2, 2006               [Page 24]
1348c1346
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1350a1349,1387
>                                              Diameter
>      End User        Service Element        AAA Server         CC Server
>                        (CC Client)
>         | Registration      | AA request/answer(accounting,cc or both)|
>         |<----------------->|<------------------>|                    |
>         |        :          |                    |                    |
>         |        :          |                    |                    |
>         | Service Request   |                    |                    |
>         |------------------>|                    |                    |
>         |                   | CCR(Initial,Credit-Control AVPs)        |
>         |                  +|---------------------------------------->|
>         |         CC stream||                    |  CCA(Granted-Units)|
>         |                  +|<----------------------------------------|
>         | Service Delivery  |                    |                    |
>         |<----------------->| ACR(start,Accounting AVPs)              |
>         |         :         |------------------->|+                   |
>         |         :         |                ACA || Accounting stream |
>         |                   |<-------------------|+                   |
>         |         :         |                    |                    |
>         |         :         |                    |                    |
>         |                   | CCR(Update,Used-Units)                  |
>         |                   |---------------------------------------->|
>         |                   |                    |  CCA(Granted-Units)|
>         |                   |<----------------------------------------|
>         |         :         |                    |                    |
>         |         :         |                    |                    |
>         | End of Service    |                    |                    |
>         |------------------>| CCR(Termination, Used-Units)            |
>         |                   |---------------------------------------->|
>         |                   |                    |               CCA  |
>         |                   |<----------------------------------------|
>         |                   | ACR(stop)          |                    |
>         |                   |------------------->|                    |
>         |                   |                ACA |                    |
>         |                   |<-------------------|                    |
> 
>     Figure 2: Figure 2: Protocol example with first interrogation after
>                     user's authorization/authentication
> 
1358,1363c1395,1408
<    relevant credit-control specific AVPs to the proper
<    authorization/authentication command to perform the first
<    interrogation toward the home Diameter AAA server.  The Auth-
<    Application-Id is set to the appropriate value, as defined in the
<    relevant service specific authorization/authentication application
<    document (e.g., [NASREQ], [DIAMMIP]).  The home Diameter AAA server
---
>    relevant credit-control specific AVPs to the proper authorization/
>    authentication command to perform the first interrogation toward the
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 25]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    home Diameter AAA server.  The Auth- Application-Id is set to the
>    appropriate value, as defined in the relevant service specific
>    authorization/authentication application document (e.g., [NASREQ]
>    [RFC4005], [DIAMMIP] [RFC4004]).  The home Diameter AAA server
1396,1409c1441,1446
<    specific application (e.g., [NASREQ], [DIAMMIP]).  It will then
<    forward the packet to the credit-control client.  If the home
<    Diameter AAA server receives a credit-control reject message, it will
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 25]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    simply generate an appropriate authorization reject message to the
<    credit-control client, including the credit-control specific error
<    code.
---
>    specific application (e.g., [NASREQ] [RFC4005], [DIAMMIP] [RFC4004]).
>    It will then forward the packet to the credit-control client.  If the
>    home Diameter AAA server receives a credit-control reject message, it
>    will simply generate an appropriate authorization reject message to
>    the credit-control client, including the credit-control specific
>    error code.
1415a1453,1460
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 26]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1419c1464
<    section 8.2).
---
>    section 8.2 (Section 8.2)).
1424,1431c1469,1476
<    AVP with a value set to RE_AUTHORIZATION to indicate that the
<    credit-control server MUST NOT be contacted.  When session based
<    credit-control is used for the subscriber, a constant credit-control
<    message stream flows through the home Diameter AAA server.  The home
<    Diameter AAA server can make use of this credit-control message flow
<    to deduce that the user's activity is ongoing; therefore, it is
<    recommended to set the authorization-lifetime to a reasonably high
<    value when credit-control is used for the subscriber.
---
>    AVP with a value set to RE_AUTHORIZATION to indicate that the credit-
>    control server MUST NOT be contacted.  When session based credit-
>    control is used for the subscriber, a constant credit-control message
>    stream flows through the home Diameter AAA server.  The home Diameter
>    AAA server can make use of this credit-control message flow to deduce
>    that the user's activity is ongoing; therefore, it is recommended to
>    set the authorization-lifetime to a reasonably high value when
>    credit-control is used for the subscriber.
1436a1482,1487
>    The following diagram illustrates the use of authorization/
>    authentication messages to perform the first interrogation.  The
>    parallel accounting stream is not shown in the figure.
> 
> 
> 
1458,1460d1508
< Hakala, et al.              Standards Track                    [Page 26]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
1463,1466c1511,1515
<    The following diagram illustrates the use of
<    authorization/authentication messages to perform the first
<    interrogation.  The parallel accounting stream is not shown in the
<    figure.
---
> 
> Hakala, et al.          Expires February 2, 2006               [Page 27]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
1499,1500c1548,1549
<                 Figure 3: Protocol example with use of the
<            authorization messages for the first interrogation
---
>     Figure 3: Figure 3: Protocol example with use of the authorization
>                    messages for the first interrogation
1510a1560,1564
>    credit reservation has been wholly consumed, or upon expiration of
>    the Validity-Time.  It is always up to the Diameter credit-control
>    client to send a new request well in advance of the expiration of the
>    previous request in order to avoid interruption in the service
>    element.  Even if the granted service units reserved by the credit-
1514c1568
< Hakala, et al.              Standards Track                    [Page 27]
---
> Hakala, et al.          Expires February 2, 2006               [Page 28]
1516c1570
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1519,1523d1572
<    credit reservation has been wholly consumed, or upon expiration of
<    the Validity-Time.  It is always up to the Diameter credit-control
<    client to send a new request well in advance of the expiration of the
<    previous request in order to avoid interruption in the service
<    element.  Even if the granted service units reserved by the credit-
1565a1615,1619
>    The credit-control server MUST deduct the used amount from the end
>    user's account.  It MAY rate the new request and make a new credit-
>    reservation from the end user's account that covers the cost of the
>    requested service event.
> 
1570c1624
< Hakala, et al.              Standards Track                    [Page 28]
---
> Hakala, et al.          Expires February 2, 2006               [Page 29]
1572c1626
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1575,1579d1628
<    The credit-control server MUST deduct the used amount from the end
<    user's account.  It MAY rate the new request and make a new credit-
<    reservation from the end user's account that covers the cost of the
<    requested service event.
< 
1589c1638
<    section 5.6.
---
>    section 5.6 (Section 5.6).
1596,1601c1645,1650
<    graceful service termination described in section 5.6 takes place,
<    the Diameter credit-control client MUST send a final Credit-Control-
<    Request message to the credit-control server.  The CC-Request-Type
<    AVP is set to the value TERMINATION_REQUEST.  The Service-Context-Id
<    AVP indicates the service specific document applicable to the
<    request.
---
>    graceful service termination described in section 5.6 (Section 5.6)
>    takes place, the Diameter credit-control client MUST send a final
>    Credit-Control- Request message to the credit-control server.  The
>    CC-Request-Type AVP is set to the value TERMINATION_REQUEST.  The
>    Service-Context-Id AVP indicates the service specific document
>    applicable to the request.
1623a1673,1677
>    unit indication causes user logoff according to local policy), the
>    service element, according to application specific policy, may send a
>    Session-Termination-Request (STR) to the home Diameter AAA server as
>    usual [DIAMBASE] [RFC3588].  Figure 4 illustrates the case when the
> 
1626c1680
< Hakala, et al.              Standards Track                    [Page 29]
---
> Hakala, et al.          Expires February 2, 2006               [Page 30]
1628c1682
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1631,1664c1685,1714
<    unit indication causes user logoff according to local policy), the
<    service element, according to application specific policy, may send a
<    Session-Termination-Request (STR) to the home Diameter AAA server as
<    usual [DIAMBASE].  Figure 4 illustrates the case when the final-unit
<    indication causes user logoff upon consumption of the final granted
<    units and the generation of STR.
< 
<                    Service Element        AAA Server        CC Server
<    End User         (CC Client)
<       | Service Delivery  |                    |                    |
<       |<----------------->|                    |                    |
<       |         :         |                    |                    |
<       |         :         |                    |                    |
<       |         :         |                    |                    |
<       |                   |                    |                    |
<       |                   | CCR(Update,Used-Units)                  |
<       |                   |------------------->| CCR(Update,Used-Units)
<       |                   |                    |------------------->|
<       |                   |                  CCA(Final-Unit, Terminate)
<       |              CCA(Final-Unit, Terminate)|<-------------------|
<       |                   |<-------------------|                    |
<       |         :         |                    |                    |
<       |         :         |                    |                    |
<       |  Disconnect user  |                    |                    |
<       |<------------------| CCR(Termination,Used-Units)             |
<       |                   |------------------->| CCR(Term.,Used-Units)
<       |                   |                    |------------------->|
<       |                   |                    |                CCA |
<       |                   |                CCA |<-------------------|
<       |                   |<-------------------|                    |
<       |                   | STR                |                    |
<       |                   |------------------->|                    |
<       |                   |               STA  |                    |
<       |                   |<-------------------|                    |
---
>    final-unit indication causes user logoff upon consumption of the
>    final granted units and the generation of STR.
> 
>                     Service Element        AAA Server        CC Server
>     End User         (CC Client)
>        | Service Delivery  |                    |                    |
>        |<----------------->|                    |                    |
>        |         :         |                    |                    |
>        |         :         |                    |                    |
>        |         :         |                    |                    |
>        |                   |                    |                    |
>        |                   | CCR(Update,Used-Units)                  |
>        |                   |------------------->| CCR(Update,Used-Units)
>        |                   |                    |------------------->|
>        |                   |                  CCA(Final-Unit, Terminate)
>        |              CCA(Final-Unit, Terminate)|<-------------------|
>        |                   |<-------------------|                    |
>        |         :         |                    |                    |
>        |         :         |                    |                    |
>        |  Disconnect user  |                    |                    |
>        |<------------------| CCR(Termination,Used-Units)             |
>        |                   |------------------->| CCR(Term.,Used-Units)
>        |                   |                    |------------------->|
>        |                   |                    |                CCA |
>        |                   |                CCA |<-------------------|
>        |                   |<-------------------|                    |
>        |                   | STR                |                    |
>        |                   |------------------->|                    |
>        |                   |               STA  |                    |
>        |                   |<-------------------|                    |
1666c1716
<            Figure 4: User disconnected due to exhausted account
---
>       Figure 4: Figure 4: User disconnected due to exhausted account
1670,1673c1720,1723
<    The Diameter credit-control application supports server-initiated
<    re-authorization.  The credit-control server MAY optionally initiate
<    the credit re-authorization by issuing a Re-Auth-Request (RAR) as
<    defined in the Diameter base protocol [DIAMBASE].  The Auth-
---
>    The Diameter credit-control application supports server-initiated re-
>    authorization.  The credit-control server MAY optionally initiate the
>    credit re-authorization by issuing a Re-Auth-Request (RAR) as defined
>    in the Diameter base protocol [DIAMBASE] [RFC3588].  The Auth-
1677a1728,1732
>    Section 5.1.2 (Section 5.1.2) defines the feature to enable credit-
>    control for multiple services within a single (sub-)session where the
>    server can authorize credit usage at a different level of
>    granularity.  Further, the server may provide credit resources to
>    multiple services or rating groups as a pool (see section 5.1.2
1681,1703c1736,1752
< 
< Hakala, et al.              Standards Track                    [Page 30]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    Section 5.1.2 defines the feature to enable credit-control for
<    multiple services within a single (sub-)session where the server can
<    authorize credit usage at a different level of granularity.  Further,
<    the server may provide credit resources to multiple services or
<    rating groups as a pool (see section 5.1.2 for details and
<    definitions).  Therefore, the server, based on its service logic and
<    its knowledge of the ongoing session, can decide to request credit
<    re-authorization for a whole (sub-)session, a single credit pool, a
<    single service, or a single rating-group.  To request credit re-
<    authorization for a credit pool, the server includes in the RAR
<    message the G-S-U-Pool-Identifier AVP indicating the affected pool.
<    To request credit re-authorization for a service or a rating-group,
<    the server includes in the RAR message the Service-Identifier AVP or
<    the Rating-Group AVP, respectively.  To request credit re-
<    authorization for all the ongoing services within the (sub-)session,
<    the server includes none of the above mentioned AVPs in the RAR
<    message.
---
> Hakala, et al.          Expires February 2, 2006               [Page 31]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    (Section 5.1.2) for details and definitions).  Therefore, the server,
>    based on its service logic and its knowledge of the ongoing session,
>    can decide to request credit re-authorization for a whole
>    (sub-)session, a single credit pool, a single service, or a single
>    rating-group.  To request credit re- authorization for a credit pool,
>    the server includes in the RAR message the G-S-U-Pool-Identifier AVP
>    indicating the affected pool.  To request credit re-authorization for
>    a service or a rating-group, the server includes in the RAR message
>    the Service-Identifier AVP or the Rating-Group AVP, respectively.  To
>    request credit re- authorization for all the ongoing services within
>    the (sub-)session, the server includes none of the above mentioned
>    AVPs in the RAR message.
1734a1784,1788
>    consider the server initiated credit re-authorization process
>    successful upon reception of the Re-Auth-Answer message.
> 
>    When multiple services are supported in a user's session, the server
>    may request credit re-authorization for a credit pool (or for the
1738c1792
< Hakala, et al.              Standards Track                    [Page 31]
---
> Hakala, et al.          Expires February 2, 2006               [Page 32]
1740,1741c1794
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
> Internet-Draft              Abbreviated Title                August 2005
1743,1744d1795
<    consider the server initiated credit re-authorization process
<    successful upon reception of the Re-Auth-Answer message.
1746,1747d1796
<    When multiple services are supported in a user's session, the server
<    may request credit re-authorization for a credit pool (or for the
1790a1840,1844
>    access capability only to/from the specified destinations.  All the
>    IP packets not matching the filters will be dropped or, possibly, re-
>    directed to the service portal.  The user may also be sent an
>    appropriate notification as to why the access has been limited.
>    These actions may be communicated explicitly from the server to the
1794c1848
< Hakala, et al.              Standards Track                    [Page 32]
---
> Hakala, et al.          Expires February 2, 2006               [Page 33]
1796c1850
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
1799,1803d1852
<    access capability only to/from the specified destinations.  All the
<    IP packets not matching the filters will be dropped or, possibly,
<    re-directed to the service portal.  The user may also be sent an
<    appropriate notification as to why the access has been limited.
<    These actions may be communicated explicitly from the server to the
1810,1814c1859,1862
<    prompts the user to replenish the account.  In this case, the
<    credit-control server sends only the address of the top-up server
<    where the prepaid user shall be connected after the final granted
<    units have been consumed.  An example of this is given in Appendix A
<    (Flow VII).
---
>    prompts the user to replenish the account.  In this case, the credit-
>    control server sends only the address of the top-up server where the
>    prepaid user shall be connected after the final granted units have
>    been consumed.  An example of this is given in Appendix A (Flow VII).
1817,1819c1865,1867
<    termination by including the Final-Unit-Indication AVP in the
<    Credit-Control-Answer to indicate that the message contains the final
<    units for the service.
---
>    termination by including the Final-Unit-Indication AVP in the Credit-
>    Control-Answer to indicate that the message contains the final units
>    for the service.
1829,1854d1876
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 33]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
1878a1901,1908
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 34]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1903,1911c1933
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 34]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<          Figure 5: Optional graceful service termination procedure
---
>     Figure 5: Figure 5: Optional graceful service termination procedure
1933a1956,1964
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 35]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
1956,1965c1987
<    is considered in section 5.6.3.
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 35]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
>    is considered in section 5.6.3 (Section 5.6.3).
1990a2013,2020
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 36]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2000,2005c2030,2035
<    appropriate Result-Code (see section 9.1) in the Credit-Control-
<    Answer message in order to implement the policy-defined action.
<    Otherwise, new quota will be returned, the service element MUST
<    remove all the possible restrictions activated by the graceful
<    service termination process and continue the credit-control session
<    and service session as usual.
---
>    appropriate Result-Code (see section 9.1 (Section 9.1)) in the
>    Credit-Control- Answer message in order to implement the policy-
>    defined action.  Otherwise, new quota will be returned, the service
>    element MUST remove all the possible restrictions activated by the
>    graceful service termination process and continue the credit-control
>    session and service session as usual.
2013,2022d2042
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 36]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2048a2069,2076
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 37]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2071,2078d2098
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 37]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2091,2100c2111,2120
<    authorization (see section 5.5).  In such a case, upon the successful
<    account top-up, the credit-control server sends the Re-Auth-Request
<    (RAR) message to solicit the credit re-authorization.  The credit-
<    control client initiates the credit re-authorization by sending the
<    Credit-Control-Request message with the CC-Request-Type AVP set to
<    the value UPDATE_REQUEST.  The Used-Service-Unit AVP is not included
<    in the request, as there is no allotted quota to report.  The
<    Requested-Service-Unit AVP MAY be included in the request.  After the
<    credit-control client successfully receives the Credit-Control-Answer
<    with new Granted-Service-Unit, all the possible restrictions
---
>    authorization (see section 5.5 (Section 5.5)).  In such a case, upon
>    the successful account top-up, the credit-control server sends the
>    Re-Auth-Request (RAR) message to solicit the credit re-authorization.
>    The credit- control client initiates the credit re-authorization by
>    sending the Credit-Control-Request message with the CC-Request-Type
>    AVP set to the value UPDATE_REQUEST.  The Used-Service-Unit AVP is
>    not included in the request, as there is no allotted quota to report.
>    The Requested-Service-Unit AVP MAY be included in the request.  After
>    the credit-control client successfully receives the Credit-Control-
>    Answer with new Granted-Service-Unit, all the possible restrictions
2104a2125,2132
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 38]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2119,2121c2147,2149
<    [DIAMBASE].  It is RECOMMENDED that the client complement the
<    credit-control failure procedures with backup accounting flow toward
<    an accounting server.  By using different combinations of
---
>    [DIAMBASE] [RFC3588].  It is RECOMMENDED that the client complement
>    the credit-control failure procedures with backup accounting flow
>    toward an accounting server.  By using different combinations of
2128,2134d2155
< 
< 
< Hakala, et al.              Standards Track                    [Page 38]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2152c2173
<    is detected with a peer, as described in [DIAMBASE].  As a
---
>    is detected with a peer, as described in [DIAMBASE] [RFC3588].  As a
2156,2157c2177,2187
<    server session state machine (section 7), Session-Id AVP, and CC-
<    Request-Number AVP.
---
>    server session state machine (section 7 (Section 7)), Session-Id AVP,
>    and CC- Request-Number AVP.
> 
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 39]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
2183,2190d2212
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 39]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2200,2203c2222,2225
<    credit-control client (as defined in section 13) to supervise the
<    communication with the credit-control server.  When the timer Tx
<    elapses, the credit-control client takes an action to the end user
<    according to the Credit-Control-Failure-Handling AVP.
---
>    credit-control client (as defined in section 13 (Section 13)) to
>    supervise the communication with the credit-control server.  When the
>    timer Tx elapses, the credit-control client takes an action to the
>    end user according to the Credit-Control-Failure-Handling AVP.
2214a2237,2244
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 40]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2218c2248
<    default value is 3 times more than the Tx recommended value.) The
---
>    default value is 3 times more than the Tx recommended value.)  The
2240,2246d2269
< 
< 
< Hakala, et al.              Standards Track                    [Page 40]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2251,2252c2274,2276
<    The supervision session timer Tcc (as defined in section 13) is used
<    in the credit-control server to supervise the credit-control session.
---
>    The supervision session timer Tcc (as defined in section 13
>    (Section 13)) is used in the credit-control server to supervise the
>    credit-control session.
2256,2257c2280,2281
<    state SHOULD take place between the primary and the secondary
<    credit-control server.  Implementations supporting the credit-control
---
>    state SHOULD take place between the primary and the secondary credit-
>    control server.  Implementations supporting the credit-control
2269a2294,2300
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 41]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2273c2304
<    service units on the user's account or for direct debiting without
---
>    service units on the user's account or for direct debiting withouts
2276,2287c2307,2319
<                                            Diameter
<    End User        Service Element        AAA Server        CC Server
<                      (CC Client)
<       | Service Request   |                    |                    |
<       |------------------>|                    |                    |
<       |                   | CCR(Event)         |                    |
<       |                   |------------------->| CCR(Event)         |
<       |                   |                    |------------------->|
<       |                   |                    |  CCA(Granted-Units)|
<       |                   |  CCA(Granted-Units)|<-------------------|
<       |  Service Delivery |<-------------------|                    |
<       |<----------------->|                    |                    |
---
>                                               Diameter
>       End User        Service Element        AAA Server        CC Server
>                         (CC Client)
>          | Service Request   |                    |                    |
>          |------------------>|                    |                    |
>          |                   | CCR(Event)         |                    |
>          |                   |------------------->| CCR(Event)         |
>          |                   |                    |------------------->|
>          |                   |                    |  CCA(Granted-Units)|
>          |                   |  CCA(Granted-Units)|<-------------------|
>          |  Service Delivery |<-------------------|                    |
>          |<----------------->|                    |                    |
> 
2294a2327
> 6.1.  Service Price Enquiry
2296,2305c2329
< 
< 
< Hakala, et al.              Standards Track                    [Page 41]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< 6.1.  Service Price Enquiry
< 
<    The credit-control client may need to know the price of the service
---
>    The credit-control client may need to know the price of the services
2323a2348,2356
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 42]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2351,2358d2383
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 42]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2379a2405,2412
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 43]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2407,2414d2439
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 43]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2435a2461,2468
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 44]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2454,2458c2487,2491
<    failure is detected with a peer, as described in [DIAMBASE].  Because
<    there can be duplicate requests for various reasons, the credit-
<    control server is responsible for real time duplicate detection.
<    Implementation issues for duplicate detection are discussed in
<    [DIAMBASE], Appendix C.
---
>    failure is detected with a peer, as described in [DIAMBASE]
>    [RFC3588].  Because there can be duplicate requests for various
>    reasons, the credit- control server is responsible for real time
>    duplicate detection.  Implementation issues for duplicate detection
>    are discussed in [DIAMBASE] [RFC3588], Appendix C.
2462,2471c2495,2496
<    action.  The timer Tx (as defined in section 13) is used in the
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 44]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    credit-control client to supervise the communication with the
---
>    action.  The timer Tx (as defined in section 13 (Section 13)) is used
>    in the credit-control client to supervise the communication with the
2490a2516,2524
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 45]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2502,2503c2536,2537
<    setting the T-flag in the command header as described in [DIAMBASE],
<    section 3.
---
>    setting the T-flag in the command header as described in [DIAMBASE]
>    [RFC3588], section 3 (Section 3).
2516,2527c2550,2551
<    TERMINATE_OR_BUFFER.  If a failed answer is received for the
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 45]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    re-transmitted request, the credit-control client frees all the
---
>    TERMINATE_OR_BUFFER.  If a failed answer is received for the re-
>    transmitted request, the credit-control client frees all the
2536c2560
<    [DIAMBASE], section 3.
---
>    [DIAMBASE] [RFC3588], section 3 (Section 3).
2547a2572,2580
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 46]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2562c2595
<    5.2.
---
>    5.2 (Section 5.2).
2573,2582d2605
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 46]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2597,2601c2620,2624
<    DIAMETER_UNABLE_TO_DELIVER, or DIAMETER_LOOP_DETECTED) in the
<    Result-Code AVP of the Credit-Control-Answer command.  The above
<    protocol error notification may ultimately be received in answer to
<    the re-transmitted request to a defined alternative destination, if
<    failover is supported.
---
>    DIAMETER_UNABLE_TO_DELIVER, or DIAMETER_LOOP_DETECTED) in the Result-
>    Code AVP of the Credit-Control-Answer command.  The above protocol
>    error notification may ultimately be received in answer to the re-
>    transmitted request to a defined alternative destination, if failover
>    is supported.
2605a2629,2636
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 47]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
2615c2646
<    user, account being empty, or errors defined in [DIAMBASE].
---
>    user, account being empty, or errors defined in [DIAMBASE] [RFC3588].
2620c2651,2652
<    information about the termination reason, as specified in [DIAMBASE].
---
>    information about the termination reason, as specified in [DIAMBASE]
>    [RFC3588].
2629,2638d2660
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 47]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
2651c2673,2674
<    AVP is set to FAILOVER_SUPPORTED, as described in section 5.7.
---
>    AVP is set to FAILOVER_SUPPORTED, as described in section 5.7
>    (Section 5.7).
2654,2664c2677
<    supported as described in section 6.5.
< 
<    CLIENT, SESSION BASED for the first interrogation with AA request
< 
<     State      Event                         Action       New State
<     ---------------------------------------------------------------
<     Idle       Client or device requests     Send          PendingI
<                access/service                AA request
<                                              with added
<                                              CC AVPs,
<                                              start Tx
---
>    supported as described in section 6.5 (Section 6.5).
2666,2669d2678
<     PendingI  Successful AA req.             Grant         Open
<               answer received                service to
<                                              end user,
<                                              stop Tx
2671,2672d2679
<     PendingI  Tx expired                     Disconnect    Idle
<                                              user/dev
2674,2675d2680
<     PendingI  Failed AA answer received      Disconnect    Idle
<                                              user/dev
2677,2680d2681
<     PendingI  AA answer                      Grant         Idle
<               received with result code      service
<               equal to CREDIT_CONTROL_       to end user
<               NOT_APPLICABLE
2682,2684d2682
<     PendingI  User service terminated        Queue         PendingI
<                                              termination
<                                              event
2690c2688
< Hakala, et al.              Standards Track                    [Page 48]
---
> Hakala, et al.          Expires February 2, 2006               [Page 48]
2692c2690
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
2695,2699c2693,2721
<     PendingI  Change in rating condition     Queue         PendingI
<                                              changed
<                                              rating
<                                              condition
<                                              event
---
>    +----------+-------------------------------+-------------+----------+
>    | State    | Event                         | Action      | New      |
>    |          |                               |             | State    |
>    +----------+-------------------------------+-------------+----------+
>    | Idle     | Client or device requests     | Send AA     | PendingI |
>    |          | access/service                | request     |          |
>    |          |                               | with added  |          |
>    |          |                               | CC AVPs,    |          |
>    |          |                               | start Tx    |          |
>    | PendingI | Successful AA req. answer     | Grant       | Open     |
>    |          | received                      | service to  |          |
>    |          |                               | end user,   |          |
>    |          |                               | stop Tx     |          |
>    | PendingI | Tx expired                    | Disconnect  | Idle     |
>    |          |                               | user/dev    |          |
>    | PendingI | Failed AA answer received     | Disconnect  | Idle     |
>    |          |                               | user/dev    |          |
>    | PendingI | AA answer received with       | Grant       | Idle     |
>    |          | result code equal to          | service to  |          |
>    |          | CREDIT_CONTROL_NOT_APPLICABLE | end user    |          |
>    | PendingI | User service terminated       | Queue       | PendingI |
>    |          |                               | termination |          |
>    |          |                               | event       |          |
>    | PendingI | Change in rating condition    | Queue       | PendingI |
>    |          |                               | changed     |          |
>    |          |                               | rating      |          |
>    |          |                               | condition   |          |
>    |          |                               | event       |          |
>    +----------+-------------------------------+-------------+----------+
2701c2723,2724
<       CLIENT, SESSION BASED for the first interrogation with CCR
---
>     Table 2: CLIENT, SESSION BASED for the first interrogation with AA
>                                   request
2703,2704d2725
<     State      Event                          Action       New State
<     ----------------------------------------------------------------
2707,2710d2727
<     Idle      Client or device requests      Send         PendingI
<               access/service                 CC initial
<                                              req.,
<                                              start Tx
2712,2713d2728
<     PendingI  Successful CC initial          Stop Tx      Open
<               answer received
2715,2717d2729
<     PendingI  Failure to send, or            Grant        Idle
<               temporary error and            service to
<               CCFH equal to CONTINUE         end user
2719,2722d2730
<     PendingI  Failure to send, or            Terminate    Idle
<               temporary error and            end user's
<               CCFH equal to TERMINATE        service
<               or to RETRY_AND_TERMINATE
2724,2726d2731
<     PendingI  Tx expired and CCFH            Terminate    Idle
<               equal to TERMINATE             end user's
<                                              service
2728,2730d2732
<     PendingI  Tx expired and CCFH equal      Grant        PendingI
<               to CONTINUE or to              service to
<               RETRY_AND_TERMINATE            end user
2732,2735d2733
<     PendingI  CC initial answer              Terminate    Idle
<               received with result code      end user's
<               END_USER_SERVICE_DENIED or     service
<               USER_UNKNOWN
2737,2740d2734
<     PendingI  CC initial answer              Grant        Idle
<               received with result code      service
<               equal to CREDIT_CONTROL_       to end user
<               NOT_APPLICABLE
2746,2758d2739
< Hakala, et al.              Standards Track                    [Page 49]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<     PendingI  Failed CC initial answer       Grant        Idle
<               received and CCFH equal to     service to
<               CONTINUE                       end user
< 
<     PendingI  Failed CC initial answer       Terminate    Idle
<               received and CCFH equal        end user's
<               to TERMINATE or to             service
<               RETRY_AND_TERMINATE
2760,2762d2740
<     PendingI  User service terminated        Queue        PendingI
<                                              termination
<                                              event
2764,2768d2741
<     PendingI  Change in rating condition     Queue        PendingI
<                                              changed
<                                              rating
<                                              condition
<                                              event
2770d2742
<      CLIENT, SESSION BASED for intermediate and final interrogations
2772,2784c2744,2746
<     State     Event                          Action       New State
<     ----------------------------------------------------------------
< 
<     Open      Granted unit elapses           Send         PendingU
<               and no final unit              CC update
<               indication received            req.,
<                                              start Tx
< 
<     Open      Granted unit elapses           Terminate    PendingT
<               and final unit action          end user's
<               equal to TERMINATE             service, send
<               received                       CC termination
<                                              req.
---
> Hakala, et al.          Expires February 2, 2006               [Page 49]
> 
> Internet-Draft              Abbreviated Title                August 2005
2786,2789d2747
<     Open      Change in rating condition     Send         PendingU
<               in queue                       CC update
<                                              req.,
<                                              Start Tx
2791,2793c2749,2794
<     Open      Service terminated in queue    Send         PendingT
<                                              CC termination
<                                              req.
---
>    +----------+-------------------------------+-------------+----------+
>    | State    | Event                         | Action      | New      |
>    |          |                               |             | State    |
>    +----------+-------------------------------+-------------+----------+
>    | Idle     | Client or device requests     | Send CC     | PendingI |
>    |          | access/service                | initial     |          |
>    |          |                               | req., start |          |
>    |          |                               | Tx          |          |
>    | PendingI | Successful CC intial answer   | Stop Tx     | Open     |
>    |          | received                      |             |          |
>    | PendingI | Failure to send, or temporary | Grant       | Idle     |
>    |          | error and CCFH equal to       | service to  |          |
>    |          | CONTINUE                      | end user    |          |
>    | PendingI | Failure to send, or temporary | Terminate   | Idle     |
>    |          | error and CCFH equal to       | end user's  |          |
>    |          | TERMINATEor to                | service     |          |
>    |          | RETRY_AND_TERMINATE           |             |          |
>    | PendingI | Tx expired and CCFH equal to  | Terminate   | Idle     |
>    |          | TERMINATE                     | end user's  |          |
>    |          |                               | service     |          |
>    | PendingI | Tx expired and CCFH equal to  | Grant       | Idle     |
>    |          | CONTINUE or to                | service to  |          |
>    |          | RETRY_AND_TERMINATE           | end user    |          |
>    | PendingI | CC initial answer received    | Terminate   | Idle     |
>    |          | with result code              | end user's  |          |
>    |          | END_USER_SERVICE_DENIED or    | service     |          |
>    |          | USER_UNKNOWN                  |             |          |
>    | PendingI | CC initial answer received    | Grant       | Idle     |
>    |          | with result code equal to     | service to  |          |
>    |          | CREDIT_CONTROL_NOT_APPLICABLE | end user    |          |
>    | PendingI | Failed CC initial answer      | Grant       | Idle     |
>    |          | received and CCFH equal to    | service to  |          |
>    |          | CONTINUE                      | end user    |          |
>    | PendingI | Failed CC initial answer      | Terminate   | Idle     |
>    |          | received and CCFH equal to    | end user's  |          |
>    |          | TERMINATE or to               | service     |          |
>    |          | RETRY_AND_TERMINATE           |             |          |
>    | PendingI | User service terminated       | Queue       | PendingI |
>    |          |                               | termination |          |
>    |          |                               | event       |          |
>    | PendingI | Change in rating condition    | Queue       | PendingI |
>    |          |                               | changed     |          |
>    |          |                               | rating      |          |
>    |          |                               | condition   |          |
>    |          |                               | event       |          |
>    +----------+-------------------------------+-------------+----------+
2795,2798c2796
<     Open      Change in rating condition     Send         PendingU
<               or Validity-Time elapses       CC update
<                                              req.,
<                                              Start Tx
---
>     Table 3: CLIENT, SESSION BASED for the first interrogation with CCR
2802c2800
< Hakala, et al.              Standards Track                    [Page 50]
---
> Hakala, et al.          Expires February 2, 2006               [Page 50]
2804,2805c2802
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
> Internet-Draft              Abbreviated Title                August 2005
2807,2809d2803
<     Open      User service terminated        Send         PendingT
<                                              CC termination
<                                              req.
2811,2814c2805,2852
<     Open      RAR received                   Send RAA     PendingU
<                                              followed by
<                                              CC update req.,
<                                              start Tx
---
>    +----------+-------------------------------+-------------+----------+
>    | State    | Event                         | Action      | New      |
>    |          |                               |             | State    |
>    +----------+-------------------------------+-------------+----------+
>    | Open     | Granted unit elapses and no   | Send CC     | PendingU |
>    |          | final unit indication         | update req. |          |
>    |          | received                      |             |          |
>    | Open     | Granted unit elapses and      | Terminate   | PendingT |
>    |          | final unit action equal to    | end user's  |          |
>    |          | TERMINATE received            | service,    |          |
>    |          |                               | send CC     |          |
>    |          |                               | termination |          |
>    |          |                               | req.        |          |
>    | Open     | Change in rating condition in | Send CC     | PendingU |
>    |          | queue                         | update      |          |
>    |          |                               | req., Start |          |
>    |          |                               | Tx          |          |
>    | Open     | Service terminated in queue   | Send CC     | PendingT |
>    |          |                               | termination |          |
>    |          |                               | req.        |          |
>    | Open     | Change in rating condition or | Send CC     | PendingU |
>    |          | Validity-Time elapses         | update      |          |
>    |          |                               | req., Start |          |
>    |          |                               | Tx          |          |
>    | Open     | User service terminated       | Send CC     | PendingT |
>    |          |                               | termination |          |
>    |          |                               | req.        |          |
>    | Open     | RAR received                  | Send RAA    | PendingU |
>    |          |                               | followed by |          |
>    |          |                               | CC update   |          |
>    |          |                               | req., start |          |
>    |          |                               | Tx          |          |
>    | PendingU | Successful CC update answer   | Stop Tx     | Open     |
>    |          | received                      |             |          |
>    | PendingU | Failure to send, or temporary | Grant       | Idle     |
>    |          | error and CCFH equal to       | service to  |          |
>    |          | CONTINUE                      | end user    |          |
>    | PendingU | Failure to send, or temporary | Terminate   | Idle     |
>    |          | error and CCFH equal to       | end user's  |          |
>    |          | TERMINATE or to               | service     |          |
>    |          | RETRY_AND_TERMINATE           |             |          |
>    | PendingU | Tx expired and CCFH equal to  | Terminate   | Idle     |
>    |          | TERMINATE                     | end user's  |          |
>    |          |                               | service     |          |
>    | PendingU | Tx expired and CCFH equal to  | Grant       | PendingU |
>    |          | CONTINUE or to                | service to  |          |
>    |          | RETRY_AND_TERMINATE           | end user    |          |
>    | PendingU | CC update answer received     | Terminate   | Idle     |
2816,2817d2853
<     PendingU  Successful CC update           Stop Tx      Open
<               answer received
2819,2821d2854
<     PendingU  Failure to send, or            Grant        Idle
<               temporary error and            service to
<               CCFH equal to CONTINUE         end user
2823,2843c2856,2858
<     PendingU  Failure to send, or            Terminate    Idle
<               temporary error and            end user's
<               CCFH equal to TERMINATE        service
<               or to RETRY_AND_TERMINATE
< 
<     PendingU  Tx expired and CCFH            Terminate    Idle
<               equal to TERMINATE             end user's
<                                              service
< 
<     PendingU  Tx expired and CCFH equal      Grant        PendingU
<               to CONTINUE or to              service to
<               RETRY_AND_TERMINATE            end user
< 
<     PendingU  CC update answer               Terminate    Idle
<               received with result code      end user's
<               END_USER_SERVICE_DENIED        service
< 
<     PendingU  CC update answer               Grant        Idle
<               received with result code      service
<               equal to CREDIT_CONTROL_       to end user
<               NOT_APPLICABLE
---
> Hakala, et al.          Expires February 2, 2006               [Page 51]
> 
> Internet-Draft              Abbreviated Title                August 2005
2845,2847d2859
<     PendingU  Failed CC update               Grant        Idle
<               answer received and            service to
<               CCFH equal to CONTINUE         end user
2849,2852c2861,2887
<     PendingU  Failed CC update               Terminate    Idle
<               answer received and CCFH       end user's
<               equal to TERMINATE or          service
<               to RETRY_AND_TERMINATE
---
>    |          | with result code              | end user's  |          |
>    |          | END_USER_SERVICE_DENIED       | service     |          |
>    | PendingU | CC update answer received     | Terminate   | Idle     |
>    |          | with result code equal to     | end user's  |          |
>    |          | CREDIT_CONTROL_NOT_APPLICABLE | service     |          |
>    | PendingU | Failed CC update answer       | Grant       | Idle     |
>    |          | received and CCFH equal to    | service to  |          |
>    |          | CONTINUE                      | end user    |          |
>    | PendingU | Failed CC update answer       | Terminate   | Idle     |
>    |          | received and CCFH equal to    | end user's  |          |
>    |          | TERMINATE or to               | service     |          |
>    |          | RETRY_AND_TERMINATE           |             |          |
>    | PendingU | User service terminated       | Queue       | PendingU |
>    |          |                               | termination |          |
>    |          |                               | event       |          |
>    | PendingU | Change in rating condition    | Queue       | PendingU |
>    |          |                               | changed     |          |
>    |          |                               | rating      |          |
>    |          |                               | condition   |          |
>    |          |                               | event       |          |
>    | PendingU | RAR received                  | Send RAA    | PendingU |
>    | PendingT | Successful CC termination     |             | Idle     |
>    |          | answer received               |             |          |
>    | PendingT | Failure to send, temporary    |             | Idle     |
>    |          | error, or failed answer       |             |          |
>    | PendingT | Change in rating condition    |             | PendingT |
>    +----------+-------------------------------+-------------+----------+
2853a2889,2890
>          Table 4: CLIENT, SESSION BASED for intermediate and final
>                               interrogations
2854a2892,2908
>    +----------+--------------------------------+------------+----------+
>    | State    | Event                          | Action     | New      |
>    |          |                                |            | State    |
>    +----------+--------------------------------+------------+----------+
>    | Idle     | Client or device requests a    | Send CC    | PendingE |
>    |          | one-time service               | event      |          |
>    |          |                                | req.,      |          |
>    |          |                                | Start Tx   |          |
>    | Idle     | Request in storage             | Send       | PendingB |
>    |          |                                | stored     |          |
>    |          |                                | request    |          |
>    | PendingE | Grant service to end user      | Send       | Idle     |
>    |          |                                | stored     |          |
>    |          |                                | request    |          |
>    | PendingE | Failure to send, temporary     | Indicate   | Idle     |
>    |          | error, failed CC event answer  | service    |          |
>    |          | received, or Tx expired;       | error      |          |
2858c2912
< Hakala, et al.              Standards Track                    [Page 51]
---
> Hakala, et al.          Expires February 2, 2006               [Page 52]
2860,2871c2914
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<     PendingU  User service terminated        Queue        PendingU
<                                              termination
<                                              event
< 
<     PendingU  Change in rating               Queue        PendingU
<               condition                      changed
<                                              rating
<                                              condition
<                                              event
---
> Internet-Draft              Abbreviated Title                August 2005
2873d2915
<     PendingU  RAR received                   Send RAA     PendingU
2875,2876c2917,2964
<     PendingT  Successful CC                               Idle
<               termination answer received
---
>    |          | requested action CHECK_BALANCE |            |          |
>    |          | or PRICE_ENQUIRY               |            |          |
>    | PendingE | CC event answer received with  | Terminate  | Idle     |
>    |          | result code                    | end user's |          |
>    |          | END_USER_SERVICE_DENIED or     | service    |          |
>    |          | USER_UNKNOWN and Tx running    |            |          |
>    | PendingE | CC event answer received with  | Grant      | Idle     |
>    |          | result code                    | service to |          |
>    |          | CREDIT_CONTROL_NOT_APPLICABLE; | end user   |          |
>    |          | requested action               |            |          |
>    |          | DIRECT_DEBITING                |            |          |
>    | PendingE | Failure to send, temporary     | Grant      | Idle     |
>    |          | error, failed CC event answer  | service to |          |
>    |          | received; requested action     | end user   |          |
>    |          | DIRECT_DEBITING; DDFH equal to |            |          |
>    |          | CONTINUE                       |            |          |
>    | PendingE | Failed CC event answer         | Terminate  | Idle     |
>    |          | received or temporary error;   | end user's |          |
>    |          | requested action               | service    |          |
>    |          | DIRECT_DEBITING; DDFH equal to |            |          |
>    |          | TERMINATE_OR_BUFFER and Tx     |            |          |
>    |          | running                        |            |          |
>    | PendingE | Tx expired; requested action   | Grant      | PendingE |
>    |          | DIRECT_DEBITING                | service to |          |
>    |          |                                | end user   |          |
>    | PendingE | Failure to send; requested     | Store      | Idle     |
>    |          | action DIRECT_DEBITING; DDFH   | request    |          |
>    |          | equal to TERMINATE_OR_BUFFER   | with       |          |
>    |          |                                | T-flag     |          |
>    | PendingE | Failure to send; requested     | Store      | Idle     |
>    |          | action DIRECT_DEBITING; DDFH   | request    |          |
>    |          | equal to TERMINATE_OR_BUFFER   | with       |          |
>    |          |                                | T-flag     |          |
>    | PendingE | Temporary error; requested     | Store      | Idle     |
>    |          | action DIRECT_DEBITING; DDFH   | request    |          |
>    |          | equal to TERMINATE_OR_BUFFER;  |            |          |
>    |          | Tx expired                     |            |          |
>    | PendingE | Failed answer or answer        |            | Idle     |
>    |          | received with result code      |            |          |
>    |          | END_USER_SERVICE DENIED or     |            |          |
>    |          | USER_UNKNOWN; requested action |            |          |
>    |          | DIRECT_DEBITING; Tx expired    |            |          |
>    | PendingE | Failed CC event answer         | Indicate   | Idle     |
>    |          | received; requested action     | service    |          |
>    |          | REFUND_ACCOUNT                 | error and  |          |
>    |          |                                | delete     |          |
>    |          |                                | request    |          |
>    | PendingE | Failure to send or Tx expired; | Store      | Idle     |
2878,2879d2965
<     PendingT  Failure to send, temporary                  Idle
<               error, or failed answer
2881d2966
<     PendingT  Change in rating condition                  PendingT
2883,2894c2968,2970
<                        CLIENT, EVENT BASED
< 
<     State     Event                          Action        New State
<     ----------------------------------------------------------------
<     Idle      Client or device requests      Send          PendingE
<               a one-time service             CC event
<                                              req.,
<                                              Start Tx
< 
<     Idle      Request in storage             Send          PendingB
<                                              stored
<                                              request
---
> Hakala, et al.          Expires February 2, 2006               [Page 53]
> 
> Internet-Draft              Abbreviated Title                August 2005
2896,2898d2971
<     PendingE  Successful CC event            Grant         Idle
<               answer received                service to
<                                              end user
2900,2905c2973,2984
<     PendingE  Failure to send, temporary     Indicate      Idle
<               error, failed CC event         service
<               answer received, or            error
<               Tx expired; requested
<               action CHECK_BALANCE or
<               PRICE_ENQUIRY
---
>    |          | requested action               | request    |          |
>    |          | REFUND_ACCOUNT                 | with       |          |
>    |          |                                | T-flag     |          |
>    | PendingE | Temporary error, and requested | Store      | Idle     |
>    |          | action REFUND_ACCOUNT          | request    |          |
>    | PendingE | Successful CC answer received  | Delete     | Idle     |
>    |          |                                | request    |          |
>    | PendingE | Failed CC answer received      | Delete     | Idle     |
>    |          |                                | request    |          |
>    | PendingE | Failure to send or temporary   |            | Idle     |
>    |          | error                          |            |          |
>    +----------+--------------------------------+------------+----------+
2907,2910c2986
<     PendingE  CC event answer                Terminate     Idle
<               received with result code      end user's
<               END_USER_SERVICE_DENIED or     service
<               USER_UNKNOWN and Tx running
---
>                             CLIENT, EVENT BASED
2914,2916d2989
< Hakala, et al.              Standards Track                    [Page 52]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
2919,2923d2991
<     PendingE  CC event answer                Grant         Idle
<               received with result code      service
<               CREDIT_CONTROL_NOT_APPLICABLE; to end
<               requested action               user
<               DIRECT_DEBITING
2925,2929d2992
<     PendingE  Failure to send, temporary     Grant         Idle
<               error, or failed CC event      service
<               answer received; requested     to end
<               action DIRECT_DEBITING;        user
<               DDFH equal to CONTINUE
2931,2937d2993
<     PendingE  Failed CC event                Terminate     Idle
<               answer received or temporary   end user's
<               error; requested action        service
<               DIRECT_DEBITING;
<               DDFH equal to
<               TERMINATE_OR_BUFFER and
<               Tx running
2939,2942d2994
<     PendingE  Tx expired; requested          Grant         PendingE
<               action DIRECT_DEBITING         service
<                                              to end
<                                              user
2944,2947d2995
<     PendingE  Failure to send; requested     Store         Idle
<               action DIRECT_DEBITING;        request with
<               DDFH equal to                  T-flag
<               TERMINATE_OR_BUFFER
2949,2953d2996
<     PendingE  Temporary error; requested     Store         Idle
<               action DIRECT_DEBITING;        request
<               DDFH equal to
<               TERMINATE_OR_BUFFER;
<               Tx expired
2955,2959d2997
<     PendingE  Failed answer or answer                      Idle
<               received with result code
<               END_USER_SERVICE DENIED or
<               USER_UNKNOWN; requested action
<               DIRECT_DEBITING; Tx expired
2961,2964d2998
<     PendingE  Failed CC event answer         Indicate      Idle
<               received; requested            service
<               action REFUND_ACCOUNT          error and
<                                              delete request
2970,2972d3003
< Hakala, et al.              Standards Track                    [Page 53]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
2975,2977d3005
<     PendingE  Failure to send or             Store         Idle
<               Tx expired; requested          request
<               action REFUND_ACCOUNT          with T-flag
2979,2981d3006
<     PendingE  Temporary error,               Store         Idle
<               and requested action           request
<               REFUND_ACCOUNT
2983,2984d3007
<     PendingB  Successful CC answer           Delete        Idle
<               received                       request
2986,2987d3008
<     PendingB  Failed CC answer               Delete        Idle
<               received                       request
2989,2990d3009
<     PendingB  Failure to send or                           Idle
<               temporary error
2992d3010
<                    SERVER, SESSION AND EVENT BASED
2994,2995d3011
<     State     Event                          Action        New State
<     ----------------------------------------------------------------
2997,3001d3012
<     Idle      CC initial request             Send          Open
<               received and successfully      CC initial
<               processed                      answer,
<                                              reserve units,
<                                              start Tcc
3003,3007d3013
<     Idle      CC initial request             Send          Idle
<               received but not               CC initial
<               successfully processed         answer with
<                                              Result-Code
<                                              != SUCCESS
3009,3011d3014
<     Idle      CC event request               Send          Idle
<               received and successfully      CC event
<               processed                      answer
3013,3017d3015
<     Idle      CC event request               Send          Idle
<               received but not               CC event
<               successfully processed         answer with
<                                              Result-Code
<                                              != SUCCESS
3026c3024
< Hakala, et al.              Standards Track                    [Page 54]
---
> Hakala, et al.          Expires February 2, 2006               [Page 54]
3028,3045c3026
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<     Open      CC update request              Send CC       Open
<               received and successfully      update answer,
<               processed                      debit used
<                                              units,
<                                              reserve
<                                              new units,
<                                              restart Tcc
< 
<     Open      CC update request              Send          Idle
<               received but not               CC update
<               successfully processed         answer with
<                                              Result-Code
<                                              != SUCCESS,
<                                              debit used
<                                              units
---
> Internet-Draft              Abbreviated Title                August 2005
3047,3052d3027
<     Open      CC termination request         Send          Idle
<               received and successfully      CC termin.
<               processed                      answer,
<                                              Stop Tcc,
<                                              debit used
<                                              units
3054,3060c3029,3062
<     Open      CC termination request         Send          Idle
<               received but not               CC termin.
<               successfully processed         answer with
<                                              Result-Code
<                                              != SUCCESS,
<                                              debit used
<                                              units
---
>    +-------+------------------------+--------------------------+-------+
>    | State | Event                  | Action                   | New   |
>    |       |                        |                          | State |
>    +-------+------------------------+--------------------------+-------+
>    | Idle  | CC initial request     | Send CC initial answer,  | Open  |
>    |       | received and           | reserve units, start Tcc |       |
>    |       | successfully processed |                          |       |
>    | Idle  | CC initial request     | Send CC initial answer   | Idle  |
>    |       | received but not       | with Result-Code !=      |       |
>    |       | successfully processed | SUCCESS                  |       |
>    | Idle  | CC event request       | Send CC event answer     | Idle  |
>    |       | received and           |                          |       |
>    |       | successfully processed |                          |       |
>    | Idle  | CC event request       | Send CC event answer     | Idle  |
>    |       | received but not       | with Result-Code !=      |       |
>    |       | successfully processed | SUCCESS                  |       |
>    | Open  | CC update request      | Send CC update answer,   | Open  |
>    |       | received and           | debit used units,        |       |
>    |       | successfully processed | reserve new units,       |       |
>    |       |                        | restart Tcc              |       |
>    | Open  | CC update request      | Send CC update answer    | Idle  |
>    |       | received but not       | with Result-Code !=      |       |
>    |       | successfully processed | SUCCESS, debit used      |       |
>    |       |                        | units                    |       |
>    | Open  | CC termination request | Send CC termin. answer,  | Idle  |
>    |       | received and           | Stop Tcc, debit used     |       |
>    |       | successfully processed | units                    |       |
>    | Open  | CC termination request | Send CC termin. answer   | Idle  |
>    |       | received but not       | with Result-Code !=      |       |
>    |       | successfully processed | SUCCESS, debit used      |       |
>    |       |                        | units                    |       |
>    | Open  | Session supervision    | Release reserved units   | Idle  |
>    |       | timer Tcc expired      |                          |       |
>    +-------+------------------------+--------------------------+-------+
3062,3064c3064
<     Open      Session supervision timer Tcc  Release       Idle
<               expired                        reserved
<                                              units
---
>                       SERVER, SESSION AND EVENT BASED
3074,3076c3074,3076
<    applications, such as [NASREQ] and [DIAMMIP], if the first
<    interrogation is performed as part of the
<    authorization/authentication process, as described in section 5.2.
---
>    applications, such as [NASREQ] [RFC4005] and [DIAMMIP] [RFC4004], if
>    the first interrogation is performed as part of the authorization/
>    authentication process, as described in section 5.2 (Section 5.2).
3080,3082c3080
< 
< 
< Hakala, et al.              Standards Track                    [Page 55]
---
> Hakala, et al.          Expires February 2, 2006               [Page 55]
3084c3082
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3087,3089c3085,3087
<    The Diameter AVP rules are defined in the Diameter Base [DIAMBASE],
<    section 4.  These AVP rules are observed in AVPs defined in this
<    section.
---
>    The Diameter AVP rules are defined in the Diameter Base [DIAMBASE]
>    [RFC3588], section 4 (Section 4).  These AVP rules are observed in
>    AVPs defined in this section.
3094c3092,3093
<    [DIAMBASE] specifies the AVP Flag rules for AVPs in section 4.5.
---
>    [DIAMBASE] [RFC3588] specifies the AVP Flag rules for AVPs in section
>    4.5.
3096,3188c3095,3186
<                                             +--------------------+
<                                             |    AVP Flag rules  |
<                                             |----+-----+----+----|----+
<                      AVP  Section           |    |     |SHLD|MUST|    |
<    Attribute Name    Code Defined Data Type |MUST| MAY | NOT|NOT |Encr|
<    -----------------------------------------|----+-----+----+----|----|
<    CC-Correlation-Id 411  8.1    OctetString|    | P,M |    |  V | Y  |
<    CC-Input-Octets   412  8.24   Unsigned64 | M  |  P  |    |  V | Y  |
<    CC-Money          413  8.22   Grouped    | M  |  P  |    |  V | Y  |
<    CC-Output-Octets  414  8.25   Unsigned64 | M  |  P  |    |  V | Y  |
<    CC-Request-Number 415  8.2    Unsigned32 | M  |  P  |    |  V | Y  |
<    CC-Request-Type   416  8.3    Enumerated | M  |  P  |    |  V | Y  |
<    CC-Service-       417  8.26   Unsigned64 | M  |  P  |    |  V | Y  |
<      Specific-Units                         |    |     |    |    |    |
<    CC-Session-       418  8.4    Enumerated | M  |  P  |    |  V | Y  |
<      Failover                               |    |     |    |    |    |
<    CC-Sub-Session-Id 419  8.5    Unsigned64 | M  |  P  |    |  V | Y  |
<    CC-Time           420  8.21   Unsigned32 | M  |  P  |    |  V | Y  |
<    CC-Total-Octets   421  8.23   Unsigned64 | M  |  P  |    |  V | Y  |
<    CC-Unit-Type      454  8.32   Enumerated | M  |  P  |    |  V | Y  |
<    Check-Balance-    422  8.6    Enumerated | M  |  P  |    |  V | Y  |
<      Result                                 |    |     |    |    |    |
<    Cost-Information  423  8.7    Grouped    | M  |  P  |    |  V | Y  |
<    Cost-Unit         424  8.12   UTF8String | M  |  P  |    |  V | Y  |
<    Credit-Control    426  8.13   Enumerated | M  |  P  |    |  V | Y  |
<    Credit-Control-   427  8.14   Enumerated | M  |  P  |    |  V | Y  |
<      Failure-Handling                       |    |     |    |    |    |
<    Currency-Code     425  8.11   Unsigned32 | M  |  P  |    |  V | Y  |
<    Direct-Debiting-  428  8.15   Enumerated | M  |  P  |    |  V | Y  |
<      Failure-Handling                       |    |     |    |    |    |
<    Exponent          429  8.9    Integer32  | M  |  P  |    |  V | Y  |
<    Final-Unit-Action 449  8.35   Enumerated | M  |  P  |    |  V | Y  |
<    Final-Unit-       430  8.34   Grouped    | M  |  P  |    |  V | Y  |
<      Indication                             |    |     |    |    |    |
<    Granted-Service-  431  8.17   Grouped    | M  |  P  |    |  V | Y  |
<      Unit                                   |    |     |    |    |    |
<    G-S-U-Pool-       453  8.31   Unsigned32 | M  |  P  |    |  V | Y  |
<      Identifier                             |    |     |    |    |    |
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 56]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    G-S-U-Pool-       457  8.30   Grouped    | M  |  P  |    |  V | Y  |
<      Reference                              |    |     |    |    |    |
<    Multiple-Services 456  8.16   Grouped    | M  |  P  |    |  V | Y  |
<     -Credit-Control                         |    |     |    |    |    |
<    Multiple-Services 455  8.40   Enumerated | M  |  P  |    |  V | Y  |
<     -Indicator                              |    |     |    |    |    |
<    Rating-Group      432  8.29   Unsigned32 | M  |  P  |    |  V | Y  |
<    Redirect-Address  433  8.38   Enumerated | M  |  P  |    |  V | Y  |
<      -Type                                  |    |     |    |    |    |
<    Redirect-Server   434  8.37   Grouped    | M  |  P  |    |  V | Y  |
<    Redirect-Server   435  8.39   UTF8String | M  |  P  |    |  V | Y  |
<      -Address                               |    |     |    |    |    |
<    Requested-Action  436  8.41   Enumerated | M  |  P  |    |  V | Y  |
<    Requested-Service 437  8.18   Grouped    | M  |  P  |    |  V | Y  |
<      -Unit                                  |    |     |    |    |    |
<    Restriction       438  8.36   IPFiltrRule| M  |  P  |    |  V | Y  |
<      -Filter-Rule                           |    |     |    |    |    |
<    Service-Context   461  8.42   UTF8String | M  |  P  |    |  V | Y  |
<      -Id                                    |    |     |    |    |    |
<    Service-          439  8.28   Unsigned32 | M  |  P  |    |  V | Y  |
<      Identifier                             |    |     |    |    |    |
<    Service-Parameter 440  8.43   Grouped    |    | P,M |    |  V | Y  |
<      -Info                                  |    |     |    |    |    |
<    Service-          441  8.44   Unsigned32 |    | P,M |    |  V | Y  |
<      Parameter-Type                         |    |     |    |    |    |
<    Service-          442  8.45   OctetString|    | P,M |    |  V | Y  |
<      Parameter-Value                        |    |     |    |    |    |
<    Subscription-Id   443  8.46   Grouped    | M  |  P  |    |  V | Y  |
<    Subscription-Id   444  8.48   UTF8String | M  |  P  |    |  V | Y  |
<      -Data                                  |    |     |    |    |    |
<    Subscription-Id   450  8.47   Enumerated | M  |  P  |    |  V | Y  |
<      -Type                                  |    |     |    |    |    |
<    Tariff-Change     452  8.27   Enumerated | M  |  P  |    |  V | Y  |
<      -Usage                                 |    |     |    |    |    |
<    Tariff-Time       451  8.20   Time       | M  |  P  |    |  V | Y  |
<      -Change                                |    |     |    |    |    |
<    Unit-Value        445  8.8    Grouped    | M  |  P  |    |  V | Y  |
<    Used-Service-Unit 446  8.19   Grouped    | M  |  P  |    |  V | Y  |
<    User-Equipment    458  8.49   Grouped    |    | P,M |    |  V | Y  |
<      -Info                                  |    |     |    |    |    |
<    User-Equipment    459  8.50   Enumerated |    | P,M |    |  V | Y  |
<      -Info-Type                             |    |     |    |    |    |
<    User-Equipment    460  8.51   OctetString|    | P,M |    |  V | Y  |
<      -Info-Value                            |    |     |    |    |    |
<    Value-Digits      447  8.10   Integer64  | M  |  P  |    |  V | Y  |
<    Validity-Time     448  8.33   Unsigned32 | M  |  P  |    |  V | Y  |
---
>                                              +--------------------+
>                                              |    AVP Flag rules  |
>                                              |----+-----+----+----|----+
>                       AVP  Section           |    |     |SHLD|MUST|    |
>     Attribute Name    Code Defined Data Type |MUST| MAY | NOT|NOT |Encr|
>     -----------------------------------------|----+-----+----+----|----|
>     CC-Correlation-Id 411  8.1    OctetString|    | P,M |    |  V | Y  |
>     CC-Input-Octets   412  8.24   Unsigned64 | M  |  P  |    |  V | Y  |
>     CC-Money          413  8.22   Grouped    | M  |  P  |    |  V | Y  |
>     CC-Output-Octets  414  8.25   Unsigned64 | M  |  P  |    |  V | Y  |
>     CC-Request-Number 415  8.2    Unsigned32 | M  |  P  |    |  V | Y  |
>     CC-Request-Type   416  8.3    Enumerated | M  |  P  |    |  V | Y  |
>     CC-Service-       417  8.26   Unsigned64 | M  |  P  |    |  V | Y  |
>       Specific-Units                         |    |     |    |    |    |
>     CC-Session-       418  8.4    Enumerated | M  |  P  |    |  V | Y  |
>       Failover                               |    |     |    |    |    |
>     CC-Sub-Session-Id 419  8.5    Unsigned64 | M  |  P  |    |  V | Y  |
>     CC-Time           420  8.21   Unsigned32 | M  |  P  |    |  V | Y  |
>     CC-Total-Octets   421  8.23   Unsigned64 | M  |  P  |    |  V | Y  |
>     CC-Unit-Type      454  8.32   Enumerated | M  |  P  |    |  V | Y  |
>     Check-Balance-    422  8.6    Enumerated | M  |  P  |    |  V | Y  |
>       Result                                 |    |     |    |    |    |
>     Cost-Information  423  8.7    Grouped    | M  |  P  |    |  V | Y  |
>     Cost-Unit         424  8.12   UTF8String | M  |  P  |    |  V | Y  |
>     Credit-Control    426  8.13   Enumerated | M  |  P  |    |  V | Y  |
>     Credit-Control-   427  8.14   Enumerated | M  |  P  |    |  V | Y  |
>       Failure-Handling                       |    |     |    |    |    |
>     Currency-Code     425  8.11   Unsigned32 | M  |  P  |    |  V | Y  |
>     Direct-Debiting-  428  8.15   Enumerated | M  |  P  |    |  V | Y  |
>       Failure-Handling                       |    |     |    |    |    |
>     Exponent          429  8.9    Integer32  | M  |  P  |    |  V | Y  |
>     Final-Unit-Action 449  8.35   Enumerated | M  |  P  |    |  V | Y  |
>     Final-Unit-       430  8.34   Grouped    | M  |  P  |    |  V | Y  |
>       Indication                             |    |     |    |    |    |
>     Granted-Service-  431  8.17   Grouped    | M  |  P  |    |  V | Y  |
>       Unit                                   |    |     |    |    |    |
>     G-S-U-Pool-       453  8.31   Unsigned32 | M  |  P  |    |  V | Y  |
>       Identifier                             |    |     |    |    |    |
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 56]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>     G-S-U-Pool-       457  8.30   Grouped    | M  |  P  |    |  V | Y  |
>       Reference                              |    |     |    |    |    |
>     Multiple-Services 456  8.16   Grouped    | M  |  P  |    |  V | Y  |
>      -Credit-Control                         |    |     |    |    |    |
>     Multiple-Services 455  8.40   Enumerated | M  |  P  |    |  V | Y  |
>      -Indicator                              |    |     |    |    |    |
>     Rating-Group      432  8.29   Unsigned32 | M  |  P  |    |  V | Y  |
>     Redirect-Address  433  8.38   Enumerated | M  |  P  |    |  V | Y  |
>       -Type                                  |    |     |    |    |    |
>     Redirect-Server   434  8.37   Grouped    | M  |  P  |    |  V | Y  |
>     Redirect-Server   435  8.39   UTF8String | M  |  P  |    |  V | Y  |
>       -Address                               |    |     |    |    |    |
>     Requested-Action  436  8.41   Enumerated | M  |  P  |    |  V | Y  |
>     Requested-Service 437  8.18   Grouped    | M  |  P  |    |  V | Y  |
>       -Unit                                  |    |     |    |    |    |
>     Restriction       438  8.36   IPFiltrRule| M  |  P  |    |  V | Y  |
>       -Filter-Rule                           |    |     |    |    |    |
>     Service-Context   461  8.42   UTF8String | M  |  P  |    |  V | Y  |
>       -Id                                    |    |     |    |    |    |
>     Service-          439  8.28   Unsigned32 | M  |  P  |    |  V | Y  |
>       Identifier                             |    |     |    |    |    |
>     Service-Parameter 440  8.43   Grouped    |    | P,M |    |  V | Y  |
>       -Info                                  |    |     |    |    |    |
>     Service-          441  8.44   Unsigned32 |    | P,M |    |  V | Y  |
>       Parameter-Type                         |    |     |    |    |    |
>     Service-          442  8.45   OctetString|    | P,M |    |  V | Y  |
>       Parameter-Value                        |    |     |    |    |    |
>     Subscription-Id   443  8.46   Grouped    | M  |  P  |    |  V | Y  |
>     Subscription-Id   444  8.48   UTF8String | M  |  P  |    |  V | Y  |
>       -Data                                  |    |     |    |    |    |
>     Subscription-Id   450  8.47   Enumerated | M  |  P  |    |  V | Y  |
>       -Type                                  |    |     |    |    |    |
>     Tariff-Change     452  8.27   Enumerated | M  |  P  |    |  V | Y  |
>       -Usage                                 |    |     |    |    |    |
>     Tariff-Time       451  8.20   Time       | M  |  P  |    |  V | Y  |
>       -Change                                |    |     |    |    |    |
>     Unit-Value        445  8.8    Grouped    | M  |  P  |    |  V | Y  |
>     Used-Service-Unit 446  8.19   Grouped    | M  |  P  |    |  V | Y  |
>     User-Equipment    458  8.49   Grouped    |    | P,M |    |  V | Y  |
>       -Info                                  |    |     |    |    |    |
>     User-Equipment    459  8.50   Enumerated |    | P,M |    |  V | Y  |
>       -Info-Type                             |    |     |    |    |    |
>     User-Equipment    460  8.51   OctetString|    | P,M |    |  V | Y  |
>       -Info-Value                            |    |     |    |    |    |
>     Value-Digits      447  8.10   Integer64  | M  |  P  |    |  V | Y  |
>     Validity-Time     448  8.33   Unsigned32 | M  |  P  |    |  V | Y  |
3194c3192
< Hakala, et al.              Standards Track                    [Page 57]
---
> Hakala, et al.          Expires February 2, 2006               [Page 57]
3196c3194
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3227,3230c3225
<    INITIAL_REQUEST                 1
<       An Initial request is used to initiate a credit-control session,
<       and contains credit control information that is relevant to the
<       initiation.
---
>    INITIAL_REQUEST 1
3232,3238c3227,3229
<    UPDATE_REQUEST                  2
<       An Update request contains credit-control information for an
<       existing credit-control session.  Update credit-control requests
<       SHOULD be sent every time a credit-control re-authorization is
<       needed at the expiry of the allocated quota or validity time.
<       Further, additional service-specific events MAY trigger a
<       spontaneous Update request.
---
>    An Initial request is used to initiate a credit-control session, and
>    contains credit control information that is relevant to the
>    initiation.
3240,3243c3231
<    TERMINATION_REQUEST             3
<       A Termination request is sent to terminate a credit-control
<       session and contains credit-control information relevant to the
<       existing session.
---
>    UPDATE_REQUEST 2
3244a3233,3237
>    An Update request contains credit-control information for an existing
>    credit-control session.  Update credit-control requests SHOULD be
>    sent every time a credit-control re-authorization is needed at the
>    expiry of the allocated quota or validity time.  Further, additional
>    service-specific events MAY trigger a spontaneous Update request.
3245a3239
>    TERMINATION_REQUEST 3
3246a3241,3243
>    A Termination request is sent to terminate a credit-control session
>    and contains credit-control information relevant to the existing
>    session.
3250c3247,3248
< Hakala, et al.              Standards Track                    [Page 58]
---
> 
> Hakala, et al.          Expires February 2, 2006               [Page 58]
3252c3250,3251
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
> 
3253a3253
>    EVENT_REQUEST 4
3255,3262c3255,3261
<    EVENT_REQUEST                   4
<       An Event request is used when there is no need to maintain any
<       credit-control session state in the credit-control server.  This
<       request contains all information relevant to the service, and is
<       the only request of the service.  The reason for the Event request
<       is further detailed in the Requested-Action AVP.  The Requested-
<       Action AVP MUST be included in the Credit-Control-Request message
<       when CC-Request-Type is set to EVENT_REQUEST.
---
>    An Event request is used when there is no need to maintain any
>    credit-control session state in the credit-control server.  This
>    request contains all information relevant to the service, and is the
>    only request of the service.  The reason for the Event request is
>    further detailed in the Requested-Action AVP.  The Requested- Action
>    AVP MUST be included in the Credit-Control-Request message when CC-
>    Request-Type is set to EVENT_REQUEST.
3280,3294c3279,3294
<    FAILOVER_NOT_SUPPORTED          0
<       When the CC-Session-Failover AVP is set to FAILOVER_NOT_SUPPORTED,
<       the credit-control message stream MUST NOT to be moved to an
<       alternative destination in the case of communication failure.
< 
<       This is the default behavior if the AVP isn't included in the
<       reply from the authorization or credit-control server.
< 
<    FAILOVER_SUPPORTED              1
<       When the CC-Session-Failover AVP is set to FAILOVER_SUPPORTED, the
<       credit-control message stream SHOULD be moved to an alternative
<       destination in the case of communication failure.  Moving the
<       credit-control message stream to a backup server MAY require that
<       information related to the credit-control session should also be
<       forwarded to alternative server.
---
>    FAILOVER_NOT_SUPPORTED 0
> 
>    When the CC-Session-Failover AVP is set to FAILOVER_NOT_SUPPORTED,
>    the credit-control message stream MUST NOT to be moved to an
>    alternative destination in the case of communication failure.  This
>    is the default behavior if the AVP isn't included in the reply from
>    the authorization or credit-control server.
> 
>    FAILOVER_SUPPORTED 1
> 
>    When the CC-Session-Failover AVP is set to FAILOVER_SUPPORTED, the
>    credit-control message stream SHOULD be moved to an alternative
>    destination in the case of communication failure.  Moving the credit-
>    control message stream to a backup server MAY require that
>    information related to the credit-control session should also be
>    forwarded to alternative server.
3304,3306c3304
< 
< 
< Hakala, et al.              Standards Track                    [Page 59]
---
> Hakala, et al.          Expires February 2, 2006               [Page 59]
3308c3306
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3320c3318,3321
<    Credit-Control-Request command.
---
>    Credit-Control-Request command.  The following values are defined for
>    the Check-Balance-Result AVP.
> 
>    ENOUGH_CREDIT 0
3322c3323
<    The following values are defined for the Check-Balance-Result AVP.
---
>    There is enough credit in the account to cover the requested service.
3324,3326c3325
<    ENOUGH_CREDIT                   0
<       There is enough credit in the account to cover the requested
<       service.
---
>    NO_CREDIT 1
3328,3330c3327,3328
<    NO_CREDIT                       1
<       There isn't enough credit in the account to cover the requested
<       service.
---
>    There isn't enough credit in the account to cover the requested
>    service.
3355a3354,3355
>    The Cost-Information AVP included in the Credit-Control-Answer
>    command with the CC-Request-Type set to EVENT_REQUEST or
3360,3362c3360
< 
< 
< Hakala, et al.              Standards Track                    [Page 60]
---
> Hakala, et al.          Expires February 2, 2006               [Page 60]
3364c3362
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3367,3368d3364
<    The Cost-Information AVP included in the Credit-Control-Answer
<    command with the CC-Request-Type set to EVENT_REQUEST or
3372,3373c3368,3374
<    It is defined as follows (per the grouped-avp-def of
<    RFC 3588 [DIAMBASE]):
---
>    It is defined as follows (per the grouped-avp-def of RFC 3588
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>                    Cost-Information ::= < AVP Header: 423 >
>                                         { Unit-Value }
>                                         { Currency-Code }
>                                         [ Cost-Unit ]
3375,3378d3375
<                 Cost-Information ::= < AVP Header: 423 >
<                                      { Unit-Value }
<                                      { Currency-Code }
<                                      [ Cost-Unit ]
3390,3391c3387,3392
<    It is defined as follows (per the grouped-avp-def of
<    RFC 3588 [DIAMBASE]):
---
>    It is defined as follows (per the grouped-avp-def of RFC 3588
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>                        Unit-Value ::= < AVP Header: 445 >
>                                       { Value-Digits }
>                                       [ Exponent ]
3393,3395d3393
<                     Unit-Value ::= < AVP Header: 445 >
<                                    { Value-Digits }
<                                    [ Exponent ]
3400,3401c3398,3399
<    exponent value to be applied for the Value-Digit AVP within the
<    Unit-Value AVP.
---
>    exponent value to be applied for the Value-Digit AVP within the Unit-
>    Value AVP.
3418c3416
< Hakala, et al.              Standards Track                    [Page 61]
---
> Hakala, et al.          Expires February 2, 2006               [Page 61]
3420c3418
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3445,3461c3443,3461
<    CREDIT_AUTHORIZATION            0
<       If the home Diameter AAA server determines that the user has
<       prepaid subscription, this value indicates that the credit-control
<       server MUST be contacted to perform the first interrogation.  The
<       value of the Credit-Control AVP MUST always be set to 0 in an AA
<       request sent to perform the first interrogation and to initiate a
<       new credit-control session.
< 
<    RE_AUTHORIZATION                1
<       This value indicates to the Diameter AAA server that a credit-
<       control session is ongoing for the subscriber and that the
<       credit-control server MUST not be contacted.  The Credit-Control
<       AVP set to the value of 1 is to be used only when the first
<       interrogation has been successfully performed and the credit-
<       control session is ongoing (i.e., re-authorization triggered by
<       Authorization-Lifetime).  This value MUST NOT be used in an AA
<       request sent to perform the first interrogation.
---
>    CREDIT_AUTHORIZATION 0
> 
>    If the home Diameter AAA server determines that the user has prepaid
>    subscription, this value indicates that the credit-control server
>    MUST be contacted to perform the first interrogation.  The value of
>    the Credit-Control AVP MUST always be set to 0 in an AA request sent
>    to perform the first interrogation and to initiate a new credit-
>    control session.
> 
>    RE_AUTHORIZATION 1
> 
>    This value indicates to the Diameter AAA server that a credit-
>    control session is ongoing for the subscriber and that the credit-
>    control server MUST not be contacted.  The Credit-Control AVP set to
>    the value of 1 is to be used only when the first interrogation has
>    been successfully performed and the credit- control session is
>    ongoing (i.e., re-authorization triggered by Authorization-Lifetime).
>    This value MUST NOT be used in an AA request sent to perform the
>    first interrogation.
3469,3470d3468
<    due to a network problem.  Depending on the service logic, the
<    credit-control server can order the client to terminate the service
3474c3472
< Hakala, et al.              Standards Track                    [Page 62]
---
> Hakala, et al.          Expires February 2, 2006               [Page 62]
3476c3474
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3478a3477,3478
>    due to a network problem.  Depending on the service logic, the
>    credit-control server can order the client to terminate the service
3484,3513c3484,3514
<    TERMINATE                       0
<       When the Credit-Control-Failure-Handling AVP is set to TERMINATE,
<       the service MUST only be granted for as long as there is a
<       connection to the credit-control server.  If the credit-control
<       client does not receive any Credit-Control-Answer message within
<       the Tx timer (as defined in section 13), the credit-control
<       request is regarded as failed, and the end user's service session
<       is terminated.
< 
<       This is the default behavior if the AVP isn't included in the
<       reply from the authorization or credit-control server.
< 
<    CONTINUE                       1
<       When the Credit-Control-Failure-Handling AVP is set to CONTINUE,
<       the credit-control client SHOULD re-send the request to an
<       alternative server in the case of transport or temporary failures,
<       provided that a failover procedure is supported in the credit-
<       control server and the credit-control client, and that an
<       alternative server is available.  Otherwise, the service SHOULD be
<       granted, even if credit-control messages can't be delivered.
< 
<    RETRY_AND_TERMINATE            2
<       When the Credit-Control-Failure-Handling AVP is set to
<       RETRY_AND_TERMINATE, the credit-control client SHOULD re-send the
<       request to an alternative server in the case of transport or
<       temporary failures, provided that a failover procedure is
<       supported in the credit-control server and the credit-control
<       client, and that an alternative server is available.  Otherwise,
<       the service SHOULD not be granted when the credit-control messages
<       can't be delivered.
---
>    TERMINATE 0
> 
>    When the Credit-Control-Failure-Handling AVP is set to TERMINATE, the
>    service MUST only be granted for as long as there is a connection to
>    the credit-control server.  If the credit-control client does not
>    receive any Credit-Control-Answer message within the Tx timer (as
>    defined in section 13 (Section 13)), the credit-control request is
>    regarded as failed, and the end user's service session is terminated.
> 
>    This is the default behavior if the AVP isn't included in the reply
>    from the authorization or credit-control server.
> 
>    CONTINUE 1
> 
>    When the Credit-Control-Failure-Handling AVP is set to CONTINUE, the
>    credit-control client SHOULD re-send the request to an alternative
>    server in the case of transport or temporary failures, provided that
>    a failover procedure is supported in the credit- control server and
>    the credit-control client, and that an alternative server is
>    available.  Otherwise, the service SHOULD be granted, even if credit-
>    control messages can't be delivered.
> 
>    RETRY_AND_TERMINATE 2
> 
>    When the Credit-Control-Failure-Handling AVP is set to
>    RETRY_AND_TERMINATE, the credit-control client SHOULD re-send the
>    request to an alternative server in the case of transport or
>    temporary failures, provided that a failover procedure is supported
>    in the credit-control server and the credit-control client, and that
>    an alternative server is available.  Otherwise, the service SHOULD
>    not be granted when the credit-control messages can't be delivered.
3523,3526c3524
<    TERMINATE_OR_BUFFER             0
<       When the Direct-Debiting-Failure-Handling AVP is set to
<       TERMINATE_OR_BUFFER, the service MUST be granted for as long as
<       there is a connection to the credit-control server.  If the
---
>    TERMINATE_OR_BUFFER 0
3530c3528
< Hakala, et al.              Standards Track                    [Page 63]
---
> Hakala, et al.          Expires February 2, 2006               [Page 63]
3532c3530
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3535,3543c3533,3546
<       credit-control client does not receive any Credit-Control-Answer
<       message within the Tx timer (as defined in section 13) the
<       credit-control request is regarded as failed.  The client SHOULD
<       terminate the service if it can determine from the failed answer
<       that units have not been debited.  Otherwise the credit-control
<       client SHOULD grant the service, store the request in application
<       level non-volatile storage, and try to re-send the request.  These
<       requests MUST be marked as possible duplicates by setting the T-
<       flag in the command header as described in [DIAMBASE] section 3.
---
>    When the Direct-Debiting-Failure-Handling AVP is set to
>    TERMINATE_OR_BUFFER, the service MUST be granted for as long as there
>    is a connection to the credit-control server.  If the credit-control
>    client does not receive any Credit-Control-Answer message within the
>    Tx timer (as defined in section 13 (Section 13)) the credit-control
>    request is regarded as failed.  The client SHOULD terminate the
>    service if it can determine from the failed answer that units have
>    not been debited.  Otherwise the credit-control client SHOULD grant
>    the service, store the request in application level non-volatile
>    storage, and try to re-send the request.  These requests MUST be
>    marked as possible duplicates by setting the T- flag in the command
>    header as described in [DIAMBASE] [RFC3588] section 3 (Section 3).
>    This is the default behavior if the AVP isn't included in the reply
>    from the authorization server.
3545,3546c3548
<       This is the default behavior if the AVP isn't included in the
<       reply from the authorization server.
---
>    CONTINUE 1
3548,3551c3550,3552
<    CONTINUE                                              1
<       When the Direct-Debiting-Failure-Handling AVP is set to CONTINUE,
<       the service SHOULD be granted, even if credit-control messages
<       can't be delivered, and the request should be deleted.
---
>    When the Direct-Debiting-Failure-Handling AVP is set to CONTINUE, the
>    service SHOULD be granted, even if credit-control messages can't be
>    delivered, and the request should be deleted.
3580,3582d3580
<    in which new quota is requested.  If the credit-control client does
<    not include the Requested-Service-Unit AVP in a request command,
<    because for instance, it has determined that the end-user terminated
3586c3584
< Hakala, et al.              Standards Track                    [Page 64]
---
> Hakala, et al.          Expires February 2, 2006               [Page 64]
3588c3586
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3590a3589,3592
>    in which new quota is requested.  If the credit-control client does
>    not include the Requested-Service-Unit AVP in a request command,
>    because for instance, it has determined that the end-user terminated
> 
3602,3605c3604,3607
<    pools, the credit pooling mechanism defined in section 5.1.2 applies.
<    The Tariff-Change-Usage AVP MUST NOT be included in request commands
<    to report used units before, and after tariff time change the Used-
<    Service-Unit AVP MUST be used.
---
>    pools, the credit pooling mechanism defined in section 5.1.2
>    (Section 5.1.2) applies.  The Tariff-Change-Usage AVP MUST NOT be
>    included in request commands to report used units before, and after
>    tariff time change the Used- Service-Unit AVP MUST be used.
3612c3614,3627
<    grouped-avp-def of RFC 3588 [DIAMBASE]):
---
>    grouped-avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Multiple-Services-Credit-Control ::= < AVP Header: 456 >
>                                               [ Granted-Service-Unit ]
>                                               [ Requested-Service-Unit ]
>                                              *[ Used-Service-Unit ]
>                                               [ Tariff-Change-Usage ]
>                                              *[ Service-Identifier ]
>                                               [ Rating-Group ]
>                                              *[ G-S-U-Pool-Reference ]
>                                               [ Validity-Time ]
>                                               [ Result-Code ]
>                                               [ Final-Unit-Indication ]
>                                              *[ AVP ]
3614,3625d3628
<       Multiple-Services-Credit-Control ::= < AVP Header: 456 >
<                                            [ Granted-Service-Unit ]
<                                            [ Requested-Service-Unit ]
<                                           *[ Used-Service-Unit ]
<                                            [ Tariff-Change-Usage ]
<                                           *[ Service-Identifier ]
<                                            [ Rating-Group ]
<                                           *[ G-S-U-Pool-Reference ]
<                                            [ Validity-Time ]
<                                            [ Result-Code ]
<                                            [ Final-Unit-Indication ]
<                                           *[ AVP ]
3634,3638d3636
<    unsupported unit types in the answer message as an incorrect CCA
<    answer.  In this case, the client MUST terminate the credit-control
<    session and indicate in the Termination-Cause AVP reason
<    DIAMETER_BAD_ANSWER.
< 
3642c3640
< Hakala, et al.              Standards Track                    [Page 65]
---
> Hakala, et al.          Expires February 2, 2006               [Page 65]
3644c3642
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3646a3645,3649
>    unsupported unit types in the answer message as an incorrect CCA
>    answer.  In this case, the client MUST terminate the credit-control
>    session and indicate in the Termination-Cause AVP reason
>    DIAMETER_BAD_ANSWER.
> 
3648c3651,3661
<    avp-def of RFC 3588 [DIAMBASE]):
---
>    avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Granted-Service-Unit ::= < AVP Header: 431 >
>                                     [ Tariff-Time-Change ]
>                                     [ CC-Time ]
>                                     [ CC-Money ]
>                                     [ CC-Total-Octets ]
>                                     [ CC-Input-Octets ]
>                                     [ CC-Output-Octets ]
>                                     [ CC-Service-Specific-Units ]
>                                    *[ AVP ]
3650,3658d3662
<       Granted-Service-Unit ::= < AVP Header: 431 >
<                                  [ Tariff-Time-Change ]
<                                  [ CC-Time ]
<                                  [ CC-Money ]
<                                  [ CC-Total-Octets ]
<                                  [ CC-Input-Octets ]
<                                  [ CC-Output-Octets ]
<                                  [ CC-Service-Specific-Units ]
<                                 *[ AVP ]
3669c3673,3682
<    grouped-avp-def of RFC 3588 [DIAMBASE]):
---
>    grouped-avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Requested-Service-Unit ::= < AVP Header: 437 >
>                                     [ CC-Time ]
>                                     [ CC-Money ]
>                                     [ CC-Total-Octets ]
>                                     [ CC-Input-Octets ]
>                                     [ CC-Output-Octets ]
>                                     [ CC-Service-Specific-Units ]
>                                    *[ AVP ]
3671,3678d3683
<       Requested-Service-Unit ::= < AVP Header: 437 >
<                                  [ CC-Time ]
<                                  [ CC-Money ]
<                                  [ CC-Total-Octets ]
<                                  [ CC-Input-Octets ]
<                                  [ CC-Output-Octets ]
<                                  [ CC-Service-Specific-Units ]
<                                 *[ AVP ]
3691,3698c3696
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 66]
---
> Hakala, et al.          Expires February 2, 2006               [Page 66]
3700c3698
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3704c3702,3712
<    avp-def of RFC 3588 [DIAMBASE]):
---
>    avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Used-Service-Unit ::= < AVP Header: 446 >
>                                [ Tariff-Change-Usage ]
>                                [ CC-Time ]
>                                [ CC-Money ]
>                                [ CC-Total-Octets ]
>                                [ CC-Input-Octets ]
>                                [ CC-Output-Octets ]
>                                [ CC-Service-Specific-Units ]
>                               *[ AVP ]
3706,3714d3713
<       Used-Service-Unit ::= < AVP Header: 446 >
<                             [ Tariff-Change-Usage ]
<                             [ CC-Time ]
<                             [ CC-Money ]
<                             [ CC-Total-Octets ]
<                             [ CC-Input-Octets ]
<                             [ CC-Output-Octets ]
<                             [ CC-Service-Specific-Units ]
<                            *[ AVP ]
3724,3729c3723,3728
<    and it is not used for time-based services defined in section 5.  If
<    a client does not support the tariff time change mechanism, it MUST
<    treat Tariff-Time-Change AVP in the answer message as an incorrect
<    CCA answer.  In this case, the client terminates the credit-control
<    session and indicates in the Termination-Cause AVP reason
<    DIAMETER_BAD_ANSWER.
---
>    and it is not used for time-based services defined in section 5
>    (Section 5).  If a client does not support the tariff time change
>    mechanism, it MUST treat Tariff-Time-Change AVP in the answer message
>    as an incorrect CCA answer.  In this case, the client terminates the
>    credit-control session and indicates in the Termination-Cause AVP
>    reason DIAMETER_BAD_ANSWER.
3743c3742
<    RFC 3588 [DIAMBASE]):
---
>    RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
3745,3747c3744,3746
<       CC-Money ::= < AVP Header: 413 >
<                    { Unit-Value }
<                    [ Currency-Code ]
---
>          CC-Money ::= < AVP Header: 413 >
>                       { Unit-Value }
>                       [ Currency-Code ]
3753,3754c3752
< 
< Hakala, et al.              Standards Track                    [Page 67]
---
> Hakala, et al.          Expires February 2, 2006               [Page 67]
3756c3754
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
3782,3784c3780,3782
<    specific units always refer to the service identified in the
<    Service-Identifier AVP (or Rating-Group AVP when the Multiple-
<    Services-Credit-Control AVP is used).
---
>    specific units always refer to the service identified in the Service-
>    Identifier AVP (or Rating-Group AVP when the Multiple- Services-
>    Credit-Control AVP is used).
3794,3796c3792,3794
<    In addition, when present in answer messages as part of the
<    Multiple-Services-Credit-Control AVP, this AVP defines whether units
<    are allocated to be used before or after a tariff change event.
---
>    In addition, when present in answer messages as part of the Multiple-
>    Services-Credit-Control AVP, this AVP defines whether units are
>    allocated to be used before or after a tariff change event.
3803,3806c3801,3802
<    UNIT_BEFORE_TARIFF_CHANGE       0
<       When present in the Multiple-Services-Credit-Control AVP, this
<       value indicates the amount of the units allocated for use before a
<       tariff change occurs.
---
>    UNIT_BEFORE_TARIFF_CHANGE 0
> 
3810c3806,3808
< Hakala, et al.              Standards Track                    [Page 68]
---
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 68]
3812c3810,3815
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    When present in the Multiple-Services-Credit-Control AVP, this value
>    indicates the amount of the units allocated for use before a tariff
>    change occurs.
3813a3817,3818
>    When present in the Used-Service-Unit AVP, this value indicates the
>    amount of resource units used before a tariff change had occurred.
3815,3817c3820
<       When present in the Used-Service-Unit AVP, this value indicates
<       the amount of resource units used before a tariff change had
<       occurred.
---
>    UNIT_AFTER_TARIFF_CHANGE 1
3819,3822c3822,3824
<    UNIT_AFTER_TARIFF_CHANGE        1
<       When present in the Multiple-Services-Credit-Control AVP, this
<       value indicates the amount of the units allocated for use after a
<       tariff change occurs.
---
>    When present in the Multiple-Services-Credit-Control AVP, this value
>    indicates the amount of the units allocated for use after a tariff
>    change occurs.
3824,3826c3826,3827
<       When present in the Used-Service-Unit AVP, this value indicates
<       the amount of resource units used after tariff change had
<       occurred.
---
>    When present in the Used-Service-Unit AVP, this value indicates the
>    amount of resource units used after tariff change had occurred.
3828,3833c3829,3835
<    UNIT_INDETERMINATE              2
<       The used unit contains the amount of units that straddle the
<       tariff change (e.g., the metering process reports to the credit-
<       control client in blocks of n octets, and one block straddled the
<       tariff change).  This value is to be used only in the Used-
<       Service-Unit AVP.
---
>    UNIT_INDETERMINATE 2
> 
>    The used unit contains the amount of units that straddle the tariff
>    change (e.g., the metering process reports to the credit- control
>    client in blocks of n octets, and one block straddled the tariff
>    change).  This value is to be used only in the Used- Service-Unit
>    AVP.
3858,3859d3859
<    Granted-Service-Unit AVP within which it appears with a credit pool
<    within the session.
3861,3862d3860
<    The G-S-U-Pool-Identifier AVP specifies the credit pool from which
<    credit is drawn for this unit type.
3866c3864
< Hakala, et al.              Standards Track                    [Page 69]
---
> Hakala, et al.          Expires February 2, 2006               [Page 69]
3868c3866,3870
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    Granted-Service-Unit AVP within which it appears with a credit pool
>    within the session.
3869a3872,3873
>    The G-S-U-Pool-Identifier AVP specifies the credit pool from which
>    credit is drawn for this unit type.
3880c3884,3889
<    avp-def of RFC 3588 [DIAMBASE]):
---
>    avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          G-S-U-Pool-Reference    ::= < AVP Header: 457 >
>                                      { G-S-U-Pool-Identifier }
>                                      { CC-Unit-Type }
>                                      { Unit-Value }
3882,3885d3890
<       G-S-U-Pool-Reference    ::= < AVP Header: 457 >
<                                   { G-S-U-Pool-Identifier }
<                                   { CC-Unit-Type }
<                                   { Unit-Value }
3900,3905c3905,3906
<       TIME                         0
<       MONEY                        1
<       TOTAL-OCTETS                 2
<       INPUT-OCTETS                 3
<       OUTPUT-OCTETS                4
<       SERVICE-SPECIFIC-UNITS       5
---
>    TIME 0 MONEY 1 TOTAL-OCTETS 2 INPUT-OCTETS 3 OUTPUT-OCTETS 4 SERVICE-
>    SPECIFIC-UNITS 5
3916,3918d3916
<    Control-Request message to the server, with CC-Request-Type set to
<    UPDATE_REQUEST.  The value field of the Validity-Time AVP is given in
<    seconds.
3922c3920
< Hakala, et al.              Standards Track                    [Page 70]
---
> Hakala, et al.          Expires February 2, 2006               [Page 70]
3924c3922,3923
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
> 
3925a3925,3927
>    Control-Request message to the server, with CC-Request-Type set to
>    UPDATE_REQUEST.  The value field of the Validity-Time AVP is given in
>    seconds.
3928,3932c3930,3934
<    termination (see section 5.6) to indicate to the credit-control
<    client how long the subscriber is allowed to use network resources
<    after the specified action (i.e., REDIRECT or RESTRICT_ACCESS)
<    started.  When the Validity-Time elapses, a new intermediate
<    interrogation is sent to the server.
---
>    termination (see section 5.6 (Section 5.6)) to indicate to the
>    credit-control client how long the subscriber is allowed to use
>    network resources after the specified action (i.e., REDIRECT or
>    RESTRICT_ACCESS) started.  When the Validity-Time elapses, a new
>    intermediate interrogation is sent to the server.
3941c3943
<    Final-Unit-Action AVP (see section 5.6).
---
>    Final-Unit-Action AVP (see section 5.6 (Section 5.6)).
3947,3951c3949,3953
<    In the first interrogation, the Final-Unit-Indication AVP with
<    Final-Unit-Action REDIRECT or RESTRICT_ACCESS can also be present
<    with no Granted-Service-Unit AVP in the Credit-Control-Answer or in
<    the AA answer.  This indicates to the Diameter credit-control client
<    to execute the specified action immediately.  If the home service
---
>    In the first interrogation, the Final-Unit-Indication AVP with Final-
>    Unit-Action REDIRECT or RESTRICT_ACCESS can also be present with no
>    Granted-Service-Unit AVP in the Credit-Control-Answer or in the AA
>    answer.  This indicates to the Diameter credit-control client to
>    execute the specified action immediately.  If the home service
3953,3954c3955,3956
<    SHOULD return the appropriate transient failure (see section 9.1) in
<    order to implement the policy-defined action.
---
>    SHOULD return the appropriate transient failure (see section 9.1
>    (Section 9.1)) in order to implement the policy-defined action.
3970,3971d3971
<    If the Final-Unit-Action AVP is set to RESTRICT_ACCESS, either the
<    Restriction-Filter-Rule AVP or the Filter-Id AVP SHOULD be present.
3975a3976,3978
> Hakala, et al.          Expires February 2, 2006               [Page 71]
> 
> Internet-Draft              Abbreviated Title                August 2005
3978,3980c3981,3982
< Hakala, et al.              Standards Track                    [Page 71]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    If the Final-Unit-Action AVP is set to RESTRICT_ACCESS, either the
>    Restriction-Filter-Rule AVP or the Filter-Id AVP SHOULD be present.
3981a3984,3988
>    The Filter-Id AVP is defined in [NASREQ] [RFC4005].  The Filter-Id
>    AVP can be used to reference an IP filter list installed in the
>    access device by means other than the Diameter credit-control
>    application, e.g., locally configured or configured by another
>    entity.
3983,3986c3990,3991
<    The Filter-Id AVP is defined in [NASREQ].  The Filter-Id AVP can be
<    used to reference an IP filter list installed in the access device by
<    means other than the Diameter credit-control application, e.g.,
<    locally configured or configured by another entity.
---
>    The Final-Unit-Indication AVP is defined as follows (per the grouped-
>    avp-def of RFC 3588 [RFC3588] [DIAMBASE] [RFC3588]):
3988,3989c3993,3997
<    The Final-Unit-Indication AVP is defined as follows (per the
<    grouped-avp-def of RFC 3588 [DIAMBASE]):
---
>          Final-Unit-Indication ::= < AVP Header: 430 >
>                                    { Final-Unit-Action }
>                                   *[ Restriction-Filter-Rule ]
>                                   *[ Filter-Id ]
>                                    [ Redirect-Server ]
3991,3995d3998
<       Final-Unit-Indication ::= < AVP Header: 430 >
<                                 { Final-Unit-Action }
<                                *[ Restriction-Filter-Rule ]
<                                *[ Filter-Id ]
<                                 [ Redirect-Server ]
4005,4022c4008
<    TERMINATE                       0
<       The credit-control client MUST terminate the service session.
<       This is the default handling, applicable whenever the credit-
<       control client receives an unsupported Final-Unit-Action value,
<       and it MUST be supported by all the Diameter credit-control client
<       implementations conforming to this specification.
< 
<    REDIRECT                        1
<       The service element MUST redirect the user to the address
<       specified in the Redirect-Server-Address AVP.  The redirect action
<       is defined in section 5.6.2.
< 
<    RESTRICT_ACCESS                 2
<       The access device MUST restrict the user access according to the
<       IP packet filters defined in the Restriction-Filter-Rule AVP or
<       according to the IP packet filters identified by the Filter-Id
<       AVP.  All the packets not matching the filters MUST be dropped
<       (see section 5.6.3).
---
>    TERMINATE 0
4024c4010,4014
< 8.36.  Restriction-Filter-Rule AVP
---
>    The credit-control client MUST terminate the service session.  This
>    is the default handling, applicable whenever the credit- control
>    client receives an unsupported Final-Unit-Action value, and it MUST
>    be supported by all the Diameter credit-control client
>    implementations conforming to this specification.
4026,4029c4016,4022
<    The Restriction-Filter-Rule AVP (AVP Code 438) is of type
<    IPFilterRule and provides filter rules corresponding to services that
<    are to remain accessible even if there are no more service units
<    granted.  The access device has to configure the specified filter
---
>    REDIRECT 1
> 
>    The service element MUST redirect the user to the address specified
>    in the Redirect-Server-Address AVP.  The redirect action is defined
>    in section 5.6.2 (Section 5.6.2).
> 
>    RESTRICT_ACCESS 2
4030a4024,4028
>    The access device MUST restrict the user access according to the IP
>    packet filters defined in the Restriction-Filter-Rule AVP or
>    according to the IP packet filters identified by the Filter-Id AVP.
>    All the packets not matching the filters MUST be dropped (see section
>    5.6.3 (Section 5.6.3)).
4034c4032
< Hakala, et al.              Standards Track                    [Page 72]
---
> Hakala, et al.          Expires February 2, 2006               [Page 72]
4036c4034
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4038a4037,4043
> 8.36.  Restriction-Filter-Rule AVP
> 
>    The Restriction-Filter-Rule AVP (AVP Code 438) is of type
>    IPFilterRule and provides filter rules corresponding to services that
>    are to remain accessible even if there are no more service units
>    granted.  The access device has to configure the specified filter
> 
4052c4057,4061
<    [DIAMBASE]):
---
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Redirect-Server ::= < AVP Header: 434 >
>                              { Redirect-Address-Type }
>                              { Redirect-Server-Address }
4054,4056d4062
<       Redirect-Server ::= < AVP Header: 434 >
<                           { Redirect-Address-Type }
<                           { Redirect-Server-Address }
4066,4068c4072
<    IPv4 Address                    0
<       The address type is in the form of "dotted-decimal" IPv4 address,
<       as defined in [IPv4].
---
>    IPv4 Address 0
4070,4075c4074,4075
<    IPv6 Address                    1
<       The address type is in the form of IPv6 address, as defined in
<       [IPv6Addr].  The address is a text representation of the address
<       in either the preferred or alternate text form [IPv6Addr].
<       Conformant implementations MUST support the preferred form and
<       SHOULD support the alternate text form for IPv6 addresses.
---
>    The address type is in the form of "dotted-decimal" IPv4 address, as
>    defined in [IPv4].
4077,4079c4077
<    URL                             2
<       The address type is in the form of Uniform Resource Locator, as
<       defined in [URL].
---
>    IPv6 Address 1
4081,4083c4079,4083
<    SIP URI                         3
<       The address type is in the form of SIP Uniform Resource
<       Identifier, as defined in [SIP].
---
>    The address type is in the form of IPv6 address, as defined in
>    [IPv6Addr].  The address is a text representation of the address in
>    either the preferred or alternate text form [IPv6Addr].  Conformant
>    implementations MUST support the preferred form and SHOULD support
>    the alternate text form for IPv6 addresses.
4087a4088,4090
> Hakala, et al.          Expires February 2, 2006               [Page 73]
> 
> Internet-Draft              Abbreviated Title                August 2005
4090,4092c4093,4098
< Hakala, et al.              Standards Track                    [Page 73]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    URL 2
> 
>    The address type is in the form of Uniform Resource Locator, as
>    defined in [URL].
> 
>    SIP URI 3
4093a4100,4101
>    The address type is in the form of SIP Uniform Resource Identifier,
>    as defined in [SIP].
4118,4119d4125
<       Client does not support independent credit-control of multiple
<       services within a (sub-)session.
4121,4123c4127,4133
<    MULTIPLE_SERVICES_SUPPORTED     1
<       Client supports independent credit-control of multiple services
<       within a (sub-)session.
---
>    Client does not support independent credit-control of multiple
>    services within a (sub-)session.
> 
>    MULTIPLE_SERVICES_SUPPORTED 1
> 
>    Client supports independent credit-control of multiple services
>    within a (sub-)session.
4132,4138d4141
<    DIRECT_DEBITING                 0
<       This indicates a request to decrease the end user's account
<       according to information specified in the Requested-Service-Unit
<       AVP and/or Service-Identifier AVP (additional rating information
<       may be included in service-specific AVPs or in the Service-
<       Parameter-Info AVP).  The Granted-Service-Unit AVP in the Credit-
<       Control-Answer command contains the debited units.
4140a4144,4146
> Hakala, et al.          Expires February 2, 2006               [Page 74]
> 
> Internet-Draft              Abbreviated Title                August 2005
4142a4149
>    DIRECT_DEBITING 0
4143a4151,4156
>    This indicates a request to decrease the end user's account according
>    to information specified in the Requested-Service-Unit AVP and/or
>    Service-Identifier AVP (additional rating information may be included
>    in service-specific AVPs or in the Service- Parameter-Info AVP).  The
>    Granted-Service-Unit AVP in the Credit- Control-Answer command
>    contains the debited units.
4144a4158
>    REFUND_ACCOUNT 1
4146,4148c4160,4165
< Hakala, et al.              Standards Track                    [Page 74]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    This indicates a request to increase the end user's account according
>    to information specified in the Requested-Service-Unit AVP and/or
>    Service-Identifier AVP (additional rating information may be included
>    in service-specific AVPs or in the Service- Parameter-Info AVP).  The
>    Granted-Service-Unit AVP in the Credit- Control-Answer command
>    contains the refunded units.
4149a4167
>    CHECK_BALANCE 2
4151,4157c4169,4172
<    REFUND_ACCOUNT                  1
<       This indicates a request to increase the end user's account
<       according to information specified in the Requested-Service-Unit
<       AVP and/or Service-Identifier AVP (additional rating information
<       may be included in service-specific AVPs or in the Service-
<       Parameter-Info AVP).  The Granted-Service-Unit AVP in the Credit-
<       Control-Answer command contains the refunded units.
---
>    This indicates a balance check request.  In this case, the checking
>    of the account balance is done without any credit reservation from
>    the account.  The Check-Balance-Result AVP in the Credit-Control-
>    Answer command contains the result of the balance check.
4159,4164c4174
<    CHECK_BALANCE                   2
<       This indicates a balance check request.  In this case, the
<       checking of the account balance is done without any credit
<       reservation from the account.  The Check-Balance-Result AVP in the
<       Credit-Control-Answer command contains the result of the balance
<       check.
---
>    PRICE_ENQUIRY 3
4166,4170c4176,4179
<    PRICE_ENQUIRY                   3
<       This indicates a price enquiry request.  In this case, neither
<       checking of the account balance nor reservation from the account
<       will be done; only the price of the service will be returned in
<       the Cost-Information AVP in the Credit-Control-Answer Command.
---
>    This indicates a price enquiry request.  In this case, neither
>    checking of the account balance nor reservation from the account will
>    be done; only the price of the service will be returned in the Cost-
>    Information AVP in the Credit-Control-Answer Command.
4187a4197,4204
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 75]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
4198,4206d4214
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 75]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
4232c4240,4244
<    [DIAMBASE]):
---
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Service-Parameter-Info ::= < AVP Header: 440 >
>                                     { Service-Parameter-Type }
>                                     { Service-Parameter-Value }
4234,4236d4245
<       Service-Parameter-Info ::= < AVP Header: 440 >
<                                  { Service-Parameter-Type }
<                                  { Service-Parameter-Value }
4243a4253,4260
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 76]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
4251,4262d4267
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 76]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
4276c4281,4285
<    [DIAMBASE]):
---
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          Subscription-Id ::= < AVP Header: 443 >
>                              { Subscription-Id-Type }
>                              { Subscription-Id-Data }
4278,4280d4286
<       Subscription-Id ::= < AVP Header: 443 >
<                           { Subscription-Id-Type }
<                           { Subscription-Id-Data }
4290,4299c4296,4301
<    designated expert, as defined in section 12.  A server MUST implement
<    all the Subscription-Id-Types required to perform credit
<    authorization for the services it supports, including possible future
<    values.  Unknown or unsupported Subscription-Id-Types MUST be treated
<    according to the 'M' flag rule, as defined in [DIAMBASE].
< 
<    END_USER_E164                   0
<       The identifier is in international E.164 format (e.g., MSISDN),
<       according to the ITU-T E.164 numbering plan defined in [E164] and
<       [CE164].
---
>    designated expert, as defined in section 12 (Section 12).  A server
>    MUST implement all the Subscription-Id-Types required to perform
>    credit authorization for the services it supports, including possible
>    future values.  Unknown or unsupported Subscription-Id-Types MUST be
>    treated according to the 'M' flag rule, as defined in [DIAMBASE]
>    [RFC3588].
4301,4303c4303
<    END_USER_IMSI                   1
<       The identifier is in international IMSI format, according to the
<       ITU-T E.212 numbering plan as defined in [E212] and [CE212].
---
>    END_USER_E164 0
4305,4306c4305,4307
<    END_USER_SIP_URI                2
<       The identifier is in the form of a SIP URI, as defined in [SIP].
---
>    The identifier is in international E.164 format (e.g., MSISDN),
>    according to the ITU-T E.164 numbering plan defined in [E164] and
>    [CE164].
4308,4310d4308
<    END_USER_NAI                    3
<       The identifier is in the form of a Network Access Identifier, as
<       defined in [NAI].
4314c4312
< Hakala, et al.              Standards Track                    [Page 77]
---
> Hakala, et al.          Expires February 2, 2006               [Page 77]
4316c4314
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4319,4320c4317,4333
<    END_USER_PRIVATE                4
<       The Identifier is a credit-control server private identifier.
---
>    END_USER_IMSI 1
> 
>    The identifier is in international IMSI format, according to the
>    ITU-T E.212 numbering plan as defined in [E212] and [CE212].
> 
>    END_USER_SIP_URI 2
> 
>    The identifier is in the form of a SIP URI, as defined in [SIP].
> 
>    END_USER_NAI 3
> 
>    The identifier is in the form of a Network Access Identifier, as
>    defined in [NAI].
> 
>    END_USER_PRIVATE 4
> 
>    The Identifier is a credit-control server private identifier.
4336c4349,4353
<    [DIAMBASE]):
---
>    [RFC3588] [DIAMBASE] [RFC3588]):
> 
>          User-Equipment-Info ::= < AVP Header: 458 >
>                                  { User-Equipment-Info-Type }
>                                  { User-Equipment-Info-Value }
4338,4340d4354
<       User-Equipment-Info ::= < AVP Header: 458 >
<                               { User-Equipment-Info-Type }
<                               { User-Equipment-Info-Value }
4344,4346c4358,4360
<    The User-Equipment-Info-Type AVP is of type Enumerated  (AVP Code
<    459) and defines the type of user equipment information contained in
<    the User-Equipment-Info-Value AVP.
---
>    The User-Equipment-Info-Type AVP is of type Enumerated (AVP Code 459)
>    and defines the type of user equipment information contained in the
>    User-Equipment-Info-Value AVP.
4350c4364
<    IANA designated expert, as defined in section 12.
---
>    IANA designated expert, as defined in section 12 (Section 12).
4352,4355d4365
<    IMEISV                          0
<       The identifier contains the International Mobile Equipment
<       Identifier and Software Version in the international IMEISV format
<       according to 3GPP TS 23.003 [3GPPIMEI].
4357,4358d4366
<    MAC                             1
<       The 48-bit MAC address is formatted as described in [RAD802.1X].
4360,4362c4368,4370
<    EUI64                           2
<       The 64-bit identifier used to identify hardware instance of the
<       product, as defined in [EUI64].
---
> Hakala, et al.          Expires February 2, 2006               [Page 78]
> 
> Internet-Draft              Abbreviated Title                August 2005
4364a4373
>    IMEISV 0
4365a4375,4377
>    The identifier contains the International Mobile Equipment Identifier
>    and Software Version in the international IMEISV format according to
>    3GPP TS 23.003 [3GPPIMEI].
4366a4379
>    MAC 1
4367a4381
>    The 48-bit MAC address is formatted as described in [RAD802.1X].
4368a4383
>    EUI64 2
4370,4372c4385,4386
< Hakala, et al.              Standards Track                    [Page 78]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    The 64-bit identifier used to identify hardware instance of the
>    product, as defined in [EUI64].
4373a4388
>    MODIFIED_EUI64 3
4375,4380c4390,4394
<    MODIFIED_EUI64                  3
<       There are a number of types of terminals that have identifiers
<       other than IMEI, IEEE 802 MACs, or EUI-64.  These identifiers can
<       be converted to modified EUI-64 format as described in [IPv6Addr]
<       or by using some other methods referred to in the service-specific
<       documentation.
---
>    There are a number of types of terminals that have identifiers other
>    than IMEI, IEEE 802 MACs, or EUI-64.  These identifiers can be
>    converted to modified EUI-64 format as described in [IPv6Addr] or by
>    using some other methods referred to in the service-specific
>    documentation.
4390,4392c4404,4406
<    This section defines new Result-Code AVP [DIAMBASE] values that must
<    be supported by all Diameter implementations that conform to this
<    specification.
---
>    This section defines new Result-Code AVP [DIAMBASE] [RFC3588] values
>    that must be supported by all Diameter implementations that conform
>    to this specification.
4406,4409c4420
<    DIAMETER_END_USER_SERVICE_DENIED           4010
<       The credit-control server denies the service request due to
<       service restrictions.  If the CCR contained used-service-units,
<       they are deducted, if possible.
---
>    DIAMETER_END_USER_SERVICE_DENIED 4010
4411,4414d4421
<    DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE     4011
<       The credit-control server determines that the service can be
<       granted to the end user but that no further credit-control is
<       needed for the service (e.g., service is free of charge).
4416,4419d4422
<    DIAMETER_CREDIT_LIMIT_REACHED              4012
<       The credit-control server denies the service request because the
<       end user's account could not cover the requested service.  If the
<       CCR contained used-service-units they are deducted, if possible.
4420a4424,4426
> Hakala, et al.          Expires February 2, 2006               [Page 79]
> 
> Internet-Draft              Abbreviated Title                August 2005
4422a4429,4431
>    The credit-control server denies the service request due to service
>    restrictions.  If the CCR contained used-service-units, they are
>    deducted, if possible.
4423a4433
>    DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE 4011
4424a4435,4437
>    The credit-control server determines that the service can be granted
>    to the end user but that no further credit-control is needed for the
>    service (e.g., service is free of charge).
4426,4428c4439
< Hakala, et al.              Standards Track                    [Page 79]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    DIAMETER_CREDIT_LIMIT_REACHED 4012
4429a4441,4443
>    The credit-control server denies the service request because the end
>    user's account could not cover the requested service.  If the CCR
>    contained used-service-units they are deducted, if possible.
4437,4438c4451,4453
<    DIAMETER_USER_UNKNOWN                      5030
<       The specified end user is unknown in the credit-control server.
---
>    DIAMETER_USER_UNKNOWN 5030
> 
>    The specified end user is unknown in the credit-control server.
4440,4449c4455,4465
<    DIAMETER_RATING_FAILED                     5031
<       This error code is used to inform the credit-control client that
<       the credit-control server cannot rate the service request due to
<       insufficient rating input, an incorrect AVP combination, or an AVP
<       or an AVP value that is not recognized or supported in the rating.
<       The Failed-AVP AVP MUST be included and contain a copy of the
<       entire AVP(s) that could not be processed successfully or an
<       example of the missing AVP complete with the Vendor-Id if
<       applicable.  The value field of the missing AVP should be of
<       correct minimum length and contain zeros.
---
>    DIAMETER_RATING_FAILED 5031
> 
>    This error code is used to inform the credit-control client that the
>    credit-control server cannot rate the service request due to
>    insufficient rating input, an incorrect AVP combination, or an AVP or
>    an AVP value that is not recognized or supported in the rating.  The
>    Failed-AVP AVP MUST be included and contain a copy of the entire
>    AVP(s) that could not be processed successfully or an example of the
>    missing AVP complete with the Vendor-Id if applicable.  The value
>    field of the missing AVP should be of correct minimum length and
>    contain zeros.
4460,4474d4475
<       0     The AVP MUST NOT be present in the message.
<       0+    Zero or more instances of the AVP MAY be present in the
<             message.
<       0-1   Zero or one instance of the AVP MAY be present in the
<             message.  It is considered an error if there is more
<             than one instance of the AVP.
<       1     One instance of the AVP MUST be present in the message.
<       1+    At least one instance of the AVP MUST be present in the
<             message.
< 
< 
< 
< 
< 
< 
4479,4482c4480
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 80]
---
> Hakala, et al.          Expires February 2, 2006               [Page 80]
4484c4482
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4486a4485,4491
>    0 The AVP MUST NOT be present in the message.  0+ Zero or more
>    instances of the AVP MAY be present in the message.  0-1 Zero or one
>    instance of the AVP MAY be present in the message.  It is considered
>    an error if there is more than one instance of the AVP.  1 One
>    instance of the AVP MUST be present in the message.  1+ At least one
>    instance of the AVP MUST be present in the message.
> 
4493,4534c4498,4532
<                                        +-----------+
<                                        |  Command  |
<                                        |   Code    |
<                                        |-----+-----+
<          Attribute Name                | CCR | CCA |
<          ------------------------------|-----+-----+
<          Acct-Multi-Session-Id         | 0-1 | 0-1 |
<          Auth-Application-Id           | 1   | 1   |
<          CC-Correlation-Id             | 0-1 | 0   |
<          CC-Session-Failover           | 0   | 0-1 |
<          CC-Request-Number             | 1   | 1   |
<          CC-Request-Type               | 1   | 1   |
<          CC-Sub-Session-Id             | 0-1 | 0-1 |
<          Check-Balance-Result          | 0   | 0-1 |
<          Cost-Information              | 0   | 0-1 |
<          Credit-Control-Failure-       | 0   | 0-1 |
<             Handling                   |     |     |
<          Destination-Host              | 0-1 | 0   |
<          Destination-Realm             | 1   | 0   |
<          Direct-Debiting-Failure-      | 0   | 0-1 |
<             Handling                   |     |     |
<          Event-Timestamp               | 0-1 | 0-1 |
<          Failed-AVP                    | 0   | 0+  |
<          Final-Unit-Indication         | 0   | 0-1 |
<          Granted-Service-Unit          | 0   | 0-1 |
<          Multiple-Services-Credit-     | 0+  | 0+  |
<             Control                    |     |     |
<          Multiple-Services-Indicator   | 0-1 | 0   |
<          Origin-Host                   | 1   | 1   |
<          Origin-Realm                  | 1   | 1   |
<          Origin-State-Id               | 0-1 | 0-1 |
<          Proxy-Info                    | 0+  | 0+  |
<          Redirect-Host                 | 0   | 0+  |
<          Redirect-Host-Usage           | 0   | 0-1 |
<          Redirect-Max-Cache-Time       | 0   | 0-1 |
<          Requested-Action              | 0-1 | 0   |
<          Requested-Service-Unit        | 0-1 | 0   |
<          Route-Record                  | 0+  | 0+  |
<          Result-Code                   | 0   | 1   |
<          Service-Context-Id            | 1   | 0   |
<          Service-Identifier            | 0-1 | 0   |
<          Service-Parameter-Info        | 0+  | 0   |
---
>                                           +-----------+
>                                           |  Command  |
>                                           |   Code    |
>                                           |-----+-----+
>             Attribute Name                | CCR | CCA |
>             ------------------------------|-----+-----+
>             Acct-Multi-Session-Id         | 0-1 | 0-1 |
>             Auth-Application-Id           | 1   | 1   |
>             CC-Correlation-Id             | 0-1 | 0   |
>             CC-Session-Failover           | 0   | 0-1 |
>             CC-Request-Number             | 1   | 1   |
>             CC-Request-Type               | 1   | 1   |
>             CC-Sub-Session-Id             | 0-1 | 0-1 |
>             Check-Balance-Result          | 0   | 0-1 |
>             Cost-Information              | 0   | 0-1 |
>             Credit-Control-Failure-       | 0   | 0-1 |
>                Handling                   |     |     |
>             Destination-Host              | 0-1 | 0   |
>             Destination-Realm             | 1   | 0   |
>             Direct-Debiting-Failure-      | 0   | 0-1 |
>                Handling                   |     |     |
>             Event-Timestamp               | 0-1 | 0-1 |
>             Failed-AVP                    | 0   | 0+  |
>             Final-Unit-Indication         | 0   | 0-1 |
>             Granted-Service-Unit          | 0   | 0-1 |
>             Multiple-Services-Credit-     | 0+  | 0+  |
>                Control                    |     |     |
>             Multiple-Services-Indicator   | 0-1 | 0   |
>             Origin-Host                   | 1   | 1   |
>             Origin-Realm                  | 1   | 1   |
>             Origin-State-Id               | 0-1 | 0-1 |
>             Proxy-Info                    | 0+  | 0+  |
>             Redirect-Host                 | 0   | 0+  |
>             Redirect-Host-Usage           | 0   | 0-1 |
>             Redirect-Max-Cache-Time       | 0   | 0-1 |
4538,4550c4536,4555
< Hakala, et al.              Standards Track                    [Page 81]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<          Session-Id                    | 1   | 1   |
<          Subscription-Id               | 0+  | 0   |
<          Termination-Cause             | 0-1 | 0   |
<          User-Equipment-Info           | 0-1 | 0   |
<          Used-Service-Unit             | 0+  | 0   |
<          User-Name                     | 0-1 | 0-1 |
<          Validity-Time                 | 0   | 0-1 |
<          ------------------------------|-----+-----+
---
> Hakala, et al.          Expires February 2, 2006               [Page 81]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>             Requested-Action              | 0-1 | 0   |
>             Requested-Service-Unit        | 0-1 | 0   |
>             Route-Record                  | 0+  | 0+  |
>             Result-Code                   | 0   | 1   |
>             Service-Context-Id            | 1   | 0   |
>             Service-Identifier            | 0-1 | 0   |
>             Service-Parameter-Info        | 0+  | 0   |
>             Session-Id                    | 1   | 1   |
>             Subscription-Id               | 0+  | 0   |
>             Termination-Cause             | 0-1 | 0   |
>             User-Equipment-Info           | 0-1 | 0   |
>             Used-Service-Unit             | 0+  | 0   |
>             User-Name                     | 0-1 | 0-1 |
>             Validity-Time                 | 0   | 0-1 |
>             ------------------------------|-----+-----+
4556c4561
<    Auth-Request/Answer (RAR/RAA) message [DIAMBASE].
---
>    Auth-Request/Answer (RAR/RAA) message [DIAMBASE] [RFC3588].
4561,4570c4566,4575
<                                        +---------------+
<                                        | Command Code  |
<                                        |-------+-------+
<          Attribute Name                |  RAR  |  RAA  |
<          ------------------------------+-------+-------+
<          CC-Sub-Session-Id             |  0-1  |  0-1  |
<          G-S-U-Pool-Identifier         |  0-1  |  0-1  |
<          Service-Identifier            |  0-1  |  0-1  |
<          Rating-Group                  |  0-1  |  0-1  |
<          ------------------------------+-------+-------+
---
>                                           +---------------+
>                                           | Command Code  |
>                                           |-------+-------+
>             Attribute Name                |  RAR  |  RAA  |
>             ------------------------------+-------+-------+
>             CC-Sub-Session-Id             |  0-1  |  0-1  |
>             G-S-U-Pool-Identifier         |  0-1  |  0-1  |
>             Service-Identifier            |  0-1  |  0-1  |
>             Rating-Group                  |  0-1  |  0-1  |
>             ------------------------------+-------+-------+
4582a4588,4596
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 82]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
4592,4598d4605
< 
< 
< Hakala, et al.              Standards Track                    [Page 82]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
4605,4622c4612,4630
<                                   RADIUS Prepaid
<    +--------+       +---------+   protocol +------------+  +--------+
<    |  End   |<----->| Service |<---------->| Home AAA   |  |Business|
<    |  User  |       | Element |            |  Server    |  |Support |
<    +--------+   +-->|         |            |+----------+|->|System  |
<                 |   +---------+            ||CC Client ||  |        |
<                 |                          |+----------+|  |        |
<    +--------+   |                          +------^-----+  +----^---+
<    |  End   |<--+                Credit-Control   |             |
<    |  User  |                          Protocol   |             |
<    +--------+                             +-------V--------+    |
<                                           |Credit-Control  |----+
<                                           |   Server       |
<                                           +----------------+
< 
<         Figure 7: Credit-control architecture with service element
<                   containing translation agent, translating RADIUS
<                   prepaid to Diameter credit-control protocol
---
>                                      RADIUS Prepaid
>       +--------+       +---------+   protocol +------------+  +--------+
>       |  End   |<----->| Service |<---------->| Home AAA   |  |Business|
>       |  User  |       | Element |            |  Server    |  |Support |
>       +--------+   +-->|         |            |+----------+|->|System  |
>                    |   +---------+            ||CC Client ||  |        |
>                    |                          |+----------+|  |        |
>       +--------+   |                          +------^-----+  +----^---+
>       |  End   |<--+                Credit-Control   |             |
>       |  User  |                          Protocol   |             |
>       +--------+                             +-------V--------+    |
>                                              |Credit-Control  |----+
>                                              |   Server       |
>                                              +----------------+
> 
> 
>    Figure 7: Credit-control architecture with service element containing
>      translation agent, translating RADIUS prepaid to Diameter credit-
>                              control protocol
4635a4644,4652
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 83]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
4648,4654d4664
< 
< 
< Hakala, et al.              Standards Track                    [Page 83]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
4664a4675,4676
>    A following diagram illustrates a RADIUS prepaid - Diameter credit-
>    control interworking sequence.
4692,4706c4704
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 84]
---
> Hakala, et al.          Expires February 2, 2006               [Page 84]
4708c4706
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4711,4712c4709,4742
<    A following diagram illustrates a RADIUS prepaid - Diameter credit-
<    control interworking sequence.
---
>          Service Element         Translation Agent
>            (e.g., NAS)               (CC Client)             CC Server
>                |     Access-Request     |                        |
>                |----------------------->|                        |
>                |                        |    CCR (initial)       |
>                |                        |----------------------->|
>                |                        |    CCA (Granted-Units) |
>                |                        |<-----------------------|
>                |     Access-Accept      |                        |
>                |     (Granted-Units)    |                        |
>                |<-----------------------|                        |
>                :                        :                        :
>                |     Access-Request     |                        |
>                |     (Used-Units)       |                        |
>                |----------------------->|                        |
>                |                        |    CCR (update,        |
>                |                        |         Used-Units)    |
>                |                        |----------------------->|
>                |                        |    CCA (Granted-Units) |
>                |                        |<-----------------------|
>                |     Access-Accept      |                        |
>                |     (Granted-Units)    |                        |
>                |<-----------------------|                        |
>                :                        :                        :
>                |     Access-Request     |                        |
>                |----------------------->|                        |
>                |                        |     CCR (terminate,    |
>                |                        |          Used-Units)   |
>                |                        |----------------------->|
>                |                        |     CCA                |
>                |                        |<-----------------------|
>                |     Access-Accept      |                        |
>                |<-----------------------|                        |
>                |                        |                        |
4714,4747d4743
<       Service Element         Translation Agent
<         (e.g., NAS)               (CC Client)             CC Server
<             |     Access-Request     |                        |
<             |----------------------->|                        |
<             |                        |    CCR (initial)       |
<             |                        |----------------------->|
<             |                        |    CCA (Granted-Units) |
<             |                        |<-----------------------|
<             |     Access-Accept      |                        |
<             |     (Granted-Units)    |                        |
<             |<-----------------------|                        |
<             :                        :                        :
<             |     Access-Request     |                        |
<             |     (Used-Units)       |                        |
<             |----------------------->|                        |
<             |                        |    CCR (update,        |
<             |                        |         Used-Units)    |
<             |                        |----------------------->|
<             |                        |    CCA (Granted-Units) |
<             |                        |<-----------------------|
<             |     Access-Accept      |                        |
<             |     (Granted-Units)    |                        |
<             |<-----------------------|                        |
<             :                        :                        :
<             |     Access-Request     |                        |
<             |----------------------->|                        |
<             |                        |     CCR (terminate,    |
<             |                        |          Used-Units)   |
<             |                        |----------------------->|
<             |                        |     CCA                |
<             |                        |<-----------------------|
<             |     Access-Accept      |                        |
<             |<-----------------------|                        |
<             |                        |                        |
4749,4750c4745,4746
<            Figure 8: Message flow example with RADIUS prepaid -
<                   Diameter credit-control interworking
---
>    Figure 8: Message flow example with RADIUS prepaid - Diameter credit-
>                            control interworking
4757a4754,4755
>    In the subsections below, when we speak about review by a Designated
>    Expert, please note that the designated expert will be assigned by
4762c4760
< Hakala, et al.              Standards Track                    [Page 85]
---
> Hakala, et al.          Expires February 2, 2006               [Page 85]
4764c4762
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4767,4768d4764
<    In the subsections below, when we speak about review by a Designated
<    Expert, please note that the designated expert will be assigned by
4775,4776c4771,4772
<    the Application Identifier namespace defined in [DIAMBASE].  See
<    section 1.3 for more information.
---
>    the Application Identifier namespace defined in [DIAMBASE] [RFC3588].
>    See section 1.3 (Section 1.3) for more information.
4781,4782c4777,4778
<    defined in [DIAMBASE] for the Credit-Control-Request (CCR) and
<    Credit-Control-Answer (CCA) commands.
---
>    defined in [DIAMBASE] [RFC3588] for the Credit-Control-Request (CCR)
>    and Credit-Control-Answer (CCA) commands.
4787,4788c4783,4784
<    namespace defined in [DIAMBASE].  See section 8 for the assignment of
<    the namespace in this specification.
---
>    namespace defined in [DIAMBASE] [RFC3588].  See section 8 (Section 8)
>    for the assignment of the namespace in this specification.
4793,4794c4789,4791
<    from the Result-Code AVP value namespace defined in [DIAMBASE].  See
<    section 9 for the assignment of the namespace in this specification.
---
>    from the Result-Code AVP value namespace defined in [DIAMBASE]
>    [RFC3588].  See section 9 (Section 9) for the assignment of the
>    namespace in this specification.
4798,4801c4795,4798
<    As defined in section 8.3, the CC-Request-Type AVP includes
<    Enumerated type values 1 - 4.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.3 (Section 8.3), the CC-Request-Type AVP
>    includes Enumerated type values 1 - 4.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4805,4812c4802,4805
<    As defined in section 8.4, the CC-Failover-Supported AVP includes
<    Enumerated type values 0 - 1.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
< 
< 
< 
< 
---
>    As defined in section 8.4 (Section 8.4), the CC-Failover-Supported
>    AVP includes Enumerated type values 0 - 1.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4813a4807
> 12.7.  CC-Unit-Type AVP
4814a4809,4812
>    As defined in section 8.32 (Section 8.32), the CC-Unit-Type AVP
>    includes Enumerated type values 0 - 5.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4818c4816
< Hakala, et al.              Standards Track                    [Page 86]
---
> Hakala, et al.          Expires February 2, 2006               [Page 86]
4820,4823c4818
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< 12.7.  CC-Unit-Type AVP
---
> Internet-Draft              Abbreviated Title                August 2005
4825,4828d4819
<    As defined in section 8.32, the CC-Unit-Type AVP includes Enumerated
<    type values 0 - 5.  IANA has created and is maintaining a namespace
<    for this AVP.  All remaining values are available for assignment by a
<    Designated Expert [IANA].
4832,4835c4823,4826
<    As defined in section 8.6, the Check-Balance-Result AVP includes
<    Enumerated type values 0 - 1.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.6 (Section 8.6), the Check-Balance-Result AVP
>    includes Enumerated type values 0 - 1.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4839,4842c4830,4833
<    As defined in section 8.13, the Credit-Control AVP includes
<    Enumerated type values 0 - 1.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.13 (Section 8.13), the Credit-Control AVP
>    includes Enumerated type values 0 - 1.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4846,4849c4837,4840
<    As defined in section 8.14, the Credit-Control-Failure-Handling AVP
<    includes Enumerated type values 0 - 2.  IANA has created and is
<    maintaining a namespace for this AVP.  All remaining values are
<    available for assignment by a Designated Expert [IANA].
---
>    As defined in section 8.14 (Section 8.14), the Credit-Control-
>    Failure-Handling AVP includes Enumerated type values 0 - 2.  IANA has
>    created and is maintaining a namespace for this AVP.  All remaining
>    values are available for assignment by a Designated Expert [IANA].
4853,4856c4844,4847
<    As defined in section 8.15, the Direct-Debiting-Failure-Handling AVP
<    includes Enumerated type values 0 - 1.  IANA has created and is
<    maintaining a namespace for this AVP.  All remaining values are
<    available for assignment by a Designated Expert [IANA].
---
>    As defined in section 8.15 (Section 8.15), the Direct-Debiting-
>    Failure-Handling AVP includes Enumerated type values 0 - 1.  IANA has
>    created and is maintaining a namespace for this AVP.  All remaining
>    values are available for assignment by a Designated Expert [IANA].
4860,4863c4851,4854
<    As defined in section 8.35, the Final-Unit-Action AVP includes
<    Enumerated type values 0 - 2.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.35 (Section 8.35), the Final-Unit-Action AVP
>    includes Enumerated type values 0 - 2.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4867,4868c4858,4866
<    As defined in section 8.40, the Multiple-Services-Indicator AVP
<    includes Enumerated type values 0 - 1.  IANA has created and is
---
>    As defined in section 8.40 (Section 8.40), the Multiple-Services-
>    Indicator AVP includes Enumerated type values 0 - 1.  IANA has
>    created and is maintaining a namespace for this AVP.  All remaining
>    values are available for assignment by a Designated Expert [IANA].
> 
> 12.14.  Redirect-Address-Type AVP
> 
>    As defined in section 8.38 (Section 8.38), the Redirect-Address-Type
>    AVP includes Enumerated type values 0 - 3.  IANA has created and is
4874c4872
< Hakala, et al.              Standards Track                    [Page 87]
---
> Hakala, et al.          Expires February 2, 2006               [Page 87]
4876,4879c4874
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< 12.14.  Redirect-Address-Type AVP
---
> Internet-Draft              Abbreviated Title                August 2005
4881,4884d4875
<    As defined in section 8.38, the Redirect-Address-Type AVP includes
<    Enumerated type values 0 - 3.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
4888,4891c4879,4882
<    As defined in section 8.41, the Requested-Action AVP includes
<    Enumerated type values 0 - 3.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.41 (Section 8.41), the Requested-Action AVP
>    includes Enumerated type values 0 - 3.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4895,4912c4886,4903
<    As defined in section 8.47, the Subscription-Id-Type AVP  includes
<    Enumerated type values 0 - 4.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
< 
< 12.17.   Tariff-Change-Usage AVP
< 
<    As defined in section 8.27, the Tariff-Change-Usage AVP includes
<    Enumerated type values 0 - 2.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
< 
< 12.18.   User-Equipment-Info-Type AVP
< 
<    As defined in section 8.50, the User-Equipment-Info-Type AVP includes
<    Enumerated type values 0 - 3.  IANA has created and is maintaining a
<    namespace for this AVP.  All remaining values are available for
<    assignment by a Designated Expert [IANA].
---
>    As defined in section 8.47 (Section 8.47), the Subscription-Id-Type
>    AVP includes Enumerated type values 0 - 4.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
> 
> 12.17.  Tariff-Change-Usage AVP
> 
>    As defined in section 8.27 (Section 8.27), the Tariff-Change-Usage
>    AVP includes Enumerated type values 0 - 2.  IANA has created and is
>    maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
> 
> 12.18.  User-Equipment-Info-Type AVP
> 
>    As defined in section 8.50 (Section 8.50), the User-Equipment-Info-
>    Type AVP includes Enumerated type values 0 - 3.  IANA has created and
>    is maintaining a namespace for this AVP.  All remaining values are
>    available for assignment by a Designated Expert [IANA].
4918,4926c4909,4917
<       When real-time credit-control is required, the credit-control
<       client contacts the credit-control server before and while the
<       service is provided to an end user.  Due to the real-time nature
<       of the application, the communication delays SHOULD be minimized;
<       e.g., to avoid an overly long service setup time experienced by
<       the end user.  The Tx timer is introduced to control the waiting
<       time in the client in the Pending state.  When the Tx timer
<       elapses, the credit-control client takes an action to the end user
<       according to the value of the Credit-Control-Failure-Handling AVP
---
>    When real-time credit-control is required, the credit-control client
>    contacts the credit-control server before and while the service is
>    provided to an end user.  Due to the real-time nature of the
>    application, the communication delays SHOULD be minimized; e.g., to
>    avoid an overly long service setup time experienced by the end user.
>    The Tx timer is introduced to control the waiting time in the client
>    in the Pending state.  When the Tx timer elapses, the credit-control
>    client takes an action to the end user according to the value of the
>    Credit-Control-Failure-Handling AVP
4927a4919,4920
>    or Direct-Debiting-Failure-Handling AVP.  The recommended value is 10
>    seconds.
4928a4922
>    Tcc timer
4930,4932d4923
< Hakala, et al.              Standards Track                    [Page 88]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
4935,4936d4925
<       or Direct-Debiting-Failure-Handling AVP.  The recommended value is
<       10 seconds.
4938d4926
<    Tcc timer
4940,4945c4928,4938
<       The Tcc timer supervises an ongoing credit-control session in the
<       credit-control server.  It is RECOMMENDED to use the Validity-Time
<       as input to set the Tcc timer value.  In case of transient
<       failures in the network, the Diameter credit-control server might
<       change to Idle state.  To avoid this, the Tcc timer MAY be set so
<       that Tcc equals to 2 x Validity-Time.
---
> Hakala, et al.          Expires February 2, 2006               [Page 88]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    The Tcc timer supervises an ongoing credit-control session in the
>    credit-control server.  It is RECOMMENDED to use the Validity-Time as
>    input to set the Tcc timer value.  In case of transient failures in
>    the network, the Diameter credit-control server might change to Idle
>    state.  To avoid this, the Tcc timer MAY be set so that Tcc equals to
>    2 x Validity-Time.
4949,4952c4942,4946
<       Client implementations may offer the possibility of locally
<       configuring these AVPs.  In such a case their value and behavior
<       is defined in section 5.7 for the Credit-Control-Failure-Handling
<       and in section 6.5 for the Direct-Debiting-Failure-Handling.
---
>    Client implementations may offer the possibility of locally
>    configuring these AVPs.  In such a case their value and behavior is
>    defined in section 5.7 (Section 5.7) for the Credit-Control-Failure-
>    Handling and in section 6.5 (Section 6.5) for the Direct-Debiting-
>    Failure-Handling.
4956,4970c4950,4965
<    The Diameter base protocol [DIAMBASE] requires that each Diameter
<    implementation use underlying security; i.e., IPsec or TLS.  These
<    mechanisms are believed to provide sufficient protection under the
<    normal Internet threat model; that is, assuming that the authorized
<    nodes engaging in the protocol have not been compromised, but that
<    the attacker has complete control over the communication channels
<    between them.  This includes eavesdropping, message modification,
<    insertion, and man-in-the-middle and replay attacks.  Note also that
<    this application includes a mechanism for application layer replay
<    protection by means of the Session-Id from [DIAMBASE] and CC-
<    Request-Number, which is specified in this document.  The Diameter
<    credit-control application is often used within one domain, and there
<    may be a single hop between the peers.  In these environments, the
<    use of TLS or IPsec is sufficient.  The details of TLS and IPsec
<    related security considerations are discussed in the [DIAMBASE].
---
>    The Diameter base protocol [DIAMBASE] [RFC3588] requires that each
>    Diameter implementation use underlying security; i.e., IPsec or TLS.
>    These mechanisms are believed to provide sufficient protection under
>    the normal Internet threat model; that is, assuming that the
>    authorized nodes engaging in the protocol have not been compromised,
>    but that the attacker has complete control over the communication
>    channels between them.  This includes eavesdropping, message
>    modification, insertion, and man-in-the-middle and replay attacks.
>    Note also that this application includes a mechanism for application
>    layer replay protection by means of the Session-Id from [DIAMBASE]
>    [RFC3588] and CC- Request-Number, which is specified in this
>    document.  The Diameter credit-control application is often used
>    within one domain, and there may be a single hop between the peers.
>    In these environments, the use of TLS or IPsec is sufficient.  The
>    details of TLS and IPsec related security considerations are
>    discussed in the [DIAMBASE] [RFC3588].
4981a4977,4980
>    Another kind of threat is malicious modification, injection, or
>    deletion of AVPs or complete credit-control messages.  The credit-
>    control messages contain sensitive billing related information (such
>    as subscription Id, granted units, used units, cost information)
4985,4986c4984
< 
< Hakala, et al.              Standards Track                    [Page 89]
---
> Hakala, et al.          Expires February 2, 2006               [Page 89]
4988c4986
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
4991,4994d4988
<    Another kind of threat is malicious modification, injection, or
<    deletion of AVPs or complete credit-control messages.  The credit-
<    control messages contain sensitive billing related information (such
<    as subscription Id, granted units, used units, cost information)
5002,5003c4996,4997
<    credit-control messages one can collect information about the
<    credit-control server's billing models and business relationships.
---
>    credit-control messages one can collect information about the credit-
>    control server's billing models and business relationships.
5019,5033c5013,5027
<    [DIAMBASE], section 2.7) for the realm of the credit-control server
<    in the end user's home domain.  The Diameter credit-control agent can
<    have a default route configured to a local Redirect agent, and it
<    redirects the CCR message to the redirect agent.  The local Redirect
<    agent then returns a redirect notification (Result-code 3006,
<    DIAMETER_REDIRECT_INDICATION) to the credit-control agent, as well as
<    Diameter credit-control server(s) information (Redirect-Host AVP) and
<    information (Redirect-Host-Usage AVP) about how the routing entry
<    resulting from the Redirect-Host is to be used.  The Diameter
<    credit-control agent then forwards the CCR message directly to one of
<    the hosts identified by the CCA message from the redirect agent.  If
<    the value of the Redirect-Host-Usage AVP is unequal to zero, all
<    following messages are sent to the host specified in the Redirect-
<    Host AVP until the time specified by the Redirect-Max-Cache-Time AVP
<    is expired.
---
>    [DIAMBASE] [RFC3588], section 2.7) for the realm of the credit-
>    control server in the end user's home domain.  The Diameter credit-
>    control agent can have a default route configured to a local Redirect
>    agent, and it redirects the CCR message to the redirect agent.  The
>    local Redirect agent then returns a redirect notification (Result-
>    code 3006, DIAMETER_REDIRECT_INDICATION) to the credit-control agent,
>    as well as Diameter credit-control server(s) information (Redirect-
>    Host AVP) and information (Redirect-Host-Usage AVP) about how the
>    routing entry resulting from the Redirect-Host is to be used.  The
>    Diameter credit-control agent then forwards the CCR message directly
>    to one of the hosts identified by the CCA message from the redirect
>    agent.  If the value of the Redirect-Host-Usage AVP is unequal to
>    zero, all following messages are sent to the host specified in the
>    Redirect- Host AVP until the time specified by the Redirect-Max-
>    Cache-Time AVP is expired.
5038c5032,5035
<    discussed more widely in [DIAMEAP], section 8.
---
>    discussed more widely in [DIAMEAP], section 8 (Section 8).
> 
> 
> 
5042c5039,5040
< Hakala, et al.              Standards Track                    [Page 90]
---
> 
> Hakala, et al.          Expires February 2, 2006               [Page 90]
5044c5042
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5051,5053c5049,5053
<    [DIAMBASE]  Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J.
<                Arkko, "Diameter Base Protocol", RFC 3588, September
<                2003.
---
>    [_3GPPCHARG]
>               3rd Generation Partnership Project, "Technical
>               Specification Group Services and System Aspects, Service
>               aspects; Charging and Billing, (release 5), 3GPP TS 22.115
>               v. 5.2.1", 2002-03.
5055,5058c5055,5059
<    [3GPPCHARG] 3rd Generation Partnership Project; Technical
<                Specification Group Services and System Aspects, Service
<                aspects; Charging and Billing, (release 5), 3GPP TS
<                22.115 v. 5.2.1, 2002-03.
---
>    [_3GPPIMEI]
>               3rd Generation Partnership Project, "Technical
>               Specification Group Core Network, Numbering, addressing
>               and identification, (release 5), 3GPP TS 23.003 v. 5.8.0",
>               2003-12.
5060,5063c5061,5063
<    [SIP]       Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
<                A., Peterson, J., Sparks, R., Handley, M., and E.
<                Schooler, "SIP:  Session Initiation Protocol", RFC 3261,
<                June 2002.
---
>    [CE164]    "Complement to ITU-T Recommendation E.164 (05/1997):"List
>               of ITU-T Recommendation E.164 assigned country codes"",
>               June 2000.
5065,5066c5065,5067
<    [NAI]       Aboba, B. and M. Beadles, "The Network Access
<                Identifier", RFC 2486, January 1999.
---
>    [CE212]    "Complement to ITU-T Recommendation E.212 (11/1997):" List
>               of mobile country or geographical area codes"", February
>               1999.
5068,5069c5069,5070
<    [E164]      Recommendation E.164/I.331 (05/97): The International
<                Public Telecommunication Numbering Plan. 1997.
---
>    [E164]     "Recommendation E.164/I.331 (05/97): The International
>               Public Telecommunication Numbering Plan.", 1997.
5071,5073c5072,5074
<    [CE164]     Complement to ITU-T Recommendation E.164 (05/1997):"List
<                of ITU-T Recommendation E.164 assigned country codes",
<                June 2000.
---
>    [E212]     "Recommendation E.212 (11/98): The international
>               identification plan for mobile terminals and mobile
>               users.", 1998.
5075,5077c5076,5079
<    [E212]      Recommendation E.212 (11/98): The international
<                identification plan for mobile terminals and mobile
<                users. 1998.
---
>    [EUI64]    IEEE, ""Guidelines for 64-bit Global Identifier (EUI-64)
>               Registration Authority"", March 1997,
>               <http://standards.ieee.org/regauth/oui/tutorials/
>               EUI64.html >.
5079,5081c5081,5082
<    [CE212]     Complement to ITU-T Recommendation E.212 (11/1997):" List
<                of mobile country or geographical area codes", February
<                1999.
---
>    [ISO4217]  "Codes for the representation of currencies and funds,
>               International Standard ISO 4217", 2001.
5083,5085c5084,5086
<    [IANA]      Narten, T. and H. Alvestrand, "Guidelines for Writing an
<                IANA Considerations Section in RFCs", BCP 26, RFC 2434,
<                October 1998.
---
>    [RFC0791]  Postel, J., "Internet Protocol", STD 5, RFC 791,
>               DOI 10.17487/RFC0791, September 1981,
>               <http://www.rfc-editor.org/info/rfc791>.
5087,5088c5088,5090
<    [IPv4]      Postel, J., "Internet Protocol", STD 5, RFC 791,
<                September 1981.
---
>    [RFC1738]  Berners-Lee, T., Masinter, L., and M. McCahill, "Uniform
>               Resource Locators (URL)", RFC 1738, DOI 10.17487/RFC1738,
>               December 1994, <http://www.rfc-editor.org/info/rfc1738>.
5090,5091d5091
<    [IPv6Addr]  Hinden, R. and S. Deering, "Internet Protocol Version 6
<                (IPv6) Addressing Architecture", RFC 3513, April 2003.
5093,5094d5092
<    [KEYWORDS]  Bradner, S., "Key words for use in RFCs to Indicate
<                Requirement Levels", BCP 14, RFC 2119, March 1997.
5098c5096
< Hakala, et al.              Standards Track                    [Page 91]
---
> Hakala, et al.          Expires February 2, 2006               [Page 91]
5100,5101c5098
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
> Internet-Draft              Abbreviated Title                August 2005
5103,5104d5099
<    [ISO4217]   Codes for the representation of currencies and funds,
<                International Standard ISO 4217,2001
5106,5108c5101,5104
<    [NASREQ]    Calhoun, P., Zorn, G., Spence, D., and D. Mitton,
<                "Diameter Network Access Server Application", RFC 4005,
<                August 2005.
---
>    [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
>               Requirement Levels", BCP 14, RFC 2119,
>               DOI 10.17487/RFC2119, March 1997,
>               <http://www.rfc-editor.org/info/rfc2119>.
5110,5111c5106,5109
<    [AAATRANS]  Aboba, B. and J. Wood, "Authentication, Authorization and
<                Accounting (AAA) Transport Profile", RFC 3539, June 2003.
---
>    [RFC2434]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
>               IANA Considerations Section in RFCs", RFC 2434,
>               DOI 10.17487/RFC2434, October 1998,
>               <http://www.rfc-editor.org/info/rfc2434>.
5113,5114c5111,5113
<    [URL]       Berners-Lee, T., Masinter, L., and M. McCahill, "Uniform
<                Resource Locators (URL)", RFC 1738, December 1994.
---
>    [RFC2486]  Aboba, B. and M. Beadles, "The Network Access Identifier",
>               RFC 2486, DOI 10.17487/RFC2486, January 1999,
>               <http://www.rfc-editor.org/info/rfc2486>.
5116,5119c5115,5119
<    [RAD802.1X] Congdon, P., Aboba, B., Smith, A., Zorn, G., and J.
<                Roese, "IEEE 802.1X Remote Authentication Dial In User
<                Service (RADIUS) Usage Guidelines", RFC 3580, September
<                2003.
---
>    [RFC3261]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
>               A., Peterson, J., Sparks, R., Handley, M., and E.
>               Schooler, "SIP: Session Initiation Protocol", RFC 3261,
>               DOI 10.17487/RFC3261, June 2002,
>               <http://www.rfc-editor.org/info/rfc3261>.
5121,5124c5121,5124
<    [EUI64]     IEEE, "Guidelines for 64-bit Global Identifier (EUI-64)
<                Registration Authority",
<                http://standards.ieee.org/regauth/oui/tutorials/
<                EUI64.html March 1997.
---
>    [RFC3513]  Hinden, R. and S. Deering, "Internet Protocol Version 6
>               (IPv6) Addressing Architecture", RFC 3513,
>               DOI 10.17487/RFC3513, April 2003,
>               <http://www.rfc-editor.org/info/rfc3513>.
5126,5129c5126,5129
<    [3GPPIMEI]  3rd Generation Partnership Project; Technical
<                Specification Group Core Network, Numbering, addressing
<                and identification, (release 5), 3GPP TS 23.003 v. 5.8.0,
<                2003-12
---
>    [RFC3539]  Aboba, B. and J. Wood, "Authentication, Authorization and
>               Accounting (AAA) Transport Profile", RFC 3539,
>               DOI 10.17487/RFC3539, June 2003,
>               <http://www.rfc-editor.org/info/rfc3539>.
5131c5131,5135
< 15.2.  Informative References
---
>    [RFC3580]  Congdon, P., Aboba, B., Smith, A., Zorn, G., and J. Roese,
>               "IEEE 802.1X Remote Authentication Dial In User Service
>               (RADIUS) Usage Guidelines", RFC 3580,
>               DOI 10.17487/RFC3580, September 2003,
>               <http://www.rfc-editor.org/info/rfc3580>.
5133c5137,5140
<    [RFC2866]   Rigney, C., "RADIUS Accounting", RFC 2866, June 2000.
---
>    [RFC3588]  Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J.
>               Arkko, "Diameter Base Protocol", RFC 3588,
>               DOI 10.17487/RFC3588, September 2003,
>               <http://www.rfc-editor.org/info/rfc3588>.
5135,5137c5142,5145
<    [DIAMMIP]   Calhoun, P., Johansson, T., Perkins, C., Hiller, T., and
<                P. McCann, "Diameter Mobile IPv4 Application", RFC 4004,
<                August 2005.
---
>    [RFC4005]  Calhoun, P., Zorn, G., Spence, D., and D. Mitton,
>               "Diameter Network Access Server Application", RFC 4005,
>               DOI 10.17487/RFC4005, August 2005,
>               <http://www.rfc-editor.org/info/rfc4005>.
5139,5146d5146
<    [DIAMEAP]   Eronen, P., Hiller, T., and G. Zorn, "Diameter Extensible
<                Authentication Protocol (EAP) Application", Work in
<                Progress.
< 
<    [RFC3725]   Rosenberg, J., Peterson, J., Schulzrinne, H., and G.
<                Camarillo, "Best Current Practices for Third Party Call
<                Control (3pcc) in the Session Initiation Protocol (SIP)",
<                BCP 85, RFC 3725, April 2004.
5151a5152,5154
> Hakala, et al.          Expires February 2, 2006               [Page 92]
> 
> Internet-Draft              Abbreviated Title                August 2005
5154,5156c5157
< Hakala, et al.              Standards Track                    [Page 92]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> 15.2.  Informative References
5157a5159,5176
>    [DIAMEAP]  Eronen, P., Hiller, T., and G. Zorn, "Diameter Extensible
>               Authentication Protocol (EAP) Application", Work in
>               Progress.
> 
>    [RFC2866]  Rigney, C., "RADIUS Accounting", RFC 2866,
>               DOI 10.17487/RFC2866, June 2000,
>               <http://www.rfc-editor.org/info/rfc2866>.
> 
>    [RFC3725]  Rosenberg, J., Peterson, J., Schulzrinne, H., and G.
>               Camarillo, "Best Current Practices for Third Party Call
>               Control (3pcc) in the Session Initiation Protocol (SIP)",
>               BCP 85, RFC 3725, DOI 10.17487/RFC3725, April 2004,
>               <http://www.rfc-editor.org/info/rfc3725>.
> 
>    [RFC4004]  Calhoun, P., Johansson, T., Perkins, C., Hiller, T., Ed.,
>               and P. McCann, "Diameter Mobile IPv4 Application",
>               RFC 4004, DOI 10.17487/RFC4004, August 2005,
>               <http://www.rfc-editor.org/info/rfc4004>.
5159c5178
< 16.  Acknowledgements
---
> Appendix A.  Acknowledgements
5166a5186
> Appendix B.  Credit-Control Sequences
5167a5188
> B.1.  Flow I
5187,5210c5208
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 93]
---
> Hakala, et al.          Expires February 2, 2006               [Page 93]
5212,5213c5210
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
> Internet-Draft              Abbreviated Title                August 2005
5215d5211
< Appendix A.  Credit-Control Sequences
5217,5219c5213
< A.1.  Flow I
< 
<                          NAS
---
>                                NAS
5260c5254
<                             Figure A.1: Flow I
---
>                              Figure 6: Flow I
5261a5256,5259
>    A credit-control flow for Network Access Services prepaid is shown in
>    Figure A.1.  The Diameter [NASREQ] is implemented in the Network
>    Access Server (NAS).  The focus of this flow is in the credit
>    authorization.
5266c5264
< Hakala, et al.              Standards Track                    [Page 94]
---
> Hakala, et al.          Expires February 2, 2006               [Page 94]
5268c5266
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5271,5275d5268
<    A credit-control flow for Network Access Services prepaid is shown in
<    Figure A.1.  The Diameter [NASREQ] is implemented in the Network
<    Access Server (NAS).  The focus of this flow is in the credit
<    authorization.
< 
5286,5315c5279,5289
<    server to perform credit authorization (3) and to establish a
<    credit-control session.  (The home Diameter AAA server may forward
<    service-specific AVPs received from the NAS as input for the rating
<    process.)  The Diameter credit-control server checks the end user's
<    account balance, rates the service, and reserves credit from the end
<    user's account.  The reserved quota is returned to the home Diameter
<    AAA server in the Diameter Credit-Control-Answer (4).  The home
<    Diameter AAA server sends the reserved quota to the NAS in the
<    Diameter AA-Answer (AAA).  Upon successful AAA, the NAS starts the
<    credit-control session and starts monitoring the granted units (5).
<    The NAS grants access to the end user (6).  At the expiry of the
<    allocated quota, the NAS sends a Diameter Credit-Control-Request with
<    CC-Request-Type set to UPDATE_REQUEST to the Home Diameter AAA server
<    (7).  This message contains the units used thus far.  The home
<    Diameter AAA server forwards the CCR to the Diameter credit-control
<    server (8).  The Diameter credit-control server debits the used units
<    from the end user's account and allocates a new quota that is
<    returned to the home Diameter AAA server in the Diameter Credit-
<    Control-Answer (9).  The message is forwarded to the NAS (10).
<    During the ongoing credit-control session, the authorization lifetime
<    expires, and the authorization/authentication client in the NAS
<    performs service specific re-authorization to the home Diameter AAA
<    server, as usual.  The credit-control client populates the AAR with
<    the Credit-Control AVP set to RE_AUTHORIZATION, indicating that the
<    credit-control server shall not be contacted, as the credit
<    authorization is controlled by the burning rate of the granted units
<    (11).  The home Diameter AAA server performs service-specific re-
<    authorization as usual and returns the AA-Answer to the NAS (12).
<    The end user logs off from the network (13).  To debit the used units
<    from the end user's account and to stop the credit-control session,
---
>    server to perform credit authorization (3) and to establish a credit-
>    control session.  (The home Diameter AAA server may forward service-
>    specific AVPs received from the NAS as input for the rating process.)
>    The Diameter credit-control server checks the end user's account
>    balance, rates the service, and reserves credit from the end user's
>    account.  The reserved quota is returned to the home Diameter AAA
>    server in the Diameter Credit-Control-Answer (4).  The home Diameter
>    AAA server sends the reserved quota to the NAS in the Diameter AA-
>    Answer (AAA).  Upon successful AAA, the NAS starts the credit-control
>    session and starts monitoring the granted units (5).  The NAS grants
>    access to the end user (6).  At the expiry of the allocated quota,
5317,5373c5291,5316
<    set to TERMINATION_REQUEST to the home Diameter AAA server (14).  The
<    home Diameter AAA server forwards the CCR to the credit-control
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 95]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<    server (15).  The Diameter credit-control server acknowledges the
<    session termination by sending a Diameter Credit-Control-Answer to
<    the home Diameter AAA server (16).  The home Diameter AAA server
<    forwards the answer to the NAS (17).  STR/STA takes place between the
<    NAS and home Diameter AAA server, as usual (18-19).
< 
< A.2.  Flow II
< 
<               SIP Proxy/Registrar   AAA
<         A           (CC Client)     Server           B        CC Server
<         |(i)  REGISTER |              |              |              |
<         |------------->|(ii)          |              |              |
<         |              |------------->|              |              |
<         |              |authentication &             |              |
<         |              |authorization |              |              |
<         |              |<-------------|              |              |
<         |(iii)200 OK   |                             |              |
<         |<-------------|                             |              |
<         :              :                             :              :
<         |(1)  INVITE   |                                            :
<         |------------->|
<         |              |(2)  CCR (Initial, SIP specific AVP)        |
<         |              |------------------------------------------->|
<         |              |(3)  CCA (Granted-Units)                    |
<         |              |<-------------------------------------------|
<         |              |(4)  INVITE                  |              |
<         |              |---------------------------->|              |
<         :              :                             :              :
<         |              |(5)  CCR (update, Used-Units)               |
<         |              |------------------------------------------->|
<         |              |(6)  CCA (Granted-Units)                    |
<         |              |<-------------------------------------------|
<         :              :                             :              :
<         |(7)  BYE      |                             |              |
<         |------------->|                             |              |
<         |              |(8)  BYE                     |              |
<         |              |---------------------------->|              |
<         |              |(9)  CCR (termination, Used-Units)          |
<         |              |------------------------------------------->|
<         |              |(10) CCA ()                                 |
<         |              |<-------------------------------------------|
<         |              |                             |              |
< 
<                            Figure A.2: Flow II
< 
< 
< 
---
>    set to UPDATE_REQUEST to the Home Diameter AAA server (7).  This
>    message contains the units used thus far.  The home Diameter AAA
>    server forwards the CCR to the Diameter credit-control server (8).
>    The Diameter credit-control server debits the used units from the end
>    user's account and allocates a new quota that is returned to the home
>    Diameter AAA server in the Diameter Credit- Control-Answer (9).  The
>    message is forwarded to the NAS (10).  During the ongoing credit-
>    control session, the authorization lifetime expires, and the
>    authorization/authentication client in the NAS performs service
>    specific re-authorization to the home Diameter AAA server, as usual.
>    The credit-control client populates the AAR with the Credit-Control
>    AVP set to RE_AUTHORIZATION, indicating that the credit-control
>    server shall not be contacted, as the credit authorization is
>    controlled by the burning rate of the granted units (11).  The home
>    Diameter AAA server performs service-specific re- authorization as
>    usual and returns the AA-Answer to the NAS (12).  The end user logs
>    off from the network (13).  To debit the used units from the end
>    user's account and to stop the credit-control session, the NAS sends
>    a Diameter Credit-Control-Request with CC-Request-Type set to
>    TERMINATION_REQUEST to the home Diameter AAA server (14).  The home
>    Diameter AAA server forwards the CCR to the credit-control server
>    (15).  The Diameter credit-control server acknowledges the session
>    termination by sending a Diameter Credit-Control-Answer to the home
>    Diameter AAA server (16).  The home Diameter AAA server forwards the
>    answer to the NAS (17).  STR/STA takes place between the NAS and home
>    Diameter AAA server, as usual (18-19).
5376a5320,5360
> Hakala, et al.          Expires February 2, 2006               [Page 95]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
> B.2.  Flow II
> 
>                SIP Proxy/Registrar   AAA
>          A           (CC Client)     Server           B        CC Server
>          |(i)  REGISTER |              |              |              |
>          |------------->|(ii)          |              |              |
>          |              |------------->|              |              |
>          |              |authentication &             |              |
>          |              |authorization |              |              |
>          |              |<-------------|              |              |
>          |(iii)200 OK   |                             |              |
>          |<-------------|                             |              |
>          :              :                             :              :
>          |(1)  INVITE   |                                            :
>          |------------->|
>          |              |(2)  CCR (Initial, SIP specific AVP)        |
>          |              |------------------------------------------->|
>          |              |(3)  CCA (Granted-Units)                    |
>          |              |<-------------------------------------------|
>          |              |(4)  INVITE                  |              |
>          |              |---------------------------->|              |
>          :              :                             :              :
>          |              |(5)  CCR (update, Used-Units)               |
>          |              |------------------------------------------->|
>          |              |(6)  CCA (Granted-Units)                    |
>          |              |<-------------------------------------------|
>          :              :                             :              :
>          |(7)  BYE      |                             |              |
>          |------------->|                             |              |
>          |              |(8)  BYE                     |              |
>          |              |---------------------------->|              |
>          |              |(9)  CCR (termination, Used-Units)          |
>          |              |------------------------------------------->|
>          |              |(10) CCA ()                                 |
>          |              |<-------------------------------------------|
>          |              |                             |              |
5378,5381c5362
< Hakala, et al.              Standards Track                    [Page 96]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
---
>                              Figure 7: Flow II
5391a5373,5380
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 96]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
5431,5438d5419
< 
< 
< 
< Hakala, et al.              Standards Track                    [Page 97]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
5445d5425
< A.3.  Flow III
5447,5466d5426
<                           MMS Server
<              A           (CC Client)           B           CC Server
<              |(1) Send MMS    |                |                |
<              |--------------->|                |                |
<              |                |(2)  CCR (event, DIRECT_DEBITING,|
<              |                |          MMS specific AVP)      |
<              |                |-------------------------------->|
<              |                |(3)  CCA (Granted-Units)         |
<              |                |<--------------------------------|
<              |(4) Send MMS Ack|                |                |
<              |<---------------|                |                |
<              |                |(5) Notify MMS  |                |
<              |                |--------------->|                |
<              :                :                :                :
<              |                |(6) Retrieve MMS|                |
<              |                |<---------------|                |
<              |                |(7) Retrieve MMS|                |
<              |                |    Ack         |                |
<              |                |--------------->|                |
<              |                |                |                |
5468c5428,5460
<                              Figure A.3: Flow III
---
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006               [Page 97]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
> B.3.  Flow III
> 
>                             MMS Server
>                 A           (CC Client)           B           CC Server
>                 |(1) Send MMS    |                |                |
>                 |--------------->|                |                |
>                 |                |(2)  CCR (event, DIRECT_DEBITING,|
>                 |                |          MMS specific AVP)      |
>                 |                |-------------------------------->|
>                 |                |(3)  CCA (Granted-Units)         |
>                 |                |<--------------------------------|
>                 |(4) Send MMS Ack|                |                |
>                 |<---------------|                |                |
>                 |                |(5) Notify MMS  |                |
>                 |                |--------------->|                |
>                 :                :                :                :
>                 |                |(6) Retrieve MMS|                |
>                 |                |<---------------|                |
>                 |                |(7) Retrieve MMS|                |
>                 |                |    Ack         |                |
>                 |                |--------------->|                |
>                 |                |                |                |
> 
>                             Figure 8: Flow III
5487a5480,5483
> B.4.  Flow IV
> 
> 
> 
5490,5492d5485
< Hakala, et al.              Standards Track                    [Page 98]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
5495c5488,5491
< A.4.  Flow IV
---
> Hakala, et al.          Expires February 2, 2006               [Page 98]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
5497,5521c5493,5517
<                           MMS Server
<       Content Server     (CC Client)           B           CC Server
<              |(1) Send MMS    |                |                |
<              |--------------->|                |                |
<              |                |(2)  CCR (event, CHECK_BALANCE,  |
<              |                |          MMS specific AVP)      |
<              |                |-------------------------------->|
<              |                |(3)  CCA (ENOUGH_CREDIT)         |
<              |                |<--------------------------------|
<              |(4) Send MMS Ack|                |                |
<              |<---------------|                |                |
<              |                |(5) Notify MMS  |                |
<              |                |--------------->|                |
<              :                :                :                :
<              |                |(6) Retrieve MMS|                |
<              |                |<---------------|                |
<              |                |(7)  CCR (event, DIRECT_DEBITING,|
<              |                |          MMS specific AVP)      |
<              |                |-------------------------------->|
<              |                |(8)  CCA (Granted-Units)         |
<              |                |<--------------------------------|
<              |                |(9) Retrieve MMS|                |
<              |                |    Ack         |                |
<              |                |--------------->|                |
<              |                |                |                |
---
>                              MMS Server
>          Content Server     (CC Client)           B           CC Server
>                 |(1) Send MMS    |                |                |
>                 |--------------->|                |                |
>                 |                |(2)  CCR (event, CHECK_BALANCE,  |
>                 |                |          MMS specific AVP)      |
>                 |                |-------------------------------->|
>                 |                |(3)  CCA (ENOUGH_CREDIT)         |
>                 |                |<--------------------------------|
>                 |(4) Send MMS Ack|                |                |
>                 |<---------------|                |                |
>                 |                |(5) Notify MMS  |                |
>                 |                |--------------->|                |
>                 :                :                :                :
>                 |                |(6) Retrieve MMS|                |
>                 |                |<---------------|                |
>                 |                |(7)  CCR (event, DIRECT_DEBITING,|
>                 |                |          MMS specific AVP)      |
>                 |                |-------------------------------->|
>                 |                |(8)  CCA (Granted-Units)         |
>                 |                |<--------------------------------|
>                 |                |(9) Retrieve MMS|                |
>                 |                |    Ack         |                |
>                 |                |--------------->|                |
>                 |                |                |                |
5523c5519
<                               Figure A.4: Flow IV
---
>                              Figure 9: Flow IV
5542a5539,5540
>    (EVENT_REQUEST with Requested-Action CHECK_BALANCE) to verify that
>    end user B can cover the cost for the MMS (2).  The Diameter credit-
5546c5544
< Hakala, et al.              Standards Track                    [Page 99]
---
> Hakala, et al.          Expires February 2, 2006               [Page 99]
5548c5546
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5551,5552d5548
<    (EVENT_REQUEST with Requested-Action CHECK_BALANCE) to verify that
<    end user B can cover the cost for the MMS (2).  The Diameter credit-
5573,5595c5569
< A.5.  Flow V
< 
<                         SIP Controller
<              A           (CC Client)           B           CC Server
<              |(1)INVITE B(SDP)|                |                |
<              |--------------->|                |                |
<              |                |(2)  CCR (event, PRICE_ENQUIRY,  |
<              |                |          SIP specific AVPs)     |
<              |                |-------------------------------->|
<              |                |(3)  CCA (Cost-Information)      |
<              |                |<--------------------------------|
<              | (4)MESSAGE(URL)|                |                |
<              |<---------------|                |                |
<              |(5)HTTP GET     |                |                |
<              |--------------->|                |                |
<              |(6)HTTP POST    |                |                |
<              |--------------->|(7)INVITE(SDP)  |                |
<              |                |--------------->|                |
<              |                |      (8)200 OK |                |
<              |      (9)200 OK |<---------------|                |
<              |<---------------|                |                |
< 
<                             Figure A.5: Flow V
---
> B.5.  Flow V
5596a5571,5589
>                            SIP Controller
>                 A           (CC Client)           B           CC Server
>                 |(1)INVITE B(SDP)|                |                |
>                 |--------------->|                |                |
>                 |                |(2)  CCR (event, PRICE_ENQUIRY,  |
>                 |                |          SIP specific AVPs)     |
>                 |                |-------------------------------->|
>                 |                |(3)  CCA (Cost-Information)      |
>                 |                |<--------------------------------|
>                 | (4)MESSAGE(URL)|                |                |
>                 |<---------------|                |                |
>                 |(5)HTTP GET     |                |                |
>                 |--------------->|                |                |
>                 |(6)HTTP POST    |                |                |
>                 |--------------->|(7)INVITE(SDP)  |                |
>                 |                |--------------->|                |
>                 |                |      (8)200 OK |                |
>                 |      (9)200 OK |<---------------|                |
>                 |<---------------|                |                |
5597a5591
>                              Figure 10: Flow V
5598a5593,5596
>    This is an example of Diameter credit-control for SIP sessions.
>    Although the flow focuses on illustrating the usage of credit-control
>    messages, the SIP signaling is inaccurate, and the diagram is not by
>    any means an attempt to define a service provider's SIP network.
5602c5600
< Hakala, et al.              Standards Track                   [Page 100]
---
> Hakala, et al.          Expires February 2, 2006              [Page 100]
5604c5602
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5607,5611d5604
<    This is an example of Diameter credit-control for SIP sessions.
<    Although the flow focuses on illustrating the usage of credit-control
<    messages, the SIP signaling is inaccurate, and the diagram is not by
<    any means an attempt to define a service provider's SIP network.
< 
5641a5635
> B.6.  Flow VI
5642a5637,5649
>                               Gaming Server
>        End User                (CC Client)              CC Server
>           |  (1)Service Delivery   |                        |
>           |<---------------------->|                        |
>           :                        :                        :
>           :                        :                        :
>           |                        |(2)CCR(event,REFUND,Requested-
>           |                        |Service-Unit,Service-Parameter-Info)
>           |                        |----------------------->|
>           |                        |  (3)CCA(Cost-Information)
>           |                        |<-----------------------|
>           |        (4)Notification |                        |
>           |<-----------------------|                        |
5643a5651
>                             Figure 11: Flow VI
5648,5658c5656
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 101]
---
> Hakala, et al.          Expires February 2, 2006              [Page 101]
5660c5658
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5663,5680d5660
< A.6.  Flow VI
< 
<                              Gaming Server
<       End User                (CC Client)              CC Server
<          |  (1)Service Delivery   |                        |
<          |<---------------------->|                        |
<          :                        :                        :
<          :                        :                        :
<          |                        |(2)CCR(event,REFUND,Requested-
<          |                        |Service-Unit,Service-Parameter-Info)
<          |                        |----------------------->|
<          |                        |  (3)CCA(Cost-Information)
<          |                        |<-----------------------|
<          |        (4)Notification |                        |
<          |<-----------------------|                        |
< 
<                           Figure A.6: Flow VI
< 
5700a5681
> B.7.  Flow VII
5704,5749c5685
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 102]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< A.7.  Flow VII
< 
<                   SIP Controller    Top-Up
<         A          (CC Client)      Server           B      CC Server
<         |               |              |             |              |
<         |               | (1) CCR(Update,Used-Unit)  |              |
<         |               |------------------------------------------>|
<         |               |              (2) CCA(Final-Unit, Redirect)|
<         |               |<------------------------------------------|
<         :               :              :             :              :
<         :               :              :             :              :
<         |               | (3) CCR(Update, Used-Units)|              |
<         |               |------------------------------------------>|
<         |               | (3a)INVITE("hold")         |              |
<         |               |--------------------------->|              |
<         |               |              |      (4) CCA(Validity-Time)|
<         |               |<------------------------------------------|
<         |     (5)INVITE | (6)INVITE    |             |              |
<         |<--------------|------------->|             |              |
<         |            (7)RTP            |             |              |
<         |..............................|             |              |
<         |               |       (8)BYE |             |              |
<         |               |<-------------|             |              |
<         |               | (9)CCR(Update)             |              |
<         |               |------------------------------------------>|
<         |               |                     (10)CCA(Granted-Unit) |
<         |               |<------------------------------------------|
<         |    (12)INVITE | (11)INVITE                 |              |
<         |<--------------|--------------------------->|              |
< 
<                            Figure A.7: Flow VII
---
>                             Figure 12: Flow VII
5767,5774d5702
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 103]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
5781,5782c5709,5718
<    with the appropriate connection address in the SDP (3a).  The
<    Credit-Control-Request message contains the units used thus far.  The
---
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 102]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>    with the appropriate connection address in the SDP (3a).  The Credit-
>    Control-Request message contains the units used thus far.  The
5784,5801c5720,5740
<    user's account but does not make any credit reservation.  The
<    Credit-Control-Answer message, which contains the Validity-Time to
<    supervise the graceful service termination, is returned to the SIP
<    controller (4).  The SIP controller establishes a SIP session between
<    the prepaid user and the Top-up server (5, 6).  The Top-up server
<    plays an announcement and prompts the user to enter a credit card
<    number and the amount of money to be used to replenish the account
<    (7).  The Top-up server validates the credit card number and
<    replenishes the user's account (using some means outside the scope of
<    this specification) and releases the SIP session (8).  The SIP
<    controller can now assume that communication between the prepaid user
<    and the Top-up server took place.  It sends a spontaneous Credit-
<    Control-Request (UPDATE_REQUEST) to the Diameter credit-control
<    server to check whether the account has been replenished (9).  The
<    Diameter credit-control server reserves credit from the end user's
<    account and returns the reserved quota to the SIP controller in the
<    Credit-Control-Answer (10).  At this point, the SIP controller re-
<    connects the caller and the called party (11,12).
---
>    user's account but does not make any credit reservation.  The Credit-
>    Control-Answer message, which contains the Validity-Time to supervise
>    the graceful service termination, is returned to the SIP controller
>    (4).  The SIP controller establishes a SIP session between the
>    prepaid user and the Top-up server (5, 6).  The Top-up server plays
>    an announcement and prompts the user to enter a credit card number
>    and the amount of money to be used to replenish the account (7).  The
>    Top-up server validates the credit card number and replenishes the
>    user's account (using some means outside the scope of this
>    specification) and releases the SIP session (8).  The SIP controller
>    can now assume that communication between the prepaid user and the
>    Top-up server took place.  It sends a spontaneous Credit- Control-
>    Request (UPDATE_REQUEST) to the Diameter credit-control server to
>    check whether the account has been replenished (9).  The Diameter
>    credit-control server reserves credit from the end user's account and
>    returns the reserved quota to the SIP controller in the Credit-
>    Control-Answer (10).  At this point, the SIP controller re- connects
>    the caller and the called party (11,12).
> 
> B.8.  Flow VIII
> 
5826c5765,5768
< Hakala, et al.              Standards Track                   [Page 104]
---
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 103]
5828c5770
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5831c5773,5800
< A.8.  Flow VIII
---
>                           NAS                           Top-up      CC
>     End-User         (CC Client)          AAA Server    Server    Server
>       |(1)User Logon      |(2)AA Request (CC AVPs)        |         |
>       |------------------>|------------------->|          |         |
>       |                   |                    |(3)CCR(initial, CC AVPs)
>       |                   |                    |------------------->|
>       |                   |                    |(4)CCA(Final-Unit,  |
>       |                   |                    |      Validity-Time)|
>       |                   |                    |<-------------------|
>       |                   |(5)AA Answer(Final-Unit,Validity-Time)   |
>       |(6)Limited Access  |<-------------------|          |         |
>       |      granted      |                    |          |         |
>       |<----------------->|                    |          |         |
>       |                   |                    |          |         |
>       |   (7)TCP/HTTP     |        (8)TCP/HTTP            |         |
>       |<----------------->|<----------------------------->|         |
>       |                 (9) Replenish account             |         |
>       |<------------------------------------------------->|         |
>       |                   |                    |            (10)RAR |
>       |                   |<-------------------|<-------------------|
>       |                   | (11) RAA           |                    |
>       |                   |------------------->|------------------->|
>       |                   |(12)CCR(update)     |                    |
>       |                   |------------------->|(13)CCR(Update)     |
>       |                   |                    |------------------->|
>       |                   |                    |(14)CCA(Granted-Units)
>       |                   |(15)CCA(Granted-Units)<------------------|
>       |                   |<-------------------|                    |
5833,5860d5801
<                          NAS                           Top-up      CC
<    End-User         (CC Client)          AAA Server    Server    Server
<      |(1)User Logon      |(2)AA Request (CC AVPs)        |         |
<      |------------------>|------------------->|          |         |
<      |                   |                    |(3)CCR(initial, CC AVPs)
<      |                   |                    |------------------->|
<      |                   |                    |(4)CCA(Final-Unit,  |
<      |                   |                    |      Validity-Time)|
<      |                   |                    |<-------------------|
<      |                   |(5)AA Answer(Final-Unit,Validity-Time)   |
<      |(6)Limited Access  |<-------------------|          |         |
<      |      granted      |                    |          |         |
<      |<----------------->|                    |          |         |
<      |                   |                    |          |         |
<      |   (7)TCP/HTTP     |        (8)TCP/HTTP            |         |
<      |<----------------->|<----------------------------->|         |
<      |                 (9) Replenish account             |         |
<      |<------------------------------------------------->|         |
<      |                   |                    |            (10)RAR |
<      |                   |<-------------------|<-------------------|
<      |                   | (11) RAA           |                    |
<      |                   |------------------->|------------------->|
<      |                   |(12)CCR(update)     |                    |
<      |                   |------------------->|(13)CCR(Update)     |
<      |                   |                    |------------------->|
<      |                   |                    |(14)CCA(Granted-Units)
<      |                   |(15)CCA(Granted-Units)<------------------|
<      |                   |<-------------------|                    |
5862c5803
<                          Figure A.8: Flow VIII
---
>                            Figure 13: Flow VIII
5878a5820
>    Request with CC-Request-Type set to INITIAL_REQUEST to the Diameter
5882c5824
< Hakala, et al.              Standards Track                   [Page 105]
---
> Hakala, et al.          Expires February 2, 2006              [Page 104]
5884c5826
< RFC 4006          Diameter Credit-Control Application        August 2005
---
> Internet-Draft              Abbreviated Title                August 2005
5887d5828
<    Request with CC-Request-Type set to INITIAL_REQUEST to the Diameter
5914,5919c5855,5860
<    this specification)(9).  After successful account top-up, the
<    credit-control server sends a Re-Auth-Request message to the NAS
<    (10).  The NAS acknowledges the request by returning the Re-Auth-
<    Answer message (11) and initiates the credit re-authorization by
<    sending a Credit-Control-request (UPDATE_REQUEST) to the Diameter
<    credit-control server (12,13).
---
>    this specification)(9).  After successful account top-up, the credit-
>    control server sends a Re-Auth-Request message to the NAS (10).  The
>    NAS acknowledges the request by returning the Re-Auth- Answer message
>    (11) and initiates the credit re-authorization by sending a Credit-
>    Control-request (UPDATE_REQUEST) to the Diameter credit-control
>    server (12,13).
5927,5943c5868
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 106]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< A.9.  Flow IX
---
> B.9.  Flow IX
5951a5877,5884
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 105]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
5960,6044c5893,6009
<    End User         Service Element                           CC Server
<                        (CC client)
<       |(1)User logon      |                                         |
<       |------------------>|(2)CCR(initial, Service-Id access,       |
<       |                   |        Access specific AVPs,            |
<       |                   |        Multiple-Service-Indicator)      |
<       |                   |---------------------------------------->|
<       |                   |(3)CCA(Multiple-Services-CC (            |
<       |                   |        Granted-Units(Total-Octets),     |
<       |                   |        Service-Id access,               |
<       |                   |        Validity-time,                   |
<       |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
<       |                   |          Multiplier 10)))               |
<       |                   |<----------------------------------------|
<       :                   :                                         :
<       |(4)Service-Request (Service 1)                               |
<       |------------------>|(5)CCR(update, Multiple-Services-CC(     |
<       |                   |        Requested-Units(), Service-Id 1, |
<       |                   |        Rating-Group 1))                 |
<       |                   |---------------------------------------->|
<       |                   |(6)CCA(Multiple-Services-CC (            |
<       |                   |        Granted-Units(Time),             |
<       |                   |        Rating-Group 1,                  |
<       |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
<       |                   |          Multiplier 1)))                |
<       |                   |<----------------------------------------|
<       :                   :                                         :
<       |(7)Service-Request (Service 2)                               |
<       |------------------>|                                         |
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 107]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<       :                   :                                         :
<       :                   :                                         :
<       |(8)Service-Request (Service 3&4)                             |
<       |------------------>|(9)CCR(update, Multiple-Services-CC (    |
<       |                   |        Requested-Units(), Service-Id 3, |
<       |                   |        Rating-Group 2),                 |
<       |                   |        Multiple-Services-CC (           |
<       |                   |        Requested-Units(), Service-Id 4, |
<       |                   |        Rating-Group 3))                 |
<       |                   |---------------------------------------->|
<       |                   |(10)CCA(Multiple-Services-CC (           |
<       |                   |        Granted-Units(Total-Octets),     |
<       |                   |        Service-Id 3, Rating-Group 2,    |
<       |                   |        Validity-time,                   |
<       |                   |        G-S-U-Pool-Reference(Pool-Id 2,  |
<       |                   |          Multiplier 2)),                |
<       |                   |        Multiple-Services-CC (           |
<       |                   |        Granted-Units(Total-Octets),     |
<       |                   |        Service-Id 4, Rating-Group 3     |
<       |                   |        Validity-Time,                   |
<       |                   |        Final-Unit-Ind.(Terminate),      |
<       |                   |        G-S-U-Pool-Reference(Pool-Id 2,  |
<       |                   |          Multiplier 5)))                |
<       |                   |<----------------------------------------|
<       :                   :                                         :
<       :                   :                                         :
<       | +--------------+  |                                         |
<       | |Validity time |  |(11)CCR(update,                          |
<       | |expires for   |  |        Multiple-Services-CC (           |
<       | |Service-Id    |  |        Requested-Unit(),                |
<       | | access       |  |        Used-Units(In-Octets,Out-Octets),|
<       | +--------------+  |        Service-Id access))              |
<       |                   |---------------------------------------->|
<       |                   |(12)CCA(Multiple-Services-CC (           |
<       |                   |        Granted-Units(Total-Octets),     |
<       |                   |        Service-Id access,               |
<       |                   |        Validity-Time,                   |
<       |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
<       |                   |          Multiplier 10)))               |
<       |                   |<----------------------------------------|
<       :                   :                                         :
<       :                   :                                         :
< 
< 
< 
< 
---
>     End User         Service Element                           CC Server
>                         (CC client)
>        |(1)User logon      |                                         |
>        |------------------>|(2)CCR(initial, Service-Id access,       |
>        |                   |        Access specific AVPs,            |
>        |                   |        Multiple-Service-Indicator)      |
>        |                   |---------------------------------------->|
>        |                   |(3)CCA(Multiple-Services-CC (            |
>        |                   |        Granted-Units(Total-Octets),     |
>        |                   |        Service-Id access,               |
>        |                   |        Validity-time,                   |
>        |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
>        |                   |          Multiplier 10)))               |
>        |                   |<----------------------------------------|
>        :                   :                                         :
>        |(4)Service-Request (Service 1)                               |
>        |------------------>|(5)CCR(update, Multiple-Services-CC(     |
>        |                   |        Requested-Units(), Service-Id 1, |
>        |                   |        Rating-Group 1))                 |
>        |                   |---------------------------------------->|
>        |                   |(6)CCA(Multiple-Services-CC (            |
>        |                   |        Granted-Units(Time),             |
>        |                   |        Rating-Group 1,                  |
>        |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
>        |                   |          Multiplier 1)))                |
>        |                   |<----------------------------------------|
>        :                   :                                         :
>        |(7)Service-Request (Service 2)                               |
>        |------------------>|                                         |
>        :                   :                                         :
>        :                   :                                         :
>        |(8)Service-Request (Service 3&4)                             |
>        |------------------>|(9)CCR(update, Multiple-Services-CC (    |
>        |                   |        Requested-Units(), Service-Id 3, |
>        |                   |        Rating-Group 2),                 |
>        |                   |        Multiple-Services-CC (           |
>        |                   |        Requested-Units(), Service-Id 4, |
>        |                   |        Rating-Group 3))                 |
>        |                   |---------------------------------------->|
>        |                   |(10)CCA(Multiple-Services-CC (           |
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 106]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>        |                   |        Granted-Units(Total-Octets),     |
>        |                   |        Service-Id 3, Rating-Group 2,    |
>        |                   |        Validity-time,                   |
>        |                   |        G-S-U-Pool-Reference(Pool-Id 2,  |
>        |                   |          Multiplier 2)),                |
>        |                   |        Multiple-Services-CC (           |
>        |                   |        Granted-Units(Total-Octets),     |
>        |                   |        Service-Id 4, Rating-Group 3     |
>        |                   |        Validity-Time,                   |
>        |                   |        Final-Unit-Ind.(Terminate),      |
>        |                   |        G-S-U-Pool-Reference(Pool-Id 2,  |
>        |                   |          Multiplier 5)))                |
>        |                   |<----------------------------------------|
>        :                   :                                         :
>        :                   :                                         :
>        | +--------------+  |                                         |
>        | |Validity time |  |(11)CCR(update,                          |
>        | |expires for   |  |        Multiple-Services-CC (           |
>        | |Service-Id    |  |        Requested-Unit(),                |
>        | | access       |  |        Used-Units(In-Octets,Out-Octets),|
>        | +--------------+  |        Service-Id access))              |
>        |                   |---------------------------------------->|
>        |                   |(12)CCA(Multiple-Services-CC (           |
>        |                   |        Granted-Units(Total-Octets),     |
>        |                   |        Service-Id access,               |
>        |                   |        Validity-Time,                   |
>        |                   |        G-S-U-Pool-Reference(Pool-Id 1,  |
>        |                   |          Multiplier 10)))               |
>        |                   |<----------------------------------------|
>        :                   :                                         :
>        :                   :                                         :
>        | +--------------+  |                                         |
>        | |Total Quota   |  |(13)CCR(update,                          |
>        | |elapses for   |  |       Multiple-Services-CC (            |
>        | |pool 2:       |  |        Requested-Unit(),                |
>        | |service 4 not |  |        Used-Units(In-Octets,Out-Octets),|
>        | |allowed,      |  |        Service-Id 3, Rating-group 2),   |
>        | |service 3 cont|  |       Multiple-Services-CC (            |
>        | +--------------+  |        Used-Units(In-Octets,Out-Octets),|
>        |                   |        Service-Id 4, Rating-Group 3))   |
>        |                   |---------------------------------------->|
>        |                   |(14)CCA(Multiple-Services-CC (           |
>        |                   |        Result-Code 4011,                |
>        |                   |        Service-Id 3))                   |
>        |                   |<----------------------------------------|
>        :                   :                                         :
>        :                   :                                         :
>        |(15) User logoff   |                                         |
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 107]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
>        |------------------>|(16)CCR(term,                            |
>        |                   |       Multiple-Services-CC (            |
>        |                   |        Used-Units(In-Octets,Out-Octets),|
>        |                   |        Service-Id access),              |
>        |                   |       Multiple-Services-CC (            |
>        |                   |        Used-Units(Time),                |
>        |                   |        Service-Id 1, Rating-Group 1),   |
>        |                   |       Multiple-Services-CC (            |
>        |                   |        Used-Units(Time),                |
>        |                   |        Service-Id 2, Rating-Group 1))   |
>        |                   |---------------------------------------->|
>        |                   |(17)CCA(term)                            |
>        |                   |<----------------------------------------|
6046,6087c6011,6012
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 108]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
<       | +--------------+  |                                         |
<       | |Total Quota   |  |(13)CCR(update,                          |
<       | |elapses for   |  |       Multiple-Services-CC (            |
<       | |pool 2:       |  |        Requested-Unit(),                |
<       | |service 4 not |  |        Used-Units(In-Octets,Out-Octets),|
<       | |allowed,      |  |        Service-Id 3, Rating-group 2),   |
<       | |service 3 cont|  |       Multiple-Services-CC (            |
<       | +--------------+  |        Used-Units(In-Octets,Out-Octets),|
<       |                   |        Service-Id 4, Rating-Group 3))   |
<       |                   |---------------------------------------->|
<       |                   |(14)CCA(Multiple-Services-CC (           |
<       |                   |        Result-Code 4011,                |
<       |                   |        Service-Id 3))                   |
<       |                   |<----------------------------------------|
<       :                   :                                         :
<       :                   :                                         :
<       |(15) User logoff   |                                         |
<       |------------------>|(16)CCR(term,                            |
<       |                   |       Multiple-Services-CC (            |
<       |                   |        Used-Units(In-Octets,Out-Octets),|
<       |                   |        Service-Id access),              |
<       |                   |       Multiple-Services-CC (            |
<       |                   |        Used-Units(Time),                |
<       |                   |        Service-Id 1, Rating-Group 1),   |
<       |                   |       Multiple-Services-CC (            |
<       |                   |        Used-Units(Time),                |
<       |                   |        Service-Id 2, Rating-Group 1))   |
<       |                   |---------------------------------------->|
<       |                   |(17)CCA(term)                            |
<       |                   |<----------------------------------------|
< 
<       Figure A.9: Flow example independent credit-control of multiple
<                   services in a  credit-control (sub-)Session
---
>       Figure 14: Flow example independent credit-control of multiple
>                 services in a credit-control (sub-)Session
6103,6110d6027
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 109]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
6121,6123c6038,6040
<    (i.e., pool 1).  It rates the request according to Service-
<    Id/Rating-Group and updates the existing reservation by requesting
<    more credit.  Suppose that the server reserves $5 more (now the
---
>    (i.e., pool 1).  It rates the request according to Service- Id/
>    Rating-Group and updates the existing reservation by requesting more
>    credit.  Suppose that the server reserves $5 more (now the
6127a6045,6052
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 108]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
6159,6166d6083
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 110]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
6182a6100,6108
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 109]
> 
> Internet-Draft              Abbreviated Title                August 2005
> 
> 
6198,6203c6124,6129
<    Service 3 (13).  This message contains two instances of the
<    Multiple-Services-Credit-Control AVP to report the units used by
<    Services 3 and 4.  The server deducts the last $5 from the user's
<    account (pool 2) and returns the answer with Result-Code 4011 in the
<    Multiple-Services-Credit-Control AVP to indicate that Service 3 can
<    continue without credit-control (14).
---
>    Service 3 (13).  This message contains two instances of the Multiple-
>    Services-Credit-Control AVP to report the units used by Services 3
>    and 4.  The server deducts the last $5 from the user's account (pool
>    2) and returns the answer with Result-Code 4011 in the Multiple-
>    Services-Credit-Control AVP to indicate that Service 3 can continue
>    without credit-control (14).
6213,6222d6138
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 111]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
6232c6148
<    20520 Turku
---
>    Turku  20520
6236c6152,6162
<    EMail: Harri.Hakala@ericsson.com
---
>    Email: Harri.Hakala@ericsson.com
> 
> 
> 
> 
> 
> 
> 
> Hakala, et al.          Expires February 2, 2006              [Page 110]
> 
> Internet-Draft              Abbreviated Title                August 2005
6242c6168
<    20520 Turku
---
>    Turku  20520
6246c6172
<    EMail: Leena.Mattila@ericsson.com
---
>    Email: Leena.Mattila@ericsson.com
6252c6178
<    33100 Tampere
---
>    Tampere  33100
6256,6276c6182
<    EMail: juha-pekka.koskinen@nokia.com
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 112]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
---
>    Email: juha-pekka.koskinen@nokia.com
6282,6283c6188,6189
<    00380 Helsinki
<    Finland
---
>    Tampere  00380
>    Helsinki
6286c6192
<    EMail: marco.stura@nokia.com
---
>    Email: marco.stura@nokia.com
6292,6293c6198,6199
<    00180 Helsinki
<    Finland
---
>    Tampere  00180
>    Helsinki
6296,6310c6202
<    EMail: John.Loughney@nokia.com
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
---
>    Email: John.Loughney@nokia.com
6324,6387c6216
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 113]
< 
< RFC 4006          Diameter Credit-Control Application        August 2005
< 
< 
< Full Copyright Statement
< 
<    Copyright (C) The Internet Society (2005).
< 
<    This document is subject to the rights, licenses and restrictions
<    contained in BCP 78, and except as set forth therein, the authors
<    retain all their rights.
< 
<    This document and the information contained herein are provided on an
<    "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
<    OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
<    ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
<    INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
<    INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
<    WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
< 
< Intellectual Property
< 
<    The IETF takes no position regarding the validity or scope of any
<    Intellectual Property Rights or other rights that might be claimed to
<    pertain to the implementation or use of the technology described in
<    this document or the extent to which any license under such rights
<    might or might not be available; nor does it represent that it has
<    made any independent effort to identify any such rights.  Information
<    on the procedures with respect to rights in RFC documents can be
<    found in BCP 78 and BCP 79.
< 
<    Copies of IPR disclosures made to the IETF Secretariat and any
<    assurances of licenses to be made available, or the result of an
<    attempt made to obtain a general license or permission for the use of
<    such proprietary rights by implementers or users of this
<    specification can be obtained from the IETF on-line IPR repository at
<    http://www.ietf.org/ipr.
< 
<    The IETF invites any interested party to bring to its attention any
<    copyrights, patents or patent applications, or other proprietary
<    rights that may cover technology that may be required to implement
<    this standard.  Please address the information to the IETF at ietf-
<    ipr@ietf.org.
< 
< Acknowledgement
< 
<    Funding for the RFC Editor function is currently provided by the
<    Internet Society.
< 
< 
< 
< 
< 
< 
< 
< Hakala, et al.              Standards Track                   [Page 114]
< 
---
> Hakala, et al.          Expires February 2, 2006              [Page 111]
